<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Soichi Matsuura">
<title>2&nbsp; ファイナンス入門 – 実証会計・ファイナンスの勉強ノート</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter03.html" rel="next">
<link href="./index.html" rel="prev">
<link href="./img/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0907bcc31431a373ae96853dfe16c1d2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-9b98439fbe4ae1eb56616ecad9777bd3.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-0907bcc31431a373ae96853dfe16c1d2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SFB56VHK63"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SFB56VHK63', { 'anonymize_ip': true});
</script><style>
.marky { background: linear-gradient(transparent 60%, #FCFFC1 0%); }
.markb { background: linear-gradient(transparent 60%, #88E2EA 0%); }
.markp { background: linear-gradient(transparent 70%, #ffcdd2 0%); }
</style>
<script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta name="twitter:title" content="2&nbsp; ファイナンス入門 – 実証会計・ファイナンスの勉強ノート">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="chapter02_files/figure-html/pv_rf-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter02.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">ファイナンス入門</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">実証会計・ファイナンスの勉強ノート</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">はじめに</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter02.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">ファイナンス入門</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R言語入門</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">財務データの取得と可視化</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">株式データの取得と可視化</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ファクターモデルの導入</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#%E5%89%B2%E5%BC%95%E7%8E%87" id="toc-割引率" class="nav-link active" data-scroll-target="#%E5%89%B2%E5%BC%95%E7%8E%87"><span class="header-section-number">2.1</span> 割引率</a>
  <ul class="collapse">
<li><a href="#%E7%A2%BA%E5%AE%9F%E3%81%AA%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%89%B2%E5%BC%95%E7%8E%87" id="toc-確実なキャッシュフローに対する割引率" class="nav-link" data-scroll-target="#%E7%A2%BA%E5%AE%9F%E3%81%AA%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%89%B2%E5%BC%95%E7%8E%87"><span class="header-section-number">2.1.1</span> 確実なキャッシュ・フローに対する割引率</a></li>
  <li><a href="#%E4%B8%8D%E7%A2%BA%E5%AE%9F%E3%81%AA%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%89%B2%E5%BC%95%E7%8E%87" id="toc-不確実なキャッシュフローに対する割引率" class="nav-link" data-scroll-target="#%E4%B8%8D%E7%A2%BA%E5%AE%9F%E3%81%AA%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%89%B2%E5%BC%95%E7%8E%87"><span class="header-section-number">2.1.2</span> 不確実なキャッシュ・フローに対する割引率</a></li>
  <li><a href="#npv%E6%B3%95" id="toc-npv法" class="nav-link" data-scroll-target="#npv%E6%B3%95"><span class="header-section-number">2.1.3</span> NPV法</a></li>
  <li><a href="#%E9%85%8D%E5%BD%93%E5%89%B2%E5%BC%95%E3%83%A2%E3%83%87%E3%83%AB" id="toc-配当割引モデル" class="nav-link" data-scroll-target="#%E9%85%8D%E5%BD%93%E5%89%B2%E5%BC%95%E3%83%A2%E3%83%87%E3%83%AB"><span class="header-section-number">2.1.4</span> 配当割引モデル</a></li>
  <li><a href="#%E3%82%B4%E3%83%BC%E3%83%89%E3%83%B3%E6%88%90%E9%95%B7%E3%83%A2%E3%83%87%E3%83%AB" id="toc-ゴードン成長モデル" class="nav-link" data-scroll-target="#%E3%82%B4%E3%83%BC%E3%83%89%E3%83%B3%E6%88%90%E9%95%B7%E3%83%A2%E3%83%87%E3%83%AB"><span class="header-section-number">2.1.5</span> ゴードン成長モデル</a></li>
  <li><a href="#%E5%89%B2%E5%BC%95%E7%8E%87%E3%81%A8%E6%9C%9F%E5%BE%85%E3%83%AA%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E9%96%A2%E4%BF%82" id="toc-割引率と期待リターンの関係" class="nav-link" data-scroll-target="#%E5%89%B2%E5%BC%95%E7%8E%87%E3%81%A8%E6%9C%9F%E5%BE%85%E3%83%AA%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E9%96%A2%E4%BF%82"><span class="header-section-number">2.1.6</span> 割引率と期待リターンの関係</a></li>
  </ul>
</li>
  <li>
<a href="#%E5%B9%B3%E5%9D%87%E5%88%86%E6%95%A3%E3%82%A2%E3%83%97%E3%83%AD%E3%83%BC%E3%83%81%E5%85%A5%E9%96%80" id="toc-平均分散アプローチ入門" class="nav-link" data-scroll-target="#%E5%B9%B3%E5%9D%87%E5%88%86%E6%95%A3%E3%82%A2%E3%83%97%E3%83%AD%E3%83%BC%E3%83%81%E5%85%A5%E9%96%80"><span class="header-section-number">2.2</span> 平均分散アプローチ入門</a>
  <ul class="collapse">
<li><a href="#%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA%E3%81%AE%E3%83%AA%E3%82%B9%E3%82%AF%E3%81%A8%E3%83%AA%E3%82%BF%E3%83%BC%E3%83%B3" id="toc-ポートフォリオのリスクとリターン" class="nav-link" data-scroll-target="#%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA%E3%81%AE%E3%83%AA%E3%82%B9%E3%82%AF%E3%81%A8%E3%83%AA%E3%82%BF%E3%83%BC%E3%83%B3"><span class="header-section-number">2.2.1</span> ポートフォリオのリスクとリターン</a></li>
  <li><a href="#%E5%88%86%E6%95%A3%E6%8A%95%E8%B3%87%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88" id="toc-分散投資のメリット" class="nav-link" data-scroll-target="#%E5%88%86%E6%95%A3%E6%8A%95%E8%B3%87%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><span class="header-section-number">2.2.2</span> 分散投資のメリット</a></li>
  <li><a href="#%E7%A9%BA%E5%A3%B2%E3%82%8A%E3%81%AE%E5%8A%B9%E6%9E%9C" id="toc-空売りの効果" class="nav-link" data-scroll-target="#%E7%A9%BA%E5%A3%B2%E3%82%8A%E3%81%AE%E5%8A%B9%E6%9E%9C"><span class="header-section-number">2.2.3</span> 空売りの効果</a></li>
  <li><a href="#%E5%AE%89%E5%85%A8%E8%B3%87%E7%94%A3%E3%81%AE%E5%B0%8E%E5%85%A5" id="toc-安全資産の導入" class="nav-link" data-scroll-target="#%E5%AE%89%E5%85%A8%E8%B3%87%E7%94%A3%E3%81%AE%E5%B0%8E%E5%85%A5"><span class="header-section-number">2.2.4</span> 安全資産の導入</a></li>
  <li><a href="#%E8%B3%87%E7%94%A3%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA" id="toc-資産のポートフォリオ" class="nav-link" data-scroll-target="#%E8%B3%87%E7%94%A3%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA"><span class="header-section-number">2.2.5</span> 3資産のポートフォリオ</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%9C%80%E9%81%A9%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA%E5%95%8F%E9%A1%8C" id="toc-最適ポートフォリオ問題" class="nav-link" data-scroll-target="#%E6%9C%80%E9%81%A9%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA%E5%95%8F%E9%A1%8C"><span class="header-section-number">2.3</span> 最適ポートフォリオ問題</a>
  <ul class="collapse">
<li><a href="#%E5%8A%B9%E7%8E%87%E7%9A%84%E3%83%95%E3%83%AD%E3%83%B3%E3%83%86%E3%82%A3%E3%82%A2" id="toc-効率的フロンティア" class="nav-link" data-scroll-target="#%E5%8A%B9%E7%8E%87%E7%9A%84%E3%83%95%E3%83%AD%E3%83%B3%E3%83%86%E3%82%A3%E3%82%A2"><span class="header-section-number">2.3.1</span> 効率的フロンティア</a></li>
  <li><a href="#%E6%8A%95%E8%B3%87%E5%AE%B6%E3%81%AE%E3%83%AA%E3%82%B9%E3%82%AF%E5%9B%9E%E9%81%BF%E5%BA%A6%E3%81%A8%E6%9C%80%E9%81%A9%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA" id="toc-投資家のリスク回避度と最適ポートフォリオ" class="nav-link" data-scroll-target="#%E6%8A%95%E8%B3%87%E5%AE%B6%E3%81%AE%E3%83%AA%E3%82%B9%E3%82%AF%E5%9B%9E%E9%81%BF%E5%BA%A6%E3%81%A8%E6%9C%80%E9%81%A9%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AA%E3%82%AA"><span class="header-section-number">2.3.2</span> 投資家のリスク回避度と最適ポートフォリオ</a></li>
  <li><a href="#%E3%83%88%E3%83%BC%E3%83%93%E3%83%B3%E3%81%AE%E5%88%86%E9%9B%A2%E5%AE%9A%E7%90%86" id="toc-トービンの分離定理" class="nav-link" data-scroll-target="#%E3%83%88%E3%83%BC%E3%83%93%E3%83%B3%E3%81%AE%E5%88%86%E9%9B%A2%E5%AE%9A%E7%90%86"><span class="header-section-number">2.3.3</span> トービンの分離定理</a></li>
  </ul>
</li>
  <li>
<a href="#capm" id="toc-capm" class="nav-link" data-scroll-target="#capm"><span class="header-section-number">2.4</span> CAPM</a>
  <ul class="collapse">
<li><a href="#%E4%BB%AE%E5%AE%9A%E3%81%AE%E7%A2%BA%E8%AA%8D" id="toc-仮定の確認" class="nav-link" data-scroll-target="#%E4%BB%AE%E5%AE%9A%E3%81%AE%E7%A2%BA%E8%AA%8D"><span class="header-section-number">2.4.1</span> 仮定の確認</a></li>
  <li><a href="#capm%E3%81%AE%E7%AC%AC%E4%B8%80%E5%91%BD%E9%A1%8C" id="toc-capmの第一命題" class="nav-link" data-scroll-target="#capm%E3%81%AE%E7%AC%AC%E4%B8%80%E5%91%BD%E9%A1%8C"><span class="header-section-number">2.4.2</span> CAPMの第一命題</a></li>
  <li><a href="#capm%E3%81%AE%E7%AC%AC%E4%BA%8C%E5%91%BD%E9%A1%8C" id="toc-capmの第二命題" class="nav-link" data-scroll-target="#capm%E3%81%AE%E7%AC%AC%E4%BA%8C%E5%91%BD%E9%A1%8C"><span class="header-section-number">2.4.3</span> CAPMの第二命題</a></li>
  <li><a href="#%E8%A8%BC%E5%88%B8%E5%B8%82%E5%A0%B4%E7%B7%9A" id="toc-証券市場線" class="nav-link" data-scroll-target="#%E8%A8%BC%E5%88%B8%E5%B8%82%E5%A0%B4%E7%B7%9A"><span class="header-section-number">2.4.4</span> 証券市場線</a></li>
  </ul>
</li>
  <li><a href="#n%E8%B3%87%E7%94%A3%E3%81%8C%E6%8A%95%E8%B3%87%E5%8F%AF%E8%83%BD%E3%81%AA%E5%A0%B4%E5%90%88%E3%81%B8%E3%81%AE%E6%8B%A1%E5%BC%B5" id="toc-n資産が投資可能な場合への拡張" class="nav-link" data-scroll-target="#n%E8%B3%87%E7%94%A3%E3%81%8C%E6%8A%95%E8%B3%87%E5%8F%AF%E8%83%BD%E3%81%AA%E5%A0%B4%E5%90%88%E3%81%B8%E3%81%AE%E6%8B%A1%E5%BC%B5"><span class="header-section-number">2.5</span> N資産が投資可能な場合への拡張</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">ファイナンス入門</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  tidyverse, <span class="co"># 便利なパッケージ群</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>  ggthemes, <span class="co"># ggplot2のテーマ集</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  plotly, <span class="co"># インタラクティブなグラフ作成</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  patchwork, <span class="co"># 複数のグラフをまとめて表示</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  Rsolnp, <span class="co"># 制約付き最適化ソルバー</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  shiny, <span class="co"># インタラクティブ・アプリ作成</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  shinylive</span>
<span id="cb1-9"><a href="#cb1-9"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
The downloaded binary packages are in
    /var/folders/2g/27g4rn1d50z6yg_sw3v05kmc0000gn/T//RtmpI3lKmu/downloaded_packages</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mystyle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="co"># 1. ggthemes 自体の引数でフォントを指定します</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">theme_economist_white</span>(</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="co"># gray_bg = FALSE,</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="at">base_family =</span> <span class="st">"HiraKakuProN-W3"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    ),</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="fu">scale_colour_economist</span>(),</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="co"># theme_calc(base_family = "HiraKakuProN-W3"),</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="co"># scale_colour_calc(),</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="co"># 3. その他の微調整（フォントサイズなど）</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>), <span class="co"># フォントファミリーは上で指定済みなので省略可</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="co"># 必要であれば個別の要素を調整</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="co"># plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>  )</span>
<span id="cb3-19"><a href="#cb3-19"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="割引率" class="level2 page-columns page-full" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="割引率">
<span class="header-section-number">2.1</span> 割引率</h2>
<p><strong>ファイナンス</strong>(finance)の大事な概念に<strong>割引率</strong>(discount rate)があります。 これは、<span class="markp">ある財の今の価値と将来の価値は異なっており、将来の価値を現在の価値(これを<strong>現在価値</strong>(present value)という)に変換するための係数</span>です。</p>
<p>たとえば，今の100万円が来年110万円になる世界において，</p>
<p><span class="math display">
100 = f(110)
</span></p>
<p>と表せる関数<span class="math inline">f</span>が存在するとします。このとき，110万円を現在価値に変換するための係数が割引率です。 具体的に，</p>
<p><span class="math display">
f(110) = \frac{110}{1 + r}
</span></p>
<p>と表せるとき，<span class="math inline">r</span>が割引率です。</p>
<p><span class="math display">
\begin{aligned}
100 &amp;= \frac{110}{1 + r}\\
r &amp;= \frac{110}{100} - 1 = 0.1
\end{aligned}
</span></p>
<p>この場合，割引率<span class="math inline">r</span>は0.1(10%)となります。 割引率10%の世界において，今の100万円は1年後の110万円と同じ価値をもつ，ということを意味しています。</p>
<section id="確実なキャッシュフローに対する割引率" class="level3 page-columns page-full" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="確実なキャッシュフローに対する割引率">
<span class="header-section-number">2.1.1</span> 確実なキャッシュ・フローに対する割引率</h3>
<ul>
<li>
<strong>現在価値</strong> ：将来に発生するキャッシュフローの現時点における価値</li>
<li>
<strong>時間価値</strong> ：将来と現在の価値の違い</li>
<li>
<strong>無リスク金利</strong> (risk-free rate) ：安全資産へと投資したときのリターンで，投資時点でリターンの額が確定します。 無リスク金利は<strong>確率変数ではなく定数</strong>(parameter)です。</li>
</ul>
<p>上の式を年を<span class="math inline">T</span>という記号で表して一般的に表現します。 <span class="math inline">T</span>年後に<strong>確実に</strong>獲得できるキャッシュフローを<span class="math inline">CF_T</span>で表し、無リスク割引率を<span class="math inline">R_F</span>で表します<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。 このとき現在価値 <span class="math inline">PV</span> は以下のように計算されます。</p>
<p><span class="math display">
PV = \frac{CF_T}{(1 + R_F)^T}
</span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>現時点で<span class="math inline">CF_0</span>を1年間貯金する。利息<span class="math inline">r</span>は<span class="math inline">0.1</span>とする。 1年後に受け取れるキャッシュフロー<span class="math inline">CF_1</span>は、貯金した元本<span class="math inline">CF_0</span>と利息<span class="math inline">CF_0 \times 0.1</span>となる。つまり、<span class="math inline">CF_0 + CF_0 \times 0.1 = (1+0.1)CF_0</span>である。</p>
<p>逆に、来年<span class="math inline">CF_1</span>受け取るためには、今いくら貯金するかを考える。必要な貯金額を<span class="math inline">X</span>とすると、<span class="math inline">X \times (1 + 0.1) = CF_1</span>となる。つまり<span class="math inline">X = CF_1/ (1.1)</span>となる。 これが現在価値である。</p>
</div></div><p>将来の確実なキャッシュ・フロー<span class="math inline">CF_T</span>の現在価値は、割引率<span class="math inline">R_F</span>と将来受け取る時点である<span class="math inline">T</span>に依存している。<span class="math inline">CF_T = 100</span>の場合、<span class="math inline">R_F</span>と<span class="math inline">T</span>の変化に応じて現在価値がどのように変化するのか確認する。</p>
<p><span class="math inline">T=1</span>として、横軸を割引率、縦軸を現在価値としたグラフが以下のものである。 割引率が大きくなるにつれて現在価値が小さくなることが分かる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>現在価値と割引率</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>T_fixed <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 1年後に固定</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">data.frame</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="at">R_F =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>))</span>
<span id="cb4-5"><a href="#cb4-5"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">PV =</span> <span class="dv">100</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> R_F)<span class="sc">^</span>T_fixed</span>
<span id="cb4-8"><a href="#cb4-8"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> R_F, <span class="at">y =</span> PV) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"割引率"</span>, <span class="at">y =</span> <span class="st">"現在価値"</span>) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>  mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/pv_rf-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="chapter02_files/figure-html/pv_rf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>次に、<span class="math inline">R_F = 0.1</span> に固定して、横軸を年 <span class="math inline">T</span> 、縦軸を現在価値 <span class="math inline">PV</span> としてグラフが以下のものです。 図を見ると，キャッシュ・フローを受け取る時点が遠くなるほど、現在価値が小さくなることがわかります。 1年後に受け取れる100万円と，10年後に受け取れる100万円では，後者の方が価値が低い，というのは直観的ですよね。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>現在価値と期間</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>R_F <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># 無リスク利子率</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>T <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="co"># 将来受け取る時点</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>PV <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> R_F)<span class="sc">^</span>T <span class="co"># 現在価値の計算</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(T, PV) <span class="co"># データフレーム作成</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># 作図</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>df <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">aes</span>(<span class="at">x =</span> T, <span class="at">y =</span> PV) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">xlab</span>(<span class="st">"T年後"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"現在価値"</span>) <span class="sc">+</span> mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/pv_T-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="chapter02_files/figure-html/pv_T-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="不確実なキャッシュフローに対する割引率" class="level3 page-columns page-full" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="不確実なキャッシュフローに対する割引率">
<span class="header-section-number">2.1.2</span> 不確実なキャッシュ・フローに対する割引率</h3>
<p><span class="marky">モデルに投資家の<strong>リスクプレミアム</strong>(risk premium; RP)を反映させることが割引率の2つ目の役割</span>です。 通常、将来キャッシュ・フローがいくらになるのか分からないのが普通であり、<span class="math inline">CF</span>は様々な要因で変化する<strong>確率変数</strong>(random variable)であるため、現時点における<strong>期待値</strong>(expected value)で評価されます。</p>
<p>たとえば，1年後に確実に150万円もらえる投資Aと，確率50%で200万円，確率50%で100万円もらえる投資Bがあるとします。 期待値で評価すると，投資Aの期待キャッシュフローは150万円，投資Bの期待キャッシュフローは<span class="math inline">0.5 \times 200 + 0.5 \times 100 = 150</span>万円となり，同じ期待キャッシュフローをもつことになります。 しかし，直観的に投資Bは100万円しか生み出さないリスクがある分，2つの投資の価値を現在の価値で比較すると，投資Aの方が価値が高いと思いませんか？</p>
<p>このリスクのある資産Bの割引率を<span class="math inline">\tilde{R}</span>と表すと，2つの投資の現在価値は，次のようになります。</p>
<p><span class="math display">
\frac{150}{1 + R_F} \quad &gt; \quad \frac{200 \times 0.5 + 100 \times 0.5}{1 + \tilde{R}}
</span> となるなら， <span class="math display">
R_F &lt; \tilde{R}
</span></p>
<p>となります。この<span class="math inline">R_F</span>と<span class="math inline">\tilde{R}</span>の差が<strong>リスクプレミアム</strong>(risk premium: RP)です。リスクプレミアムは、リスクのある資産に投資することに対する追加的な見返りを意味します。</p>
<p><span class="math display">
\begin{aligned}
RP \equiv \tilde{R} - R_F\\
R_F + RP = \tilde{R}
\end{aligned}
</span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>ここで、期待値をとる演算子(operator)を<span class="math inline">\mathbb{E}</span>で表し、期待値をとる時点を添え字で表す。ここでは現時点<span class="math inline">t=0</span>における期待値を<span class="math inline">\mathbb{E}_0</span>と表現している。 たとえば，現時点を<span class="math inline">t=0</span>として，1期先に起こりうる結果<span class="math inline">X</span>が<span class="math inline">100</span>か<span class="math inline">200</span>であることが分かっていて，それぞれの発生確率が50%であったとする。この将来に起こりうる結果を現時点での情報を基に期待値をとる，ということは， <span class="math display">
\mathbb{E}[X] = 0.5 \times 100 + 0.5 \times 200 = 150
</span> となる。このように起こりうる結果と発生確率を掛けて足したものを<strong>期待値</strong>という。</p>
</div></div><p>リスクプレミアムは割引率の調整で定量化されます。</p>
<p><span class="math display">
\begin{aligned}
PV_0 &amp; = \frac{\mathbb{E_0}[CF_1]}{1 + R_F + \underbrace{(\tilde{R} - R_F)}_{\text{RP}}}\\
     &amp; =\frac{\mathbb{E_0}[CF_1]}{\underbrace{1+\tilde{R}}_{\text{リスク調整済み割引率}}}
\end{aligned}
</span></p>
<p>割引率は時間価値やリスクプレミアムに関する定量的な情報を含むので、タイミングやリスクの異なるキャッシュフローを現在価値という同一の尺度で評価できます。</p>
</section><section id="npv法" class="level3 page-columns page-full" data-number="2.1.3"><h3 data-number="2.1.3" class="anchored" data-anchor-id="npv法">
<span class="header-section-number">2.1.3</span> NPV法</h3>
<p>先ほど学習した割引現在価値を判断の基準に，投資意思決定を行う方法を<strong>NPV法</strong>(Net Present Value Method)といいます。 いま，投資するかどうかを決めるタイミングを時点0(<span class="math inline">t=0</span>)とします。 キャッシュフローは<span class="math inline">CF_t</span>で表し，マイナスなら支出，プラスなら収入を意味します。 将来キャッシュフローは不確実であるため，現時点での期待値<span class="math inline">\mathbb{E_0}[CF_t]</span>で評価します。 ちなみに<span class="math inline">CF_0</span>は時点0での投資なので，マイナスとなります。</p>
<p>投資時点からT年間にわたって毎年<span class="math inline">\mathbb{E}[CF_t],\quad t = 1,\dots ,T</span>の期待キャッシュフローが生み出されるなら、それらを割引率<span class="math inline">1 + \tilde{R}</span>で現在価値に直して足し合わせた値(つまりNPV)が、現時点で評価したプロジェクトの成果となります。</p>
<p>NPVはそのプロジェクトから発生するすべてのキャッシュフローの現在価値として解釈できます。 コーポレートファイナンスでは，</p>
<ul>
<li>NPVがゼロ以上のプロジェクトは投資を実行</li>
<li>NPVが負のプロジェクトは投資を見送る</li>
</ul>
<p>ことを推奨しています。 NPV法を一般的に表現すると次のようになります(p.48)。 <span class="math display">
\begin{aligned}
NPV_0 &amp;= \frac{CF_0}{(1+\tilde{R})^0} + \frac{\mathbb{E}[CF_1]}{(1+\tilde{R})^1} + \cdots + \frac{\mathbb{E}[CF_T]}{(1+\tilde{R})^T}\\
&amp;= CF_0 + \sum_{t=1}^T\frac{\mathbb{E}[CF_t]}{(1+\tilde{R})^t}
\end{aligned}
</span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p><span class="math inline">x^0 = 1</span> であることに注意してください。</p>
</div></div></section><section id="配当割引モデル" class="level3" data-number="2.1.4"><h3 data-number="2.1.4" class="anchored" data-anchor-id="配当割引モデル">
<span class="header-section-number">2.1.4</span> 配当割引モデル</h3>
<p>NPV法の考え方を株式投資に適用することもできます。 株式の保有期間を<span class="math inline">T</span>年とし、時点<span class="math inline">t</span>における株価を<span class="math inline">P_t</span>で表します。 株式から生み出される将来キャッシュ・フローは、</p>
<ul>
<li>一株当たり配当と，</li>
<li>売却時点での売却損益</li>
</ul>
<p>であり、<span class="math inline">t</span>時点の一株当たり配当を<span class="math inline">D_t</span>，売却時点での一株当たり売却損益を<span class="math inline">P_T - P_{T-1}</span>と表します。 将来配当や将来売却損益は確率変数であるため期待値で考え、それを割引率<span class="math inline">\tilde{R}</span>で割り引くことで、一株当たりの株式価値を求めます。</p>
<p><span class="math display">
\begin{aligned}
P_0^* &amp;= \frac{\mathbb{E_0}[D_1]}{1 + \tilde R} + \frac{\mathbb{E_0}[D_2]}{(1 + \tilde R)^2} + \cdots + \frac{\mathbb{E_0}[D_{\infty}]}{(1 + \tilde R)^{T}} + \frac{\mathbb{E_0}[P_T] - P_0}{(1+\tilde{R})^T}\\
&amp;= \sum^{T}_{t=1} \frac{\mathbb{E_0}[D_t]}{(1+\tilde{R})^t} + \frac{\mathbb{E_0}[P_T] - P_0}{(1+\tilde{R})^T}
\end{aligned}
</span></p>
<p>十分長い期間<span class="math inline">T \rightarrow \infty</span>を考えると，売却損益の現在価値はゼロに近づくため，株式の理論価値<span class="math inline">P_0^*</span>は以下のように表せます。</p>
<p><span class="math display">
P_0^* = \sum^{\infty}_{t=1} \frac{\mathbb{E_0}[D_t]}{(1+\tilde{R})^t}
</span></p>
<p>これが<strong>配当割引モデル</strong>(Dividend Discount Model: DDM)です。 将来配当の予測値データがあれば，現時点における理論上の株価を計算することができます。</p>
</section><section id="ゴードン成長モデル" class="level3" data-number="2.1.5"><h3 data-number="2.1.5" class="anchored" data-anchor-id="ゴードン成長モデル">
<span class="header-section-number">2.1.5</span> ゴードン成長モデル</h3>
<p>配当割引モデルは理論上は正しいのですが、将来の配当を無限に予測することは現実的ではありません。 そこで、<span class="markp">将来の配当が一定の割合で成長していくという仮定を置くこと</span>で、将来配当の予測を簡略化する方法があります。 より具体的に，期待一株当たり配当が<strong>一定の割合で成長</strong>していくと仮定した割引配当モデルを<strong>ゴードン成長モデル</strong>という。</p>
<p>直近の実現した一株当たり配当を<span class="math inline">D_0</span>と置き、将来にわたってこの配当の期待値が一定割合<span class="math inline">G</span>%で成長していくと仮定する。 つまり1時点先の配当額<span class="math inline">D_1</span>が<span class="math inline">(1 + G)D_0</span>となる、と仮定する。 すると、<span class="math inline">t</span> 時点先の配当額 <span class="math inline">\mathbb{E}[D_t]</span> は、成長率<span class="math inline">G</span>を用いた複利計算により、 <span class="math display">
D_t = (1+G)^t D_0
</span> で表すことができます。 一定割合で配当額が成長する株式の理論価値<span class="math inline">P_0</span>を配当割引モデルで計算すると， <span class="math display">
\begin{aligned}
P_0 &amp;= \frac{(1 + G) D_0}{(1+\tilde{R})} +
  \frac{(1+G)^2 D_0}{(1+\tilde{R})^3} +
  \frac{(1+G)^3 D_0}{(1+\tilde{R})^3} + \cdots \\
    &amp;= \sum^{\infty}_{t = 1}\frac{(1 + G)^t D_0}{(1 + \tilde{R})^t}\\
    &amp;=\frac{(1+G)D_0}{\tilde{R}-G}
\end{aligned}
</span></p>
<p>2本目の式から3本目の式への計算で、<strong>等比級数の和の公式</strong>を利用している。</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>初項<span class="math inline">a</span>，公比<span class="math inline">r</span>の等比数列 <span class="math display">
a, ar, ar^2, ar^3, \dots , ar^{n-1},ar^n , \dots
</span> がある。この等比数列の和を<span class="math inline">S_n</span>で表す。 <span class="math display">
S_n = a + ar + ar^2 + \cdots + ar^{n-1} + \cdots
</span> 両辺に<span class="math inline">r</span>を乗じると， <span class="math display">
rS_n =  ar + ar^2 + \cdots + ar^{n-1} + ar^{n} + \cdots
</span> となる。そして，<span class="math inline">S_n - rS_n</span>を計算すると， <span class="math display">
\begin{aligned}
S_n - r S_n &amp;= a\\
(1-r)S_n &amp;= a\\
S_n &amp;= \frac{a}{1-r}
\end{aligned}
</span> 上のゴードン成長モデルの初項は<span class="math inline">(1+G)D_0/(1+\tilde R)</span>，公比は<span class="math inline">(1 +G)/(1+\tilde R)</span>なので， <span class="math display">
\begin{aligned}
S_n
%P_0^* &amp;= \frac{(1+G)D_0}{1+ \tilde R} + \frac{(1+G)^2 D_0}{(1+ \tilde R)^2} + \frac{(1+G)^3 D_0}{(1+ \tilde R)^3} + \cdots \\
&amp;= \displaystyle  \frac{\frac{(1+G)D_0}{(1 + \tilde R)}}{1 - \frac{1+G}{1+\tilde R}}\\
&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{(1+ \tilde R) - (1+G)}{1+\tilde R}}\\
%&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{\tilde R - G}{1+\tilde R}}\\
&amp;= \displaystyle  \frac{1+G}{\tilde R - G}D_0\\
\end{aligned}
</span> ただし，<span class="math inline">\tilde{R} \not = G</span>の場合のみである。</p>
</div>
</div>
</section><section id="割引率と期待リターンの関係" class="level3" data-number="2.1.6"><h3 data-number="2.1.6" class="anchored" data-anchor-id="割引率と期待リターンの関係">
<span class="header-section-number">2.1.6</span> 割引率と期待リターンの関係</h3>
<p>割引率<span class="math inline">R</span>は投資家が将来キャッシュフローを購入するにあたって最低限要求する期待リターン(<strong>要求収益率</strong>)とも解釈できます。 これくらいリスクのある投資をするのだから，リスクのない資産への投資よりも高いリターンを要求する，という考えを反映しています。</p>
</section></section><section id="平均分散アプローチ入門" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="平均分散アプローチ入門">
<span class="header-section-number">2.2</span> 平均分散アプローチ入門</h2>
<p>個々の投資家にとって<span class="markp">最適となる証券の組み合わせの比率を決めることを<strong>最適ポートフォリオ選択</strong></span>といいます。 <span class="markp">ポートフォリオの価値をリターンの期待値と分散で評価する</span>考え方を<strong>平均・分散アプローチ</strong>といいます。</p>
<section id="ポートフォリオのリスクとリターン" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="ポートフォリオのリスクとリターン">
<span class="header-section-number">2.2.1</span> ポートフォリオのリスクとリターン</h3>
<ol type="1">
<li>投資対象が銘柄Aと銘柄Bの2銘柄のみが投資対象であるケース</li>
<li>各銘柄への投資割合を<span class="math inline">w_A</span>と<span class="math inline">w_B</span>
</li>
<li><span class="math inline">w_A + w_B = 1</span></li>
</ol>
<p>記号の定義は以下の通りです。</p>
<ul>
<li>元本 <span class="math inline">X</span>
</li>
<li>投資銘柄Aのリターン <span class="math inline">1 + R_A</span>
</li>
<li>投資銘柄Bのリターン <span class="math inline">1 + R_B</span>
</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>リターンの定義<span class="math inline">(P_t - P_{t-1})/P_{t-1} = P_t/P_{t-1} -1</span>は<strong>ネット・リターン</strong>(net return)と呼ばれるものである。 これにたいして，元本も含めたリターン<span class="math inline">1 + R_t = P_t/P_{t-1}</span>は<strong>グロス・リターン</strong>(gross return)という。</p>
</div>
</div>
<p>元本<span class="math inline">X</span>のうち<span class="math inline">w_A</span>分だけ銘柄Aに投資すると、1年後に期待値で<span class="math inline">\mathbb{E}[X \times w_A \times (1+R_A)]</span>になります。 手元現金全額を銘柄AとBに振り分けると、 <span class="math display">
\begin{aligned}
(1 + R_A) w_A X + ( 1 + R_B) w_B X
&amp;= w_A X + w_A R_A X + w_B X + w_B R_B X\\
&amp;= \left [\underbrace{(w_A+w_B)}_{\text{定義より} = 1}+(w_AR_A+w_BR_B) \right ]X\\
&amp;= (1 + w_A R_A + w_B R_B)X
\end{aligned}
</span> となります。 この<strong>1年後の価値と初期投資額の比</strong>としてこのポートフォリオのリターン<span class="math inline">1 + R_P</span>を計算します。 <span class="math display">
\begin{aligned}
1 + R_P &amp;= \frac{\overbrace{(1 + w_A R_A + w_B R_B)X}^{将来時点の評価額}}{\underbrace{X}_{初期投資}}\\
        &amp;= 1 + w_A R_A + w_B R_B\\
        &amp;= 1 + w_A R_A + w_B R_B\\
R_P     &amp;= w_A R_A + w_B R_B
\end{aligned}
</span></p>
<p><span class="markp">ポートフォリオ構築時には、各銘柄の実現リターンはわからない</span>ので(つまり確率変数)、かわりに期待値や分散を評価します。 銘柄Aと銘柄Bのネット・リターンをそれぞれ<span class="math inline">R_A</span>と<span class="math inline">R_B</span>で表すと，期待値，分散，標準偏差は次のようになります。</p>
<ul>
<li>期待値 <span class="math inline">\mathbb{E}[R_A] = \mu _A</span>，<span class="math inline">\mathbb{E}[R_B] = \mu_B</span>
</li>
<li>分散 <span class="math inline">\mathbb{V}[R_A] = \sigma^2_A</span>，<span class="math inline">\mathbb{V}[R_B] = \sigma^2_B</span>
</li>
<li>共分散 <span class="math inline">\mathbb{Cov}[R_A, R_B] = \sigma_{AB}</span>
</li>
<li>相関係数 <span class="math inline">\rho = \frac{\sigma_{AB}}{\sigma_A \sigma_B}</span>
</li>
</ul>
<p><span class="math display">
\begin{aligned}
% \rho &amp;= \frac{\mathbb{E}[(R_A - \bar R_A)(R_B - \bar R_B)]}{\mathbb{E}[(R_A - \bar R_A)^2]}
\rho &amp;= \frac{\sigma _{AB}}{\sigma _A \times \sigma _B} \\
\sigma_{AB} &amp; = \rho\sigma_A\sigma_B
\end{aligned}
</span></p>
<p>と表せます。</p>
<p>上の式より、ポートフォリオのリターンは<span class="math inline">R_P = w_A R_A + w_B R_B</span> なので、 ポートフォリオのリターンの期待値 <span class="math inline">\mathbb{E}[R_P] = \mu_P</span> も各銘柄の期待リターンの加重平均となります。 ここで投資割合<span class="math inline">w_A</span>と<span class="math inline">w_B</span>は定数であり，<span class="math inline">R_A, R_B</span>は確率変数です。 <span class="math display">
\begin{aligned}
\mathbb{E}[R_p] = \mu_P &amp;= \mathbb{E}[w_A R_A + w_B R_B]\\
&amp;= w_A \mathbb{E}[R_A] + w_B \mathbb{E}[R_B]\\
&amp;=w_A\mu_A+w_B\mu_B
\end{aligned}
</span></p>
<p>つぎに，ポートフォリオのリターン<span class="math inline">R_P</span>の分散<span class="math inline">\mathbb{V}[R_P] = \sigma^2_P</span>は各銘柄の分散及び相関係数を用いて計算できます。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma_P^2 &amp;= \mathbb{V}[w_A R_A + w_B R_B]\\
&amp;= w_A^2 \mathbb{V}[R_A] + w_B^2 \mathbb{V}[R_B] + 2 w_A w_B \mathbb{Cov}[R_A,R_B]\\
&amp;= w_A^2 \sigma_A^2 + w_B^2 \sigma_B^2 + 2w_A w_B \sigma _{AB}\\
&amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B +
\underbrace{2 w_A w_B \rho \sigma_A \sigma_B}_{ここの\rho の符号が重要}
\end{aligned}
</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>確率変数の分散
</div>
</div>
<div class="callout-body-container callout-body">
<p>確率変数<span class="math inline">X</span>と<span class="math inline">Y</span>の線形結合<span class="math inline">aX + bY</span>の分散は次のように計算できます。 <span class="math display">
\begin{aligned}
\mathbb{V}(aX + bY) &amp;= \mathbb{E}\left[ \{ (aX + bY) - \mathbb{E}[aX + bY] \}^2 \right] \\
&amp;= \mathbb{E}\left[ \{ (aX + bY) - (a\mu_X + b\mu_Y) \}^2 \right] \\
&amp;= \mathbb{E}\left[ \{ a(X - \mu_X) + b(Y - \mu_Y) \}^2 \right] \\
&amp;= \mathbb{E}\left[ a^2(X - \mu_X)^2 + 2ab(X - \mu_X)(Y - \mu_Y) + b^2(Y - \mu_Y)^2 \right] \\
&amp;= a^2 \mathbb{E}\left[ (X - \mu_X)^2 \right] + 2ab \mathbb{E}\left[ (X - \mu_X)(Y - \mu_Y) \right] + b^2 \mathbb{E}\left[ (Y - \mu_Y)^2 \right] \\
&amp;= a^2 \mathbb{V}(X)  + b^2 \mathbb{V}(Y) + 2ab \mathrm{Cov}(X, Y)
\end{aligned}
</span></p>
</div>
</div>
<p>ポートフォリオPの分散 <span class="math inline">\mathbb{V}(R_P)</span> は，各銘柄の分散に投資割合の二乗を乗じたものに，各銘柄のリターンの相関関係部分を加えたものとなっていることが分かります。 つまり，この2銘柄のリターンの相関係数<span class="math inline">\rho</span>に応じて，ポートフォリオPの分散が大きくなるかどうかが決まる，ということです。</p>
</section><section id="分散投資のメリット" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="分散投資のメリット">
<span class="header-section-number">2.2.2</span> 分散投資のメリット</h3>
<p>保有比率<span class="math inline">(w_A, w_B)</span>を変化させたときのポートフォリオの<span class="math inline">\mu_P</span>と<span class="math inline">\sigma_P</span>がどのように変化するかを確認しましょう。 分散は非負の値をとることに注意してください。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma_P^2 &amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B + 2\rho{w_Aw_B\sigma_A\sigma_B}\\
&amp;= (w_A \sigma_A + w_B \sigma_B)^2 - 2w_A  w_B \sigma _A \sigma_B + 2\rho{w_Aw_B\sigma_A\sigma_B}\\
% &amp;= (w_A \sigma_A + w_B \sigma_B)^2 - (2 + 2\rho ) w_A w_B\sigma_A\sigma_B\\
&amp;=\underbrace{(w_{A} \sigma_{A} + w_{B}\sigma_{B})^{2}}_{&gt;0} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{ここ重要}
\end{aligned}
</span></p>
<p><span class="math inline">0 \leq w_{A} \leq 1</span> かつ <span class="math inline">0 \leq w_{B} \leq 1</span> ，<span class="math inline">w_A + w_B = 1</span> のとき、</p>
<p><span class="math display">
2 ( 1- \rho ) w_A w_B \sigma _A \sigma _B \geq 0
</span></p>
<p>となります。 <span class="math inline">\rho = 1</span>のときのみ等号で成立します。 したがって、<span class="math inline">-1 \leq \rho &lt; 1</span> のとき、<span class="math inline">( 1- \rho ) w_A w_B \sigma _A \sigma _B &gt; 0</span> となり，次の不等式が成立します。 <span class="math display">
\begin{aligned}
\sigma_P^2 &amp;= (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{&gt; 0}\\
\Longleftrightarrow \sigma _P^2 &amp;\leq (w_A \sigma _A + w_B \sigma _B)^2 \\
\Longleftrightarrow \sigma_{P} &amp; \leq
\underbrace{w_{A}\sigma_{A}+w_{B}\sigma_{B}}_{リスクの加重平均}
\end{aligned}
</span> となり，ポートフォリオのリスクを表す標準偏差<span class="math inline">\sigma_P</span>が銘柄AとBの標準偏差の加重平均<span class="math inline">w_{A}\sigma_{A} + w_{B} \sigma_{B}</span>以下になることがわかります。 これを<strong>分散投資効果</strong>という。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>分散投資効果 p.65</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># パラメータ設定</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="at">rho =</span> <span class="fl">0.2</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>)</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co"># データの生成</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>df_portfolio <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb6-12"><a href="#cb6-12"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="at">var_p =</span> wa<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> wb<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>      <span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> wa <span class="sc">*</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B,</span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>(var_p),</span>
<span id="cb6-18"><a href="#cb6-18"></a>    <span class="co"># ラベル作成: 0.1刻みの点のみラベルを付ける</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(<span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb6-20"><a href="#cb6-20"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb6-21"><a href="#cb6-21"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb6-22"><a href="#cb6-22"></a>  )</span>
<span id="cb6-23"><a href="#cb6-23"></a></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co"># 作図</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="fu">ggplot</span>(df_portfolio, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_portfolio <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb6-31"><a href="#cb6-31"></a>  mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/diversified_investment-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="chapter02_files/figure-html/diversified_investment-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>完全な負の相関<span class="math inline">(\rho=-1)</span>であるの場合、<span class="math inline">\sigma^{2}_{P}=0</span>のポートフォリオを構築できる。 確認のため、2銘柄の価格が完全な負の相関<span class="math inline">\rho = -1</span>をもつとき、ポートフォリオPのリスク<span class="math inline">\sigma_P</span>は <span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma ^2_P &amp;=(w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2}-2(1- (-1))w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} -4w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= w_A ^2 \sigma _A^2 + w_B^2\sigma _B^2 + 2w_A w_B \sigma_A \sigma_B -4w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= w_A ^2 \sigma _A^2 - 2w_{A}w_{B} \sigma_{A}\sigma_{B} + w_B^2\sigma _B^2 \\
&amp;= (w_{A}\sigma_{A} - w_{B}\sigma_{B})^{2}\\
\sigma _P &amp;= | w_{A}\sigma_{A} - w_{B}\sigma_{B}|
\end{aligned}
</span></p>
<p>以下のように，<span class="math inline">w_A \sigma _A = w_B \sigma_B</span>となるように<span class="math inline">w_A</span>と<span class="math inline">w_B</span>を選べば、<span class="math inline">\sigma _P = 0</span>となるポートフォリオを作れる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>完全な負の相関の分散投資効果 p.65</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># パラメータ設定</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># データ生成</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>df_neg_corr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb7-11"><a href="#cb7-11"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="co"># 完全な負の相関の場合、標準偏差は加重平均の差の絶対値になる</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span class="at">sigma_p =</span> <span class="fu">abs</span>(wa <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">-</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb7-16"><a href="#cb7-16"></a>    <span class="co"># ラベル作成: 0.1刻みの点のみラベルを付ける</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(<span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb7-18"><a href="#cb7-18"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb7-19"><a href="#cb7-19"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb7-20"><a href="#cb7-20"></a>  )</span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co"># 作図</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="fu">ggplot</span>(df_neg_corr, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_neg_corr <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="co"># 縦軸をリターン、横軸をリスクにするため入れ替え</span></span>
<span id="cb7-28"><a href="#cb7-28"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>  mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="chapter02_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>このケースでは、<span class="math inline">\sigma_A = 0.2</span>、<span class="math inline">\sigma_B = 0.3</span>となっているため、<span class="math inline">0.2w_A = 0.3w_B</span>となる保有割合を考える。 <span class="math display">
\begin{aligned}
0.2 w_A &amp;= 0.3w_B\\
0.2 w_A &amp;= 0.3(1-w_A)\\
0.2 w_A &amp;= 0.3 - 0.3w_A\\
0.5 w_A &amp;= 0.3\\
w_A &amp;= 0.6
\end{aligned}
</span> となるため、銘柄Aに60％、銘柄Bに40%を投資することで、リスクゼロで期待リターン<span class="math inline">0.6\times0.1 + 0.4 \times 0.2 = 0.14</span>を獲得することができる。</p>
</section><section id="空売りの効果" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="空売りの効果">
<span class="header-section-number">2.2.3</span> 空売りの効果</h3>
<p>空売り(short sale)とは、</p>
<ol type="1">
<li>保有していない証券を誰か(普通は証券会社)から借りてきて売却し、</li>
<li>一定期間後に買い戻して元の持ち主に返却する</li>
</ol>
<p>取引をいい、<strong>値下がりから利益を得る</strong>。 空売りを行う投資家をショートセラー(short seller)という。</p>
<p>いままでは、<span class="math inline">0 \leq w_A,w_B \leq 1</span> という制約を置いていたが、この制約をはずして <span class="math inline">w_A + w_B = 1</span> のみを課す。 つまり<span class="math inline">w_A &lt; 0</span>や<span class="math inline">w_B &lt; 0</span>が空売りを表す。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>空売りの効果 p.66</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># パラメータ設定</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="at">rho  =</span> <span class="fl">0.2</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>)</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co"># データ生成</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>df_short <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.01</span>), <span class="co"># 空売りを考慮して範囲拡大</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb8-12"><a href="#cb8-12"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-14"><a href="#cb8-14"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb8-15"><a href="#cb8-15"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>(wa<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> wb<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>                   <span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> wa <span class="sc">*</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb8-17"><a href="#cb8-17"></a>    <span class="at">wa_int =</span> <span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>), <span class="co"># 100倍して整数化</span></span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a>    <span class="co"># 条件:</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="co"># 1. wa が -1 以上 2 以下 (wa_int が -100 ~ 200)</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>    <span class="co"># 2. wa が 0.1 刻み (wa_int が 10 で割り切れる)</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="at">is_label_target =</span> (wa_int <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">100</span> <span class="sc">&amp;</span> wa_int <span class="sc">&lt;=</span> <span class="dv">200</span>) <span class="sc">&amp;</span> (wa_int <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(is_label_target,</span>
<span id="cb8-25"><a href="#cb8-25"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb8-26"><a href="#cb8-26"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb8-27"><a href="#cb8-27"></a>  )</span>
<span id="cb8-28"><a href="#cb8-28"></a></span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="co"># 作図</span></span>
<span id="cb8-30"><a href="#cb8-30"></a><span class="fu">ggplot</span>(df_short, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>  <span class="co"># ラベルがある点（0 &lt;= wa &lt;= 1）のみポイントとテキストを表示</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_short <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35"></a></span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>  mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/short_sale_effect-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="chapter02_files/figure-html/short_sale_effect-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>先ほどの空売りなしのケースと比べると，曲線が大きく広がっていることがわかります。 次に，安全資産を加えた3資産の場合を考えます。</p>
</section><section id="安全資産の導入" class="level3" data-number="2.2.4"><h3 data-number="2.2.4" class="anchored" data-anchor-id="安全資産の導入">
<span class="header-section-number">2.2.4</span> 安全資産の導入</h3>
<p><strong>安全資産の購入</strong>についても考える。</p>
<p>安全資産Fのリターンを<span class="math inline">R_F</span>、ポートフォリオPの保有比率を<span class="math inline">w_F</span>，銘柄Aと銘柄Bと安全資産の投資割合をそれぞれ<span class="math inline">w_A, w_B, w_F</span>で表します。</p>
<p>まず銘柄Aと安全資産の2資産からなるポートフォリオを考えます。 各資産への投資割合を<span class="math inline">w_A + w_F = 1, \quad  w_B = 0</span> とする場合を考える。 この安全資産と銘柄AからなるポートフォリオPの(ネット)リターン <span class="math inline">\tilde R_P</span> は， <span class="math display">
\tilde R_{P} = w_{F} R_{F} + w_{A} \tilde R_{A}
</span> となり，このポートフォリオの期待値は， <span class="math display">
\begin{aligned}
\mu_{P} =\mathbb{E}[R_P] &amp;=\mathbb{E}[ w_F R_{F} + w_{A} \tilde{R_A} ]\\
&amp;=w_F R_{F}+w_{A} \mathbb{E}[\tilde{R_A}]\\
&amp;=w_F R_{F}+w_{A} \mu_{A}\\
&amp;=(1-w_A) R_{F}+w_{A} \mu_{A}\\
&amp;=R_{F} - w_{A}R_F + w_A\mu_A\\
&amp;=R_{F} + w_A(\underbrace{\mu_A - R_F}_{\tiny リスクプレミアム})
\end{aligned}
</span></p>
<p>となります。 もちろん安全資産のリターンは定数なので，期待値をとってもそのままです。 <span class="math inline">\mu_{A} - R_{F}</span> はリスク資産である銘柄Aの<strong>リスクプレミアム</strong>を表しています。 通常，リスクのある資産の期待リターンは安全資産のリターンより大きいため，リスクプレミアムは正の値となります。 したがって，リスク資産への投資割合 <span class="math inline">w_A</span> を1単位増加させれば，<span class="math inline">\mathbb{E}[R_P]</span> はリスクプレミアム分増加する</p>
<p>つぎに，ポートフォリオのリスクを表す標準偏差 <span class="math inline">\sigma _P</span> とリターンの関係は次式で表せます。 まず安全資産のリスクはゼロであるため，リスク資産の銘柄Ａを保有する分だけリスクが生じる。</p>
<p><span class="math display">
\begin{aligned}
\sigma_P^2 = \mathbb{V}[R_P]  &amp;= \mathbb{V}[w_FR_F + w_A R_A]\\
&amp;= \mathbb{V}[w_A R_A]\\
&amp;= w_A^2 \mathbb{V}[R_A]\\
&amp;= w_A^2 \sigma _A^2 \\
\sigma _P &amp; = |w_A| \sigma_A
\end{aligned}
</span></p>
<p>空売りを想定する場合<span class="math inline">w_A &lt; 0</span>となるため，標準偏差を求める際に絶対値をとっています。 空売りはない状況（つまり，<span class="math inline">w_A&gt;0</span>）を想定すると，</p>
<p><span class="math display">
\begin{aligned}
\sigma _P = w_A \sigma _A\\
w_A = \frac{\sigma_P}{\sigma _A}
\end{aligned}
</span></p>
<p>のように，リスク資産である銘柄Aへの投資割合<span class="math inline">w_A</span>が，ポートフォリオPとリスク資産Aのリスクの割合で決定されることがわかります。 これを，ポートフォリオの期待リターン<span class="math inline">\mu_P</span>に代入すると、</p>
<p><span class="math display">
\begin{aligned}
\mu_{P} &amp;= R_F + w_A(\mu_A - R_F)\\
&amp; = R_F + \frac{\sigma_P}{\sigma _A}(\mu_A - R_F) \\
&amp;= R_{F}+\frac{\mu_{A}-R_{F}}{\sigma_{A}}\sigma_{P}
\end{aligned}
</span></p>
<p>となり，期待リターン<span class="math inline">\mu_P</span>は，切片が<span class="math inline">R_F</span>，傾きが<span class="math inline">(\mu_A - R_F)/\sigma_A</span>とする<span class="math inline">\sigma_P</span>の線形関数となる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>安全資産の導入 p.68</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># パラメータ設定</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="at">R_F     =</span> <span class="fl">0.01</span>, <span class="co"># 安全資産利子率</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>,  <span class="co"># 銘柄A 期待リターン</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="at">sigma_A =</span> <span class="fl">0.2</span>   <span class="co"># 銘柄A 標準偏差</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># データ生成</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>df_safe <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># 銘柄Aへの投資比率</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="at">wf =</span> <span class="dv">1</span> <span class="sc">-</span> wa, <span class="co"># 安全資産への投資比率</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="at">mu_p    =</span> params<span class="sc">$</span>R_F <span class="sc">+</span> wa <span class="sc">*</span> (params<span class="sc">$</span>mu_A <span class="sc">-</span> params<span class="sc">$</span>R_F),</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="at">sigma_p =</span> <span class="fu">abs</span>(wa) <span class="sc">*</span> params<span class="sc">$</span>sigma_A, <span class="co"># 空売り時は絶対値</span></span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a>    <span class="co"># ラベルの作成</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="at">wa_int =</span> <span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="at">is_label_target =</span> (wa_int <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> wa_int <span class="sc">&lt;=</span> <span class="dv">100</span>) <span class="sc">&amp;</span> (wa_int <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb9-20"><a href="#cb9-20"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(is_label_target,</span>
<span id="cb9-21"><a href="#cb9-21"></a>                    <span class="fu">sprintf</span>(<span class="st">"%g, %g"</span>, wa, wf),</span>
<span id="cb9-22"><a href="#cb9-22"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb9-23"><a href="#cb9-23"></a>  )</span>
<span id="cb9-24"><a href="#cb9-24"></a></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co"># 作図</span></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="fu">ggplot</span>(df_safe, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_safe <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-29"><a href="#cb9-29"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32"></a></span>
<span id="cb9-33"><a href="#cb9-33"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>  mystyle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/safe_asset_allocation-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="chapter02_files/figure-html/safe_asset_allocation-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
</section><section id="資産のポートフォリオ" class="level3" data-number="2.2.5"><h3 data-number="2.2.5" class="anchored" data-anchor-id="資産のポートフォリオ">
<span class="header-section-number">2.2.5</span> 3資産のポートフォリオ</h3>
<p>リスク資産AとB，安全資産Fの3資産に投資するポートフォリオを考える。 ここで，<span class="math inline">w_A + w_B &gt; 0</span>を仮定し，少なくとも少しはリスク資産を保有するケースを考える。 当然だけれど，<span class="math inline">w_A = w_B =0</span>のケースでは，安全資産のみを保有するケースとなり，リスクも無く，リターンも確定している。</p>
<p>3資産A,B,Fへの投資割合をそれぞれ<span class="math inline">w_A</span>，<span class="math inline">w_B</span>,<span class="math inline">w_F</span>とすると， 3資産からなるポートフォリオの期待リターンは次のように計算できる。 <span class="math display">
\begin{aligned}
\mathbb{E}[R_{P}] &amp;= w_FR_F + w_A \mathbb{E} [\tilde R_A] + w_B \mathbb{E}[ \tilde R_B] \\
&amp; =
w_{F} R_{F} + (w_{A} + w_{B}) \left(\frac{w_{A}}{w_{A}+w_{B}} \mathbb{E} [\tilde R_{A}] + \frac{w_{B}}{w_{A}+w_{B}} \mathbb{E}[ \tilde R_{B} ]\right)
\end{aligned}
</span> 安全資産への投資割合<span class="math inline">w_F</span>とリスク資産への投資割合<span class="math inline">w_C = w_A + w_B</span>とまとめて，式を変形させる。 安全資産への投資以外の資金で構築したリスク資産AとBからなるポートフォリオを<span class="math inline">P_C</span>を考えると，<span class="math inline">P_C</span>の期待リターン<span class="math inline">R_C</span>は次のように計算できる。 <span class="math display">
\begin{aligned}
R_{C} &amp;= \frac{w_{A}}{w_{A}+w_{B}} \mathbb{E}[\tilde R_{A}] + \frac{w_{B}}{w_{A}+w_{B}}\mathbb{E}[ \tilde R_{B}]\\
\end{aligned}
</span></p>
<p>安全資産FとポートフォリオCを保有した場合の期待リターンは次式となる。</p>
<p><span class="math display">
\begin{aligned}
\mu_{P} &amp; = \mathbb{E}[w_F R_F + w_A R_A + w_B R_B]\\
&amp;= w_FR_F + w_A \mathbb{E}[R_A] + w_B \mathbb{E}[R_B]\\
&amp;= w_FR_F + (w_A + w_B) \underbrace{ \left( \frac{w_A}{w_A + w_B} \mathbb{E}[R_A] + \frac{w_B}{w_A + w_B} \mathbb{E}[R_B] \right )}_{=w_C\text{とおく}}\\
&amp;= w_F R_F + w_{C}\mu_C
\end{aligned}
</span></p>
<p>安全資産と2つのリスク資産からなるポートフォリオの期待リターンは，安全資産の期待リターンとリスク資産の期待リターンの和となる。</p>
<p>安全資産と2つのリスク資産に投資可能な場合，<span class="math inline">(\mu_P, \sigma _P)</span>の取りうる値を図示できる。テキストの数値例を用いてRで図示してみる。</p>
<ul>
<li>リスク資産Aの期待リターン 0.1，標準偏差 0.2</li>
<li>リスク資産Bの期待リターン 0.2，標準偏差 0.3</li>
<li>安全資産の期待リターンを 0.01</li>
<li>リスク資産AとBの間の相関係数は0.2</li>
<li>安全資産，銘柄A，銘柄Bへの投資割合を0.2，0.3，0.5とするポートフォリオを考える。このポートフォリオの期待リターン<span class="math inline">\mu_P</span>と標準偏差<span class="math inline">\sigma_P</span>は次のようになる。</li>
</ul></section></section><section id="最適ポートフォリオ問題" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="最適ポートフォリオ問題">
<span class="header-section-number">2.3</span> 最適ポートフォリオ問題</h2>
<p>「どのようなポートフォリオが投資家にとって望ましいか」</p>
<p>一般に、投資家はリスクが小さい一方でリターンが大きいポートフォリオを好む。 ここでは，リターンをポートフォリオの期待リターン<span class="math inline">\mu_P</span>，リスクをポートフォリオの標準偏差<span class="math inline">\sigma _P</span>で表し，この2つの変数から構成される平面<span class="math inline">(\mu_P, \sigma_P)</span>上で最適ポートフォリオ問題を分析する。</p>
<section id="効率的フロンティア" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="効率的フロンティア">
<span class="header-section-number">2.3.1</span> 効率的フロンティア</h3>
<p>リスク資産Aと資産Bにのみ投資可能であり，それぞれに異なる割合で投資したポートフォリオDとＥを比較する(以下の図）</p>
<ul>
<li>標準偏差はともに0.25 <span class="math inline">\sigma _D = \sigma _E = 0.25</span>
</li>
<li>Dの方がEよりも期待リターンが大きい，<span class="math inline">\mu _D &gt; \mu _E</span>
</li>
</ul>
<p>つまり，<span class="markp">同じリスク（標準偏差）ならリターン（期待リターン）が高いポートフォリオに投資したほうがいいです</span>。 以下のグラフでいうと、同じリスク(緑のライン上)なら、リターンの高いポートフォリオが望ましい。そのため青い線が効率的フロンティアとなり、点線は選択されないポートフォリオになります。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>効率的フロンティア</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># --- 1. パラメータ設定 ---</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,  <span class="co"># 株式Aの標準偏差</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="at">mu_B    =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,  <span class="co"># 株式Bの標準偏差</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="at">rho     =</span> <span class="fl">0.2</span>   <span class="co"># 相関係数</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co"># --- 2. 最小分散ポートフォリオ (MVP) の算出 ---</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co"># 分散・共分散</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>cov_ab <span class="ot">&lt;-</span> params<span class="sc">$</span>rho <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B</span>
<span id="cb10-11"><a href="#cb10-11"></a>var_a  <span class="ot">&lt;-</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>var_b  <span class="ot">&lt;-</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co"># MVPにおける資産Aのウェイト w_mvp</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co"># 公式: w = (Var(B) - Cov(A,B)) / (Var(A) + Var(B) - 2Cov(A,B))</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>w_mvp <span class="ot">&lt;-</span> (var_b <span class="sc">-</span> cov_ab) <span class="sc">/</span> (var_a <span class="sc">+</span> var_b <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> cov_ab)</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co"># MVPのリターンとリスク（しきい値として使用）</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>mu_mvp    <span class="ot">&lt;-</span> w_mvp <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp) <span class="sc">*</span> params<span class="sc">$</span>mu_B</span>
<span id="cb10-20"><a href="#cb10-20"></a>sigma_mvp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(w_mvp<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> var_a <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> var_b <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> w_mvp <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp) <span class="sc">*</span> cov_ab)</span>
<span id="cb10-21"><a href="#cb10-21"></a></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co"># --- 3. プロット用データの作成 ---</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>df_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-24"><a href="#cb10-24"></a>  <span class="at">w =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb10-25"><a href="#cb10-25"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-26"><a href="#cb10-26"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-27"><a href="#cb10-27"></a>    <span class="at">mu_p =</span> w <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb10-28"><a href="#cb10-28"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>((w <span class="sc">*</span> params<span class="sc">$</span>sigma_A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29"></a>                  ((<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>sigma_B)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>                  <span class="dv">2</span> <span class="sc">*</span> w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> cov_ab),</span>
<span id="cb10-31"><a href="#cb10-31"></a>    <span class="at">frontier_type =</span> <span class="fu">if_else</span>(mu_p <span class="sc">&gt;=</span> mu_mvp, <span class="st">"効率(上部)"</span>, <span class="st">"非効率(下部)"</span>)</span>
<span id="cb10-32"><a href="#cb10-32"></a>  )</span>
<span id="cb10-33"><a href="#cb10-33"></a></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co"># --- 4. プロット作成 ---</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="fu">ggplot</span>(df_plot, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p)) <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb10-37"><a href="#cb10-37"></a>    <span class="fu">aes</span>(<span class="at">color =</span> frontier_type,</span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="at">linetype =</span> frontier_type)</span>
<span id="cb10-39"><a href="#cb10-39"></a>    ) <span class="sc">+</span></span>
<span id="cb10-40"><a href="#cb10-40"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb10-41"><a href="#cb10-41"></a>  <span class="co"># 資産A (緑)</span></span>
<span id="cb10-42"><a href="#cb10-42"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">label =</span> <span class="st">"A"</span>, <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="co"># 資産B (オレンジ)</span></span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-46"><a href="#cb10-46"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">label =</span> <span class="st">"B"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>  <span class="co"># 最小分散ポートフォリオ MVP (黒)</span></span>
<span id="cb10-48"><a href="#cb10-48"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> sigma_mvp, <span class="at">y =</span> mu_mvp, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49"></a></span>
<span id="cb10-50"><a href="#cb10-50"></a>  <span class="co"># C. 見た目の調整</span></span>
<span id="cb10-51"><a href="#cb10-51"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"効率(上部)"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"非効率(下部)"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"効率(上部)"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"非効率(下部)"</span> <span class="ot">=</span> <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb10-53"><a href="#cb10-53"></a></span>
<span id="cb10-54"><a href="#cb10-54"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"効率的フロンティア(2資産)"</span>,</span>
<span id="cb10-55"><a href="#cb10-55"></a>       <span class="at">x =</span> <span class="st">"リスク"</span>,</span>
<span id="cb10-56"><a href="#cb10-56"></a>       <span class="at">y =</span> <span class="st">"期待リターン"</span>,</span>
<span id="cb10-57"><a href="#cb10-57"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb10-58"><a href="#cb10-58"></a>       <span class="at">linetype =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb10-59"><a href="#cb10-59"></a>  mystyle <span class="sc">+</span></span>
<span id="cb10-60"><a href="#cb10-60"></a>  <span class="fu">xlim</span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">0.0</span>, <span class="fl">0.3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/graph_efficient_frontier_modern-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="chapter02_files/figure-html/graph_efficient_frontier_modern-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p><span class="markp">リスク資産AとBに加え、安全資産Fにも投資可能な場合、効率的フロンティアは<strong>直線</strong>になります。</span> この効率的フロンティアは<strong>資本市場線</strong>(Capital Market Line; CML)とも呼ばれます。 資本市場線の傾きは、この金融市場における<strong>リスクとリターンのトレードオフ</strong>を表しているといえます。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<details class="code-fold"><summary>Code</summary><div class="code-with-filename-file">
<pre><strong>3資産の効率的フロンティア（資本市場線）</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># --- 1. パラメータ設定 ---</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>,  <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="at">mu_B    =</span> <span class="fl">0.2</span>,  <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="at">rho     =</span> <span class="fl">0.2</span>,  <span class="at">R_F     =</span> <span class="fl">0.01</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># --- 2. データの作成 ---</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co"># 2-1. リスク資産のみのフロンティア（双曲線）</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>df_frontier <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="at">w =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb11-12"><a href="#cb11-12"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="at">mu_p =</span> w <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>((w <span class="sc">*</span> params<span class="sc">$</span>sigma_A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>sigma_B)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>                   <span class="dv">2</span> <span class="sc">*</span> w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb11-17"><a href="#cb11-17"></a>    <span class="co"># シャープレシオ (接点探索用)</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>    <span class="at">sharpe_ratio =</span> (mu_p <span class="sc">-</span> params<span class="sc">$</span>R_F) <span class="sc">/</span> sigma_p</span>
<span id="cb11-19"><a href="#cb11-19"></a>  )</span>
<span id="cb11-20"><a href="#cb11-20"></a></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co"># 2-2. 接点ポートフォリオ (Tangency Portfolio)</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>tangency_port <span class="ot">&lt;-</span> df_frontier <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(sharpe_ratio, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb11-23"><a href="#cb11-23"></a></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co"># 2-3. 資本市場線 (CML)</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co"># 安全資産(リスク0, リターンRf) から 接点を通って右に伸びる直線</span></span>
<span id="cb11-26"><a href="#cb11-26"></a>df_cml <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-27"><a href="#cb11-27"></a>  <span class="at">sigma_p =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>),</span>
<span id="cb11-28"><a href="#cb11-28"></a>  <span class="at">mu_p    =</span> <span class="fu">c</span>(params<span class="sc">$</span>R_F, params<span class="sc">$</span>R_F <span class="sc">+</span> tangency_port<span class="sc">$</span>sharpe_ratio <span class="sc">*</span> <span class="fl">0.6</span>)</span>
<span id="cb11-29"><a href="#cb11-29"></a>)</span>
<span id="cb11-30"><a href="#cb11-30"></a></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co"># --- 3. プロット作成 ---</span></span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33"></a>  <span class="co"># 【重要】テーマ設定を最初に適用（scale_color_manualなどが上書きされるのを防ぐ）</span></span>
<span id="cb11-34"><a href="#cb11-34"></a>  mystyle <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35"></a></span>
<span id="cb11-36"><a href="#cb11-36"></a>  <span class="co"># A. 資本市場線 (CML) - 新しい効率的フロンティア</span></span>
<span id="cb11-37"><a href="#cb11-37"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_cml, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p, <span class="at">color =</span> <span class="st">"資本市場線"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38"></a></span>
<span id="cb11-39"><a href="#cb11-39"></a>  <span class="co"># B. リスク資産のみのフロンティア - もはや非効率</span></span>
<span id="cb11-40"><a href="#cb11-40"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> df_frontier, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p, <span class="at">color =</span> <span class="st">"リスク資産のみのフロンティア"</span>),</span>
<span id="cb11-41"><a href="#cb11-41"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb11-42"><a href="#cb11-42"></a></span>
<span id="cb11-43"><a href="#cb11-43"></a>  <span class="co"># C. ポイントの描画</span></span>
<span id="cb11-44"><a href="#cb11-44"></a>  <span class="co"># 資産A</span></span>
<span id="cb11-45"><a href="#cb11-45"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">label =</span> <span class="st">"A"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb11-47"><a href="#cb11-47"></a></span>
<span id="cb11-48"><a href="#cb11-48"></a>  <span class="co"># 資産B</span></span>
<span id="cb11-49"><a href="#cb11-49"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">label =</span> <span class="st">"B"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb11-51"><a href="#cb11-51"></a></span>
<span id="cb11-52"><a href="#cb11-52"></a>  <span class="co"># 安全資産</span></span>
<span id="cb11-53"><a href="#cb11-53"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> params<span class="sc">$</span>R_F, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-54"><a href="#cb11-54"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> params<span class="sc">$</span>R_F, <span class="at">label =</span> <span class="st">"安全資産(F)"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb11-55"><a href="#cb11-55"></a></span>
<span id="cb11-56"><a href="#cb11-56"></a>  <span class="co"># 接点ポートフォリオ</span></span>
<span id="cb11-57"><a href="#cb11-57"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> tangency_port<span class="sc">$</span>sigma_p, <span class="at">y =</span> tangency_port<span class="sc">$</span>mu_p, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> tangency_port<span class="sc">$</span>sigma_p, <span class="at">y =</span> tangency_port<span class="sc">$</span>mu_p,</span>
<span id="cb11-59"><a href="#cb11-59"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"接点ポートフォリオ</span><span class="sc">\n</span><span class="st">(w="</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, tangency_port<span class="sc">$</span>w), <span class="st">")"</span>),</span>
<span id="cb11-60"><a href="#cb11-60"></a>           <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">lineheight =</span> <span class="fl">0.9</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61"></a></span>
<span id="cb11-62"><a href="#cb11-62"></a>  <span class="co"># D. 色と凡例の設定</span></span>
<span id="cb11-63"><a href="#cb11-63"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb11-64"><a href="#cb11-64"></a>    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb11-65"><a href="#cb11-65"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"資本市場線"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"リスク資産のみのフロンティア"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb11-66"><a href="#cb11-66"></a>  ) <span class="sc">+</span></span>
<span id="cb11-67"><a href="#cb11-67"></a></span>
<span id="cb11-68"><a href="#cb11-68"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"安全資産を含む場合の効率的フロンティア"</span>,</span>
<span id="cb11-69"><a href="#cb11-69"></a>       <span class="at">subtitle =</span> <span class="st">"赤い直線が新たな効率的フロンティアとなる"</span>,</span>
<span id="cb11-70"><a href="#cb11-70"></a>       <span class="at">x =</span> <span class="st">"リスク (標準偏差)"</span>,</span>
<span id="cb11-71"><a href="#cb11-71"></a>       <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb11-72"><a href="#cb11-72"></a></span>
<span id="cb11-73"><a href="#cb11-73"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb11-74"><a href="#cb11-74"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="fl">0.6</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/graph_cml_final-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="chapter02_files/figure-html/graph_cml_final-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>安全資産が利用可能な場合、投資家は「安全資産」と「任意のリスク資産ポートフォリオ」を組み合わせることができます。 先ほどの式で確認した通り、安全資産とあるポートフォリオを組み合わせると、リスク・リターン平面上では直線が描かれます。 では、投資家はどのリスク資産ポートフォリオと安全資産を組み合わせるべきでしょうか？</p>
<p>図の紫の点（安全資産 <span class="math inline">R_F</span>）からスタートします。 そこから、青い点線（リスク資産のみのフロンティア）上の任意の点に向けて直線を引くことができます。 投資家は、同じリスクならより高いリターンを好むため、傾きが最も急になる直線を選ぼうとします。 その直線とは、安全資産の点から伸び、リスク資産のフロンティアに接する直線（赤い実線）となります。 この接点となるポートフォリオを<strong>接点ポートフォリオ</strong>(Tangency Portfolio)と呼びます。 この赤い直線上の組み合わせは、青い曲線上のどの点よりも（接点を除いて）左上に位置するため、より効率的です。 したがって、安全資産が存在する場合の効率的フロンティアはこの<strong>直線（資本市場線）</strong>となります。</p>
<!-- 以下では，各資産のパラメータを変更したら，効率的フロンティアや接点ポートフォリオがどのように変化するかを確認できるインタラクティブなグラフを示します。 -->
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource {shinylive-r} number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1"><a href="#cb12-1"></a>#| echo: false</span>
<span id="cb12-2"><a href="#cb12-2"></a>#| eval: false</span>
<span id="cb12-3"><a href="#cb12-3"></a>#| code-fold: true</span>
<span id="cb12-4"><a href="#cb12-4"></a>#| standalone: true</span>
<span id="cb12-5"><a href="#cb12-5"></a>#| viewerHeight: 600</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a># UI定義</span>
<span id="cb12-8"><a href="#cb12-8"></a>ui &lt;- fluidPage(</span>
<span id="cb12-9"><a href="#cb12-9"></a>  # 講義資料の中に埋め込むため、タイトルは省略またはh4程度に留める</span>
<span id="cb12-10"><a href="#cb12-10"></a>  h4("【シミュレーション】パラメータを動かしてフロンティアの変化を確認しよう"),</span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a>  sidebarLayout(</span>
<span id="cb12-13"><a href="#cb12-13"></a>    sidebarPanel(</span>
<span id="cb12-14"><a href="#cb12-14"></a>      width = 4, # サイドバーの幅調整</span>
<span id="cb12-15"><a href="#cb12-15"></a>      h5("資産A (緑)"),</span>
<span id="cb12-16"><a href="#cb12-16"></a>      sliderInput("mu_a", "期待リターン", min = -0.1, max = 0.5, value = 0.1, step = 0.01),</span>
<span id="cb12-17"><a href="#cb12-17"></a>      sliderInput("sigma_a", "標準偏差", min = 0.05, max = 0.5, value = 0.2, step = 0.01),</span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a>      h5("資産B (橙)"),</span>
<span id="cb12-20"><a href="#cb12-20"></a>      sliderInput("mu_b", "期待リターン", min = -0.1, max = 0.5, value = 0.2, step = 0.01),</span>
<span id="cb12-21"><a href="#cb12-21"></a>      sliderInput("sigma_b", "標準偏差", min = 0.05, max = 0.5, value = 0.3, step = 0.01),</span>
<span id="cb12-22"><a href="#cb12-22"></a></span>
<span id="cb12-23"><a href="#cb12-23"></a>      hr(),</span>
<span id="cb12-24"><a href="#cb12-24"></a>      h5("市場環境"),</span>
<span id="cb12-25"><a href="#cb12-25"></a>      sliderInput("rho", "相関係数 (ρ)", min = -1, max = 1, value = 0.2, step = 0.1),</span>
<span id="cb12-26"><a href="#cb12-26"></a>      sliderInput("rf", "無リスク金利 (Rf)", min = 0, max = 0.15, value = 0.01, step = 0.005)</span>
<span id="cb12-27"><a href="#cb12-27"></a>    ),</span>
<span id="cb12-28"><a href="#cb12-28"></a></span>
<span id="cb12-29"><a href="#cb12-29"></a>    mainPanel(</span>
<span id="cb12-30"><a href="#cb12-30"></a>      width = 8,</span>
<span id="cb12-31"><a href="#cb12-31"></a>      plotOutput("frontierPlot", height = "500px"),</span>
<span id="cb12-32"><a href="#cb12-32"></a>      wellPanel(</span>
<span id="cb12-33"><a href="#cb12-33"></a>        style = "padding: 10px; font-size: 0.9em;",</span>
<span id="cb12-34"><a href="#cb12-34"></a>        textOutput("tangencyInfo")</span>
<span id="cb12-35"><a href="#cb12-35"></a>      )</span>
<span id="cb12-36"><a href="#cb12-36"></a>    )</span>
<span id="cb12-37"><a href="#cb12-37"></a>  )</span>
<span id="cb12-38"><a href="#cb12-38"></a>)</span>
<span id="cb12-39"><a href="#cb12-39"></a></span>
<span id="cb12-40"><a href="#cb12-40"></a># Serverロジック定義</span>
<span id="cb12-41"><a href="#cb12-41"></a>server &lt;- function(input, output) {</span>
<span id="cb12-42"><a href="#cb12-42"></a></span>
<span id="cb12-43"><a href="#cb12-43"></a>  # テーマ設定（Shiny内で確実に読み込むためここで再定義またはリスト化）</span>
<span id="cb12-44"><a href="#cb12-44"></a>  my_theme &lt;- list(</span>
<span id="cb12-45"><a href="#cb12-45"></a>    theme_economist_white(base_family = "HiraKakuProN-W3"),</span>
<span id="cb12-46"><a href="#cb12-46"></a>    scale_colour_economist(),</span>
<span id="cb12-47"><a href="#cb12-47"></a>    theme(</span>
<span id="cb12-48"><a href="#cb12-48"></a>      text = element_text(size = 12),</span>
<span id="cb12-49"><a href="#cb12-49"></a>      legend.position = "bottom",</span>
<span id="cb12-50"><a href="#cb12-50"></a>      legend.title = element_blank()</span>
<span id="cb12-51"><a href="#cb12-51"></a>    )</span>
<span id="cb12-52"><a href="#cb12-52"></a>  )</span>
<span id="cb12-53"><a href="#cb12-53"></a></span>
<span id="cb12-54"><a href="#cb12-54"></a>  # リアクティブなデータ生成</span>
<span id="cb12-55"><a href="#cb12-55"></a>  data_reactive &lt;- reactive({</span>
<span id="cb12-56"><a href="#cb12-56"></a>    mu_a    &lt;- input$mu_a</span>
<span id="cb12-57"><a href="#cb12-57"></a>    sigma_a &lt;- input$sigma_a</span>
<span id="cb12-58"><a href="#cb12-58"></a>    mu_b    &lt;- input$mu_b</span>
<span id="cb12-59"><a href="#cb12-59"></a>    sigma_b &lt;- input$sigma_b</span>
<span id="cb12-60"><a href="#cb12-60"></a>    rho     &lt;- input$rho</span>
<span id="cb12-61"><a href="#cb12-61"></a>    rf      &lt;- input$rf</span>
<span id="cb12-62"><a href="#cb12-62"></a></span>
<span id="cb12-63"><a href="#cb12-63"></a>    # フロンティア計算</span>
<span id="cb12-64"><a href="#cb12-64"></a>    df_frontier &lt;- tibble(</span>
<span id="cb12-65"><a href="#cb12-65"></a>      w = seq(-1, 2, by = 0.005)</span>
<span id="cb12-66"><a href="#cb12-66"></a>    ) |&gt;</span>
<span id="cb12-67"><a href="#cb12-67"></a>      mutate(</span>
<span id="cb12-68"><a href="#cb12-68"></a>        mu_p = w * mu_a + (1 - w) * mu_b,</span>
<span id="cb12-69"><a href="#cb12-69"></a>        sigma_p = sqrt((w * sigma_a)^2 + ((1 - w) * sigma_b)^2 +</span>
<span id="cb12-70"><a href="#cb12-70"></a>                         2 * w * (1 - w) * rho * sigma_a * sigma_b),</span>
<span id="cb12-71"><a href="#cb12-71"></a>        sharpe_ratio = (mu_p - rf) / sigma_p</span>
<span id="cb12-72"><a href="#cb12-72"></a>      )</span>
<span id="cb12-73"><a href="#cb12-73"></a></span>
<span id="cb12-74"><a href="#cb12-74"></a>    # 接点ポートフォリオ</span>
<span id="cb12-75"><a href="#cb12-75"></a>    tangency_port &lt;- df_frontier |&gt; slice_max(sharpe_ratio, n = 1)</span>
<span id="cb12-76"><a href="#cb12-76"></a></span>
<span id="cb12-77"><a href="#cb12-77"></a>    # 資本市場線</span>
<span id="cb12-78"><a href="#cb12-78"></a>    max_sigma &lt;- max(0.6, tangency_port$sigma_p * 1.5)</span>
<span id="cb12-79"><a href="#cb12-79"></a>    df_cml &lt;- tibble(</span>
<span id="cb12-80"><a href="#cb12-80"></a>      sigma_p = c(0, max_sigma),</span>
<span id="cb12-81"><a href="#cb12-81"></a>      mu_p    = c(rf, rf + tangency_port$sharpe_ratio * max_sigma)</span>
<span id="cb12-82"><a href="#cb12-82"></a>    )</span>
<span id="cb12-83"><a href="#cb12-83"></a></span>
<span id="cb12-84"><a href="#cb12-84"></a>    list(frontier = df_frontier, tangency = tangency_port, cml = df_cml,</span>
<span id="cb12-85"><a href="#cb12-85"></a>         p = list(mu_a=mu_a, sigma_a=sigma_a, mu_b=mu_b, sigma_b=sigma_b, rf=rf))</span>
<span id="cb12-86"><a href="#cb12-86"></a>  })</span>
<span id="cb12-87"><a href="#cb12-87"></a></span>
<span id="cb12-88"><a href="#cb12-88"></a>  # プロット描画</span>
<span id="cb12-89"><a href="#cb12-89"></a>  output$frontierPlot &lt;- renderPlot({</span>
<span id="cb12-90"><a href="#cb12-90"></a>    dat &lt;- data_reactive()</span>
<span id="cb12-91"><a href="#cb12-91"></a>    p   &lt;- dat$p</span>
<span id="cb12-92"><a href="#cb12-92"></a></span>
<span id="cb12-93"><a href="#cb12-93"></a>    ggplot() +</span>
<span id="cb12-94"><a href="#cb12-94"></a>      my_theme +</span>
<span id="cb12-95"><a href="#cb12-95"></a>      # CML</span>
<span id="cb12-96"><a href="#cb12-96"></a>      geom_line(data = dat$cml, aes(x = sigma_p, y = mu_p, color = "資本市場線"), linewidth = 1.2) +</span>
<span id="cb12-97"><a href="#cb12-97"></a>      # フロンティア</span>
<span id="cb12-98"><a href="#cb12-98"></a>      geom_path(data = dat$frontier, aes(x = sigma_p, y = mu_p, color = "効率的フロンティア"),</span>
<span id="cb12-99"><a href="#cb12-99"></a>                linewidth = 1, linetype = "dashed") +</span>
<span id="cb12-100"><a href="#cb12-100"></a>      # ポイント</span>
<span id="cb12-101"><a href="#cb12-101"></a>      annotate("point", x = p$sigma_a, y = p$mu_a, color = "green", size = 4) +</span>
<span id="cb12-102"><a href="#cb12-102"></a>      annotate("text",  x = p$sigma_a, y = p$mu_a, label = "A", vjust = -1.5, fontface = "bold") +</span>
<span id="cb12-103"><a href="#cb12-103"></a>      annotate("point", x = p$sigma_b, y = p$mu_b, color = "orange", size = 4) +</span>
<span id="cb12-104"><a href="#cb12-104"></a>      annotate("text",  x = p$sigma_b, y = p$mu_b, label = "B", vjust = -1.5, fontface = "bold") +</span>
<span id="cb12-105"><a href="#cb12-105"></a>      annotate("point", x = 0, y = p$rf, color = "purple", size = 4) +</span>
<span id="cb12-106"><a href="#cb12-106"></a>      annotate("text",  x = 0, y = p$rf, label = "Rf", hjust = -0.3, fontface = "bold") +</span>
<span id="cb12-107"><a href="#cb12-107"></a>      # 接点</span>
<span id="cb12-108"><a href="#cb12-108"></a>      annotate("point", x = dat$tangency$sigma_p, y = dat$tangency$mu_p, color = "black", shape = 8, size = 5) +</span>
<span id="cb12-109"><a href="#cb12-109"></a>      annotate("text",  x = dat$tangency$sigma_p, y = dat$tangency$mu_p,</span>
<span id="cb12-110"><a href="#cb12-110"></a>               label = "接点", vjust = 1.5, fontface = "bold") +</span>
<span id="cb12-111"><a href="#cb12-111"></a></span>
<span id="cb12-112"><a href="#cb12-112"></a>      scale_color_manual(values = c("資本市場線" = "red", "効率的フロンティア" = "blue")) +</span>
<span id="cb12-113"><a href="#cb12-113"></a>      labs(x = "リスク (標準偏差)", y = "期待リターン") +</span>
<span id="cb12-114"><a href="#cb12-114"></a>      xlim(0, 0.7) + ylim(-0.05, 0.5)</span>
<span id="cb12-115"><a href="#cb12-115"></a>  })</span>
<span id="cb12-116"><a href="#cb12-116"></a></span>
<span id="cb12-117"><a href="#cb12-117"></a>  # 数値情報</span>
<span id="cb12-118"><a href="#cb12-118"></a>  output$tangencyInfo &lt;- renderText({</span>
<span id="cb12-119"><a href="#cb12-119"></a>    t &lt;- data_reactive()$tangency</span>
<span id="cb12-120"><a href="#cb12-120"></a>    sprintf(</span>
<span id="cb12-121"><a href="#cb12-121"></a>      "【接点ポートフォリオ】 期待リターン: %.2f%%, リスク: %.2f%% (シャープレシオ: %.4f) | 構成比: A %.1f%% : B %.1f%%",</span>
<span id="cb12-122"><a href="#cb12-122"></a>      t$mu_p * 100, t$sigma_p * 100, t$sharpe_ratio,</span>
<span id="cb12-123"><a href="#cb12-123"></a>      t$w * 100, (1 - t$w) * 100</span>
<span id="cb12-124"><a href="#cb12-124"></a>    )</span>
<span id="cb12-125"><a href="#cb12-125"></a>  })</span>
<span id="cb12-126"><a href="#cb12-126"></a>}</span>
<span id="cb12-127"><a href="#cb12-127"></a></span>
<span id="cb12-128"><a href="#cb12-128"></a># アプリの起動</span>
<span id="cb12-129"><a href="#cb12-129"></a>shinyApp(ui = ui, server = server)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="投資家のリスク回避度と最適ポートフォリオ" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="投資家のリスク回避度と最適ポートフォリオ">
<span class="header-section-number">2.3.2</span> 投資家のリスク回避度と最適ポートフォリオ</h3>
<p>効率的フロンティアのうち、どの点が投資家の最適ポートフォリオになるのか，について考える。 そのためには投資家のリスク・リターンのトレードオフに関する<strong>選好(preference)</strong>の特徴，つまり<strong>リスクの回避度</strong>の情報が必要となる。 <span class="math inline">(\mu_P,\rho_p)</span>平面上でそれを描く方法の一つが<strong>無差別曲線</strong>(indifference curve)である。 <strong>無差別曲線</strong>とは，投資家の効用(utility)が<strong>一定</strong>となるリスクとリターンの組み合わせを描いた曲線をいう。つまり同じ効用水準を達成できるリスクとリターンの組み合わせを表現した曲線である。</p>
<section id="効用関数の例" class="level4" data-number="2.3.2.1"><h4 data-number="2.3.2.1" class="anchored" data-anchor-id="効用関数の例">
<span class="header-section-number">2.3.2.1</span> 効用関数の例</h4>
<p>以下では，財<span class="math inline">x</span>と<span class="math inline">y</span>を消費したときの効用<span class="math inline">U</span>を図示している。この消費者の効用関数は<span class="math inline">U(x,y) = x^{\frac 25} \times y^{\frac 35}</span>としている。</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">library</span>(Rsolnp)</span>
<span id="cb13-2"><a href="#cb13-2"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>u <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {x<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> y<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>)} <span class="co">#効用関数を定義</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>U <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, u) <span class="co">#outer()はx_1,x_2に対応したf(x_1,x_2)の値を行列で返す</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="fu">persp</span>(x, y, U,</span>
<span id="cb13-7"><a href="#cb13-7"></a>      <span class="at">theta =</span> <span class="dv">30</span>, <span class="co"># 横回転の角度</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>      <span class="at">phi =</span> <span class="dv">30</span>, <span class="co"># 縦回転の角度</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>      <span class="at">ticktype =</span> <span class="st">"simple"</span>, <span class="co"># 線の種類</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>      <span class="at">lwd =</span> <span class="fl">0.5</span>, <span class="co"># 線の太さ</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>      <span class="at">col =</span> F,</span>
<span id="cb13-12"><a href="#cb13-12"></a>      <span class="at">border =</span> <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/utility_function-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="chapter02_files/figure-html/utility_function-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># データ作成</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>u <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {x<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> y<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>)}</span>
<span id="cb14-5"><a href="#cb14-5"></a>U <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, u)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># 色の準備（高さに応じて色を変える処理）</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>nrz <span class="ot">&lt;-</span> <span class="fu">nrow</span>(U)</span>
<span id="cb14-9"><a href="#cb14-9"></a>ncz <span class="ot">&lt;-</span> <span class="fu">ncol</span>(U)</span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co"># グラデーションパレットを作成 (青→緑→黄)</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>jet.colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>))</span>
<span id="cb14-12"><a href="#cb14-12"></a>nbcol <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>color <span class="ot">&lt;-</span> <span class="fu">jet.colors</span>(nbcol)</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co"># 高さ(z)を色のインデックスに変換</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>zfacet <span class="ot">&lt;-</span> U[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> U[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span>ncz] <span class="sc">+</span> U[<span class="sc">-</span>nrz, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> U[<span class="sc">-</span>nrz, <span class="sc">-</span>ncz]</span>
<span id="cb14-16"><a href="#cb14-16"></a>facetcol <span class="ot">&lt;-</span> <span class="fu">cut</span>(zfacet, nbcol)</span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co"># 描画</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="fu">persp</span>(x, y, U,</span>
<span id="cb14-20"><a href="#cb14-20"></a>      <span class="at">theta =</span> <span class="dv">45</span>, <span class="at">phi =</span> <span class="dv">30</span>,</span>
<span id="cb14-21"><a href="#cb14-21"></a>      <span class="at">col =</span> color[facetcol], <span class="co"># 計算した色を指定</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>      <span class="at">shade =</span> <span class="fl">0.2</span>,           <span class="co"># 陰影</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>      <span class="at">border =</span> <span class="cn">NA</span>,           <span class="co"># 枠線なしで滑らかに</span></span>
<span id="cb14-24"><a href="#cb14-24"></a>      <span class="at">ticktype =</span> <span class="st">"detailed"</span>,</span>
<span id="cb14-25"><a href="#cb14-25"></a>      <span class="at">xlab =</span> <span class="st">"財 x"</span>, <span class="at">ylab =</span> <span class="st">"財 y"</span>, <span class="at">zlab =</span> <span class="st">"効用 U"</span>,</span>
<span id="cb14-26"><a href="#cb14-26"></a>      <span class="at">main =</span> <span class="st">"効用関数の3Dプロット"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="chapter02_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
<p>この立体図を等高線を使って表現したものが以下の図である。 青いラインは予算制約であり、予算の範囲内で購入可能な財の組み合わせを意味している。つまり、この予算制約と無差別曲線が接する点が、予算内で達成可能な最も高い効用水準を表している。</p>
<p>無リスク利子率が10%で，リスクプレミアムが5％，βが1.2の場合の期待リターンは，<span class="math inline">R_F + \beta \times (R_M - R_F) = 0.1 + 1.2 \times 0.05 = 0.16</span>となる。このときの無差別曲線は，<span class="math inline">U = 0.16</span>となるような点を結んだ曲線となる。</p>
<div class="cell" data-layout-align="center" data-fig-aligned="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">contour</span>(x, y, U, <span class="at">method =</span> <span class="st">"edge"</span>, <span class="at">labcex =</span> <span class="dv">1</span>,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">b =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="co">#予算制約線</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="fu">points</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">pch =</span> <span class="dv">16</span>) <span class="co">#最適消費点</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/indifference_curve-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="無差別曲線と消費可能集合"><img src="chapter02_files/figure-html/indifference_curve-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="2700" alt="無差別曲線と消費可能集合"></a></p>
</figure>
</div>
<figcaption>無差別曲線と消費可能集合</figcaption></figure>
</div>
</div>
</div>
<p>リスクとリターンの無差別曲線</p>
<!-- ![無差別曲線と効率的フロンティアに基づく最適ポート フォリオの決定](img/KM_fig_2-12.jpg) -->
<p>複数ポートフォリオを比べるとき，この図の左上のものほど高リターン低リスクに対応するので、より高い効用水準が実現する。 また無差別曲線の<strong>局所的な傾き</strong>は、その投資家が追加的なリスクを引き受けるうえで要求するリスクプレミアムを表す。 リスク回避的な投資家ほど，リスクを1単位負担する際に，より大きなリスクプレミアムを要求するので、傾きは大きくなる。 つまり，1単位リスクを負担する代わりに欲しいリターンの額が大きくなるほど，傾きが大きくなる。</p>
<p>無差別曲線と効率的フロンティアが接する点が、この投資家にとっての最適ポートフォリオとなる。 投資可能なポートフォリオの範囲で、最も左上の無差別曲線を実現するのが接点となる。 どの点が最適ポートフォリオとして選ばれるかは個々の投資家の無差別曲線の形状(リスク回避度)に依存する。最適ポートフォリオにおいて、無差別曲線と効率的フロンティアの局所的な傾きは一致(接線だから当然)するため、その投資家が要求するリスクプレミアムがちょうど実現されている。</p>
<p>上図の場合，この投資家の最適ポートフォリオは<span class="math inline">(w_F,w_{tan})\approx(0.29,0.71)</span>の比率で構成される。</p>
<p>接点ポートフォリオは銘柄Aに47％、銘柄Bに53％投資するポートフォリオだったので、最適保有比率は、<span class="math inline">(w_F,w_A,w_B)\approx(0.29,0.33,0.38)</span>と書き換えられる。</p>
</section></section><section id="トービンの分離定理" class="level3" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored" data-anchor-id="トービンの分離定理">
<span class="header-section-number">2.3.3</span> トービンの分離定理</h3>
<p>安全資産が投資可能な場合の最適ポートフォリオ問題を考える。</p>
<ol type="1">
<li>接点ポートフォリオを求め、リスク資産同士の相対的な保有比率を求める。</li>
<li>投資家ごとのリスク回避度に応じて安全資産と接点ポートフォリオの最適保有比率の決定</li>
</ol>
<p>1は各投資家で共通している。 いったん接点ポートフォリオを求めてしまえば、他の投資家はその情報を用いて2を考えればよい。</p>
<p>最適ポートフォリオ問題を2段階に分離できるという命題は、<strong>トービンの分離定理</strong>(又は二基金分離定理)と呼ばれている。</p>
</section></section><section id="capm" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="capm">
<span class="header-section-number">2.4</span> CAPM</h2>
<p>金融市場全体の均衡を考えるために、<strong>資本資産価格モデル</strong>(Capital Asset Pricing Model; CAPM)を学習します。</p>
<section id="仮定の確認" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="仮定の確認">
<span class="header-section-number">2.4.1</span> 仮定の確認</h3>
<ul>
<li>
<strong>選好</strong> : ポートフォリオを<strong>期待値と標準偏差の基準で評価</strong>
</li>
<li>
<strong>取引コスト</strong> : 取引コストは存在せず、空売りも自由</li>
<li>
<strong>流動性</strong> : どれだけ売買しても証券の価格は不変</li>
<li>
<strong>情報集合</strong> : みんな同じ情報を共有</li>
</ul>
<p>上記の仮定を満たす市場のことを、<strong>完全資本市場</strong>(完全市場: perfect market)と呼びます。 空想上の市場ですが、理論構築の大事な出発点です。</p>
</section><section id="capmの第一命題" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="capmの第一命題">
<span class="header-section-number">2.4.2</span> CAPMの第一命題</h3>
<p>先の仮定の下で、安全資産が投資可能なとき、全ての投資家の最適ポートフォリオ問題に対してトービンの分離定理を応用することができます。 全ての投資家は「安全資産」と「接点ポートフォリオ」のみに投資し、危険資産に限定すれば全員が同じ構成比率のポートフォリオ（接点ポートフォリオ）を保有します。 金融市場全体の均衡を議論するうえで、市場にその資産が供給されている以上、誰かがその最適ポートフォリオの一部として保有しているはずです。 すなわち、需要と供給が一致している点がポイントです。</p>
<p>以上の議論をよりフォーマルに述べるために、市場ポートフォリオを導入します。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>市場ポートフォリオ
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>市場ポートフォリオ (market portfolio)</strong> とは、市場に存在する全ての危険資産を時価総額比率で保有したポートフォリオをいう。厳密には、リスク資産には株式や債券に代表される金融資産の他、不動産や貴金属などの実物資産も含まれるが、実用上はTOPIXやS&amp;P500といった株価指数と同一視されることが多い。</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>CAPMの第一命題
</div>
</div>
<div class="callout-body-container callout-body">
<p>市場ポートフォリオは接点ポートフォリオと一致し、効率的フロンティア（資本市場線）上に位置する。</p>
</div>
</div>
<p>投資家は市場ポートフォリオに投資するとき、<span class="math inline">\sigma_M</span> のリスクを背負う見返りとして、<span class="math inline">R_F</span> に加えて <span class="math inline">\mu_M-R_F</span> だけ追加的な報酬を期待します。 この追加的な報酬を<strong>市場リスクプレミアム</strong> (market risk premium) といいます。したがってこの命題の下では、資本市場線を市場リスクプレミアム <span class="math inline">(\mu_M-R_F)</span> を利用して、以下のように表せます。</p>
<p><span class="math display">
\mu_P = R_F + \frac{\mu_M - R_F}{\sigma_M} \sigma_P
</span></p>
<!-- ![CAPM](img/KM_fig_2-13.png) -->
<p>前の章で用いたパラメータをそのまま考えます。 接点ポートフォリオの保有比率は概ね47%を銘柄Aに、53%を銘柄Bに投資する結果となりました。CAPMの第一命題によると、均衡した市場における銘柄AとBの時価総額比率は約0.47対0.53になっていなければなりません。 この命題に従えば、投資家は各銘柄の期待リターンや分散から接点ポートフォリオを計算する必要はなく、単に時価総額加重で市場ポートフォリオを保有すればよいことになります。</p>
<ul>
<li>
<strong>パッシブ運用：</strong> 幅広い銘柄に分散投資し、市場平均と同じようなパフォーマンスを目指す運用手法。</li>
<li>
<strong>アクティブ運用：</strong> 市場平均を上回るパフォーマンスを目指し、投資銘柄を絞ったり、投資比率を工夫したりする運用方法。</li>
</ul>
<p>任意のポートフォリオの収益性を測る指標として、<strong>シャープ・レシオ</strong>が提唱されています。シャープ・レシオは追加的なリスク・テイクによってどれだけリスクプレミアムを改善できるのかを表す指標です。CAPMの第一命題によると、市場ポートフォリオはシャープ・レシオを最大化するという意味で最も効率的なポートフォリオであり、資本市場線の傾き <span class="math inline">\frac{\mu_M - R_F}{\sigma_M}</span> は市場ポートフォリオのシャープ・レシオと一致します。</p>
<p><span class="math display">
\text{Sharpe Ratio} = \frac{\mu_P-R_F}{\sigma_P}
</span></p>
</section><section id="capmの第二命題" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="capmの第二命題">
<span class="header-section-number">2.4.3</span> CAPMの第二命題</h3>
<p>第二命題は個々の資産のリスクとリターンのトレードオフを数式で表現したものです。 ある証券に投資するときのリスクと、その証券に投資するときの期待リターンとの関係を知ることができるようになります。</p>
<p>各投資家が証券 <span class="math inline">i</span> を追加的に保有する際、重要となるのは市場ポートフォリオとの相関です。分散が大きい資産であっても、市場ポートフォリオと負に相関していれば、その資産を追加的に保有することでポートフォリオ全体のリスクは低減されます。CAPMの第二命題は、この相関を以下の<strong>マーケット・ベータ</strong>として定量化します。 （※ <span class="math inline">R_i</span> は証券 <span class="math inline">i</span> のリターン、<span class="math inline">R_M</span> は市場ポートフォリオのリターン）</p>
<p>この <span class="math inline">\beta_i</span> は市場ポートフォリオのリスクを1としてベンチマーク化し、その証券のリスクがベンチマークの1を上回るか下回るかを測るものです。<span class="math inline">\beta_i</span> が大きいほど証券 <span class="math inline">i</span> は投資家にとってリスク（システマティック・リスク）が大きいことを意味します。CAPMの世界では、証券 <span class="math inline">i</span> のリスクはその証券のリターンの標準偏差ではなく、この <span class="math inline">\beta_i</span> によって測られます。</p>
<p><span class="math display">
\beta_i = \frac{\mathbb{Cov}[R_i, R_M]}{\mathbb{Var}[R_M]}
</span></p>
<p>金融市場全体が均衡しているには、リスクの高い証券はその分だけ期待リターンも高くなければなりません。 もし <span class="math inline">\beta_i</span> が低いにもかかわらず期待リターンが高い証券があるなら、投資家は市場ポートフォリオから離れてその証券をさらに買い増しするインセンティブを持ちます。 その結果、市場価格が上がり、期待リターンが下がるため、最終的に <span class="math inline">\beta_i</span> に応じた期待リターンが均衡で実現されます。</p>
<p>これまでは市場リスクプレミアムを <span class="math inline">\mu_M - R_F</span> と表記していましたが、以後ではより一般的な <span class="math inline">\mathbb{E}[R_M] - R_F</span> と表記します。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>CAPMの第二命題
</div>
</div>
<div class="callout-body-container callout-body">
<p>各証券のリスクプレミアムは、その証券のマーケット・ベータに比例する。 この式は、証券 <span class="math inline">i</span> のリスクプレミアム <span class="math inline">\mathbb{E}[R_i]-R_F</span> を、<span class="math inline">\beta_i</span> と市場リスクプレミアム <span class="math inline">\mathbb{E}[R_M]-R_F</span> に分解している。</p>
</div>
</div>
<p><span class="math display">
\begin{aligned}
\mathbb{E}[R_i]-R_F = \beta_i (\mathbb{E}[R_M] - R_F)\\
\text{ただし、 } \beta_i = \frac{\mathbb{Cov}[R_i,R_M]}{\mathbb{Var}[R_M]}
\end{aligned}
</span></p>
<p>通常、市場リスクプレミアムは正の値をとるので、CAPMの第二命題によると、個々の証券のリスクプレミアムは <span class="math inline">\beta_i</span> に関して線形に増加します。 <span class="math inline">\beta_i</span> はあくまで市場ポートフォリオとの相関でリスクを定量化しているのがポイントです。 いくら個々の証券の分散（リスク）が大きくても、それが市場ポートフォリオと相関しない固有リスクであれば、リスクプレミアムには反映されません。 期待値をとる前の <span class="math inline">R_i</span> を分解して確認します。</p>
<p><span class="math display">
R_i = R_F + \beta_i (R_M - R_F) + \varepsilon_i
</span></p>
<p>ここで <span class="math inline">\varepsilon_i</span> は期待値ゼロで <span class="math inline">R_M</span> と相関しない誤差項です。</p>
<p><span class="math display">
\mathbb{E}[\varepsilon_i] = 0, \qquad \mathbb{Cov}[\varepsilon_i, R_M] = 0
</span></p>
<p>分散を計算すると以下のようになります。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{Var}[R_i] &amp;= \mathbb{Var}[\beta_i R_M + \varepsilon_i]\\
&amp; = \beta_i^2 \mathbb{Var}[R_M] + \mathbb{Var}[\varepsilon_i] + \underbrace{2\mathbb{Cov}[\beta_i R_M, \varepsilon_i]}_{\tiny =0}\\
&amp; = \underbrace{\beta_i^2 \mathbb{Var}[R_M]}_{\tiny 市場ポートフォリオとの相関による寄与分} + \underbrace{\mathbb{Var}[\varepsilon_i]}_{\tiny 誤差項による寄与分}
\end{aligned}
</span></p>
<p><span class="math inline">R_i</span> の分散は、市場ポートフォリオとの相関による寄与分（システマティック・リスク）と誤差項による寄与分（固有リスク）に分解できます。 誤差項の分散が大きければその分だけ <span class="math inline">R_i</span> の分散も大きくなりますが、証券 <span class="math inline">i</span> のリスクプレミアムは <span class="math inline">\beta_i(\mathbb{E}[R_M]-R_F)</span> のままで変化はありません。つまり、分散投資によって消去可能な固有リスクに対しては、市場は報酬（プレミアム）を与えないのです。</p>
</section><section id="証券市場線" class="level3" data-number="2.4.4"><h3 data-number="2.4.4" class="anchored" data-anchor-id="証券市場線">
<span class="header-section-number">2.4.4</span> 証券市場線</h3>
<p>安全資産と複数の危険資産が投資可能な場合、投資家の最適ポートフォリオは資本市場線上の1点となります（図2.14 左図）。 一方、CAPMの第二命題が示唆するように、各証券のリスク（ベータ）とリターンとの関係は、右上がりの直線となります（図2.14 右図）。 縦軸に各証券の期待リターン、横軸に各証券のリスクを表すマーケット・ベータをとると、CAPMが完全に成立する世界では全ての資産が一直線上に並びます。この直線を<strong>証券市場線</strong> (Securities Market Line; SML) と呼びます。</p>
<p>定義通り <span class="math inline">\beta</span> を計算すると銘柄Aは約 <span class="math inline">0.63</span>、銘柄Bは約 <span class="math inline">1.33</span> となります。 両者の期待リターンおよび <span class="math inline">\beta</span> を図示すると証券市場線に乗っており、この仮想的な市場ではCAPMが成立していることがわかります。</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># 1. パラメータ設定 (本文の記述と整合するように調整した数値)</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># ※ ユーザーの手元に前の章のデータがある場合はそれを読み込んでください。</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co"># ここでは本文中の「A:47%, B:53%」「Beta A:0.63, Beta B:1.33」</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># と概ね一致するパラメータを設定します。</span></span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a>mu_A <span class="ot">&lt;-</span> <span class="fl">0.05</span>      <span class="co"># 銘柄Aの期待リターン</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>sig_A <span class="ot">&lt;-</span> <span class="fl">0.10</span>     <span class="co"># 銘柄Aの標準偏差</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>mu_B <span class="ot">&lt;-</span> <span class="fl">0.12</span>      <span class="co"># 銘柄Bの期待リターン</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>sig_B <span class="ot">&lt;-</span> <span class="fl">0.20</span>     <span class="co"># 銘柄Bの標準偏差</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.2</span>        <span class="co"># 相関係数</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>Rf <span class="ot">&lt;-</span> <span class="fl">0.01</span>        <span class="co"># 安全利子率</span></span>
<span id="cb16-14"><a href="#cb16-14"></a></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co"># 共分散</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>cov_AB <span class="ot">&lt;-</span> rho <span class="sc">*</span> sig_A <span class="sc">*</span> sig_B</span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co"># 2. 接点ポートフォリオ(市場ポートフォリオ)の計算</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="co"># 過剰リターンベクトル</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>R_excess <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_A <span class="sc">-</span> Rf, mu_B <span class="sc">-</span> Rf)</span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="co"># 分散共分散行列</span></span>
<span id="cb16-24"><a href="#cb16-24"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_A<span class="sc">^</span><span class="dv">2</span>, cov_AB, cov_AB, sig_B<span class="sc">^</span><span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb16-25"><a href="#cb16-25"></a></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="co"># 接点ポートフォリオのウェイト計算 (解析解)</span></span>
<span id="cb16-27"><a href="#cb16-27"></a>Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma)</span>
<span id="cb16-28"><a href="#cb16-28"></a>w_tangency_unscaled <span class="ot">&lt;-</span> Sigma_inv <span class="sc">%*%</span> R_excess</span>
<span id="cb16-29"><a href="#cb16-29"></a>w_M <span class="ot">&lt;-</span> w_tangency_unscaled <span class="sc">/</span> <span class="fu">sum</span>(w_tangency_unscaled) <span class="co"># ウェイトの和を1にする</span></span>
<span id="cb16-30"><a href="#cb16-30"></a></span>
<span id="cb16-31"><a href="#cb16-31"></a><span class="co"># 市場ポートフォリオの期待リターンとリスク</span></span>
<span id="cb16-32"><a href="#cb16-32"></a>mu_M <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(w_M) <span class="sc">%*%</span> <span class="fu">c</span>(mu_A, mu_B))</span>
<span id="cb16-33"><a href="#cb16-33"></a>sig_M <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sqrt</span>(<span class="fu">t</span>(w_M) <span class="sc">%*%</span> Sigma <span class="sc">%*%</span> w_M))</span>
<span id="cb16-34"><a href="#cb16-34"></a></span>
<span id="cb16-35"><a href="#cb16-35"></a><span class="co"># Betaの計算: Cov(Ri, RM) / Var(RM)</span></span>
<span id="cb16-36"><a href="#cb16-36"></a><span class="co"># Cov(Ra, Rm) = w_A*Var(A) + w_B*Cov(A,B)</span></span>
<span id="cb16-37"><a href="#cb16-37"></a>cov_AM <span class="ot">&lt;-</span> w_M[<span class="dv">1</span>] <span class="sc">*</span> sig_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> w_M[<span class="dv">2</span>] <span class="sc">*</span> cov_AB</span>
<span id="cb16-38"><a href="#cb16-38"></a>cov_BM <span class="ot">&lt;-</span> w_M[<span class="dv">1</span>] <span class="sc">*</span> cov_AB <span class="sc">+</span> w_M[<span class="dv">2</span>] <span class="sc">*</span> sig_B<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb16-39"><a href="#cb16-39"></a></span>
<span id="cb16-40"><a href="#cb16-40"></a>beta_A <span class="ot">&lt;-</span> cov_AM <span class="sc">/</span> sig_M<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb16-41"><a href="#cb16-41"></a>beta_B <span class="ot">&lt;-</span> cov_BM <span class="sc">/</span> sig_M<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb16-42"><a href="#cb16-42"></a></span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="co"># データフレーム化 (プロット用)</span></span>
<span id="cb16-44"><a href="#cb16-44"></a>assets <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-45"><a href="#cb16-45"></a>  <span class="at">Asset =</span> <span class="fu">c</span>(<span class="st">"銘柄A"</span>, <span class="st">"銘柄B"</span>, <span class="st">"市場PF"</span>),</span>
<span id="cb16-46"><a href="#cb16-46"></a>  <span class="at">Mu =</span> <span class="fu">c</span>(mu_A, mu_B, mu_M),</span>
<span id="cb16-47"><a href="#cb16-47"></a>  <span class="at">Sigma =</span> <span class="fu">c</span>(sig_A, sig_B, sig_M),</span>
<span id="cb16-48"><a href="#cb16-48"></a>  <span class="at">Beta =</span> <span class="fu">c</span>(beta_A, beta_B, <span class="dv">1</span>) <span class="co"># 市場PFのベータは定義上1</span></span>
<span id="cb16-49"><a href="#cb16-49"></a>)</span>
<span id="cb16-50"><a href="#cb16-50"></a></span>
<span id="cb16-51"><a href="#cb16-51"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-52"><a href="#cb16-52"></a><span class="co"># 3. 効率的フロンティアのデータ生成 (左図用)</span></span>
<span id="cb16-53"><a href="#cb16-53"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-54"><a href="#cb16-54"></a>w_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb16-55"><a href="#cb16-55"></a>frontier_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-56"><a href="#cb16-56"></a>  <span class="at">w_A =</span> w_seq,</span>
<span id="cb16-57"><a href="#cb16-57"></a>  <span class="at">w_B =</span> <span class="dv">1</span> <span class="sc">-</span> w_seq</span>
<span id="cb16-58"><a href="#cb16-58"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-59"><a href="#cb16-59"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-60"><a href="#cb16-60"></a>    <span class="at">Mu =</span> w_A <span class="sc">*</span> mu_A <span class="sc">+</span> w_B <span class="sc">*</span> mu_B,</span>
<span id="cb16-61"><a href="#cb16-61"></a>    <span class="at">Sigma =</span> <span class="fu">sqrt</span>(w_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> sig_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> w_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> sig_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> w_A <span class="sc">*</span> w_B <span class="sc">*</span> cov_AB)</span>
<span id="cb16-62"><a href="#cb16-62"></a>  )</span>
<span id="cb16-63"><a href="#cb16-63"></a></span>
<span id="cb16-64"><a href="#cb16-64"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-65"><a href="#cb16-65"></a><span class="co"># 4. 作図 (ggplot2)</span></span>
<span id="cb16-66"><a href="#cb16-66"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb16-67"><a href="#cb16-67"></a></span>
<span id="cb16-68"><a href="#cb16-68"></a><span class="co"># --- 左図: 資本市場線 (CML) ---</span></span>
<span id="cb16-69"><a href="#cb16-69"></a>p_cml <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-70"><a href="#cb16-70"></a>  <span class="co"># 効率的フロンティア（双曲線）</span></span>
<span id="cb16-71"><a href="#cb16-71"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> frontier_data, <span class="fu">aes</span>(<span class="at">x =</span> Sigma, <span class="at">y =</span> Mu),</span>
<span id="cb16-72"><a href="#cb16-72"></a>            <span class="at">color =</span> <span class="st">"gray70"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-73"><a href="#cb16-73"></a>  <span class="co"># 資本市場線 (CML): 切片Rf, 接点を通る直線</span></span>
<span id="cb16-74"><a href="#cb16-74"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> Rf, <span class="at">slope =</span> (mu_M <span class="sc">-</span> Rf) <span class="sc">/</span> sig_M,</span>
<span id="cb16-75"><a href="#cb16-75"></a>              <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-76"><a href="#cb16-76"></a>  <span class="co"># 各資産のポイント</span></span>
<span id="cb16-77"><a href="#cb16-77"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> assets, <span class="fu">aes</span>(<span class="at">x =</span> Sigma, <span class="at">y =</span> Mu, <span class="at">color =</span> Asset), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb16-78"><a href="#cb16-78"></a>  <span class="co"># Rfの点</span></span>
<span id="cb16-79"><a href="#cb16-79"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> Rf), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-80"><a href="#cb16-80"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.01</span>, <span class="at">y =</span> Rf, <span class="at">label =</span> <span class="st">"Rf"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-81"><a href="#cb16-81"></a>  <span class="co"># ラベル類</span></span>
<span id="cb16-82"><a href="#cb16-82"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"資本市場線 (CML)"</span>,</span>
<span id="cb16-83"><a href="#cb16-83"></a>       <span class="at">x =</span> <span class="st">"リスク (標準偏差)"</span>, <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb16-84"><a href="#cb16-84"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-85"><a href="#cb16-85"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Sigma)<span class="sc">*</span><span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb16-86"><a href="#cb16-86"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Mu)<span class="sc">*</span><span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb16-87"><a href="#cb16-87"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co"># 凡例は右図と共通または省略</span></span>
<span id="cb16-88"><a href="#cb16-88"></a></span>
<span id="cb16-89"><a href="#cb16-89"></a><span class="co"># --- 右図: 証券市場線 (SML) ---</span></span>
<span id="cb16-90"><a href="#cb16-90"></a>p_sml <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-91"><a href="#cb16-91"></a>  <span class="co"># 証券市場線 (SML): 切片Rf, 傾き(Rm-Rf)</span></span>
<span id="cb16-92"><a href="#cb16-92"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> Rf, <span class="at">slope =</span> (mu_M <span class="sc">-</span> Rf),</span>
<span id="cb16-93"><a href="#cb16-93"></a>              <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-94"><a href="#cb16-94"></a>  <span class="co"># 各資産のポイント</span></span>
<span id="cb16-95"><a href="#cb16-95"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> assets, <span class="fu">aes</span>(<span class="at">x =</span> Beta, <span class="at">y =</span> Mu, <span class="at">color =</span> Asset), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb16-96"><a href="#cb16-96"></a>  <span class="co"># 補助線 (市場PFのベータ=1を示す線)</span></span>
<span id="cb16-97"><a href="#cb16-97"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> mu_M),</span>
<span id="cb16-98"><a href="#cb16-98"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb16-99"><a href="#cb16-99"></a>  <span class="co"># Rfの点</span></span>
<span id="cb16-100"><a href="#cb16-100"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> Rf), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-101"><a href="#cb16-101"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">y =</span> Rf, <span class="at">label =</span> <span class="st">"Rf"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-102"><a href="#cb16-102"></a>  <span class="co"># ラベル類</span></span>
<span id="cb16-103"><a href="#cb16-103"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"証券市場線 (SML)"</span>,</span>
<span id="cb16-104"><a href="#cb16-104"></a>       <span class="at">x =</span> <span class="st">"ベータ (β)"</span>, <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb16-105"><a href="#cb16-105"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-106"><a href="#cb16-106"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb16-107"><a href="#cb16-107"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Mu)<span class="sc">*</span><span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb16-108"><a href="#cb16-108"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb16-109"><a href="#cb16-109"></a></span>
<span id="cb16-110"><a href="#cb16-110"></a><span class="co"># --- 図の結合 ---</span></span>
<span id="cb16-111"><a href="#cb16-111"></a>p_combined <span class="ot">&lt;-</span> p_cml <span class="sc">+</span> p_sml</span>
<span id="cb16-112"><a href="#cb16-112"></a>p_combined</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="chapter02_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="chapter02_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3150"></a></p>
</figure>
</div>
</div>
</div>
</section></section><section id="n資産が投資可能な場合への拡張" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="n資産が投資可能な場合への拡張">
<span class="header-section-number">2.5</span> N資産が投資可能な場合への拡張</h2>
<p>今までは，リスク資産が銘柄AとBの二つしかない場合を分析してきたが，現実は多くのリスク資産が存在し、海外株式や債券、REIT(不動産投資信託)といったその他の投資可能な金融資産を含めればその数は飛躍的に増加する。 本節での平均分散アプローチやCAPMは危険資産の数が任意の<span class="math inline">N</span>個であっても成立する。 ただしその場合は<strong>行列での表記</strong>が必須となる(第7章やサポートサイト4.5節参照)。</p>
<p>一般に，平均分散の意味で効率的なポートフォリオ(<strong>平均分散ポートフォリオ</strong>)を計算するには、目標期待リターンを所与として、それを実現するポートフォリオの中でリスクを最小化するものを求める。 得られた期待リターンとリスクのペアを一点として、目標期待リターンを動かすとリスク・リターン平面上に双曲線が描ける。 この双曲線を<strong>平均分散フロンティア</strong>と呼び、効率的フロンティアはその上半分の領域である(確認済み)。</p>
<p>一般に投資可能な資産の数が増えると、平均分散フロンティアは左上に移動し、投資家はより望ましいポートフォリオが実現できるようになる。 リスク資産<span class="math inline">A</span>と<span class="math inline">B</span>に加えて<span class="math inline">C</span>が投資可能な状況を考えると投資可能な資産が増えたからと言って必ずしもその資産に投資する必要はない。<span class="math inline">w_C=0</span>とすれば、投資家は危険資産<span class="math inline">A</span>と<span class="math inline">B</span>のみに投資可能だった場合と同じ投資機会集合を実現できる。 新しい危険資産が既存資産の組み合わせによって完全に再現できるような極端な例を除けば分散投資のメリットが生じるため、投資家はより望ましいリスク・リターンのトレードオフを実現できる。</p>
<p>統計学における分散の定義は，<span class="math inline">N</span>個の確率変数<span class="math inline">R_1,R_2,\cdots,R_N</span>の共分散行列<span class="math inline">\Sigma</span>の対角成分の和である。 <span class="math display">
\begin{aligned}
\sigma^2=\sum_{i=1}^N\sum_{j=1}^N\sigma_{ij}=\sum_{i=1}^N\sigma_{ii}
\end{aligned}
</span> ここで，<span class="math inline">\sigma_{ij}</span>は<span class="math inline">R_i</span>と<span class="math inline">R_j</span>の共分散であり，<span class="math inline">\sigma_{ii}</span>は<span class="math inline">R_i</span>の分散である。 共分散行列<span class="math inline">\Sigma</span>は対称行列であり，対角成分は分散を表す。 また，<span class="math inline">R_i</span>と<span class="math inline">R_j</span>の共分散は<span class="math inline">\sigma_{ij}=\sigma_{ji}</span>である。 共分散行列の対角成分以外の成分は共分散を表す。 <span class="math display">
\begin{aligned}
\Sigma=
\begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} &amp; \cdots &amp; \sigma_{1N} \\
\sigma_{21} &amp; \sigma_{22} &amp; \cdots &amp; \sigma_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{N1} &amp; \sigma_{N2} &amp; \cdots &amp; \sigma_{NN} \\
\end{bmatrix}
\end{aligned}
</span></p>
<p>上のは，<span class="math inline">N</span>個の確率変数の共分散行列の定義である。Copilotで作成しました。</p>


<!-- -->

</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>無リスク割引率は無リスク金利と同義で，全くリスクのない確実に手に入れられる利息のようなものです。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="はじめに">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">はじめに</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter03.html" class="pagination-link" aria-label="R言語入門">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R言語入門</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">## ファイナンス入門</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="in">```{r setup}</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb17-6"><a href="#cb17-6"></a>  tidyverse, <span class="co"># 便利なパッケージ群</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  ggthemes, <span class="co"># ggplot2のテーマ集</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  plotly, <span class="co"># インタラクティブなグラフ作成</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  patchwork <span class="co"># 複数のグラフをまとめて表示</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>)</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a>mystyle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="co"># 1. ggthemes 自体の引数でフォントを指定します</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>  <span class="fu">theme_economist_white</span>(</span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="co"># gray_bg = FALSE,</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>    <span class="at">base_family =</span> <span class="st">"HiraKakuProN-W3"</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>    ),</span>
<span id="cb17-18"><a href="#cb17-18"></a>  <span class="fu">scale_colour_economist</span>(),</span>
<span id="cb17-19"><a href="#cb17-19"></a></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="co"># theme_calc(base_family = "HiraKakuProN-W3"),</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>  <span class="co"># scale_colour_calc(),</span></span>
<span id="cb17-22"><a href="#cb17-22"></a></span>
<span id="cb17-23"><a href="#cb17-23"></a>  <span class="co"># 3. その他の微調整（フォントサイズなど）</span></span>
<span id="cb17-24"><a href="#cb17-24"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-25"><a href="#cb17-25"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>), <span class="co"># フォントファミリーは上で指定済みなので省略可</span></span>
<span id="cb17-26"><a href="#cb17-26"></a>    <span class="co"># 必要であれば個別の要素を調整</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="co"># plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb17-28"><a href="#cb17-28"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb17-29"><a href="#cb17-29"></a>  )</span>
<span id="cb17-30"><a href="#cb17-30"></a>)</span>
<span id="cb17-31"><a href="#cb17-31"></a><span class="in">```</span></span>
<span id="cb17-32"><a href="#cb17-32"></a></span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="fu">## 割引率</span></span>
<span id="cb17-34"><a href="#cb17-34"></a></span>
<span id="cb17-35"><a href="#cb17-35"></a>**ファイナンス**(finance)の大事な概念に**割引率**(discount rate)があります。</span>
<span id="cb17-36"><a href="#cb17-36"></a>これは、<span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>ある財の今の価値と将来の価値は異なっており、将来の価値を現在の価値(これを**現在価値**(present value)という)に変換するための係数<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>です。</span>
<span id="cb17-37"><a href="#cb17-37"></a></span>
<span id="cb17-38"><a href="#cb17-38"></a>たとえば，今の100万円が来年110万円になる世界において，</span>
<span id="cb17-39"><a href="#cb17-39"></a></span>
<span id="cb17-40"><a href="#cb17-40"></a>$$</span>
<span id="cb17-41"><a href="#cb17-41"></a>100 = f(110)</span>
<span id="cb17-42"><a href="#cb17-42"></a>$$</span>
<span id="cb17-43"><a href="#cb17-43"></a></span>
<span id="cb17-44"><a href="#cb17-44"></a>と表せる関数$f$が存在するとします。このとき，110万円を現在価値に変換するための係数が割引率です。</span>
<span id="cb17-45"><a href="#cb17-45"></a>具体的に，</span>
<span id="cb17-46"><a href="#cb17-46"></a></span>
<span id="cb17-47"><a href="#cb17-47"></a>$$</span>
<span id="cb17-48"><a href="#cb17-48"></a>f(110) = \frac{110}{1 + r}</span>
<span id="cb17-49"><a href="#cb17-49"></a>$$</span>
<span id="cb17-50"><a href="#cb17-50"></a></span>
<span id="cb17-51"><a href="#cb17-51"></a>と表せるとき，$r$が割引率です。</span>
<span id="cb17-52"><a href="#cb17-52"></a></span>
<span id="cb17-53"><a href="#cb17-53"></a>$$</span>
<span id="cb17-54"><a href="#cb17-54"></a>\begin{aligned}</span>
<span id="cb17-55"><a href="#cb17-55"></a>100 &amp;= \frac{110}{1 + r}<span class="sc">\\</span></span>
<span id="cb17-56"><a href="#cb17-56"></a>r &amp;= \frac{110}{100} - 1 = 0.1</span>
<span id="cb17-57"><a href="#cb17-57"></a>\end{aligned}</span>
<span id="cb17-58"><a href="#cb17-58"></a>$$</span>
<span id="cb17-59"><a href="#cb17-59"></a></span>
<span id="cb17-60"><a href="#cb17-60"></a>この場合，割引率$r$は0.1(10%)となります。</span>
<span id="cb17-61"><a href="#cb17-61"></a>割引率10%の世界において，今の100万円は1年後の110万円と同じ価値をもつ，ということを意味しています。</span>
<span id="cb17-62"><a href="#cb17-62"></a></span>
<span id="cb17-63"><a href="#cb17-63"></a><span class="fu">### 確実なキャッシュ・フローに対する割引率</span></span>
<span id="cb17-64"><a href="#cb17-64"></a></span>
<span id="cb17-65"><a href="#cb17-65"></a><span class="ss">- </span>**現在価値** ：将来に発生するキャッシュフローの現時点における価値</span>
<span id="cb17-66"><a href="#cb17-66"></a><span class="ss">- </span>**時間価値** ：将来と現在の価値の違い</span>
<span id="cb17-67"><a href="#cb17-67"></a><span class="ss">- </span>**無リスク金利** (risk-free rate) ：安全資産へと投資したときのリターンで，投資時点でリターンの額が確定します。</span>
<span id="cb17-68"><a href="#cb17-68"></a>  無リスク金利は**確率変数ではなく定数**(parameter)です。</span>
<span id="cb17-69"><a href="#cb17-69"></a></span>
<span id="cb17-70"><a href="#cb17-70"></a>上の式を年を$T$という記号で表して一般的に表現します。</span>
<span id="cb17-71"><a href="#cb17-71"></a>$T$年後に**確実に**獲得できるキャッシュフローを$CF_T$で表し、無リスク割引率を$R_F$で表します<span class="ot">[^1]</span>。</span>
<span id="cb17-72"><a href="#cb17-72"></a>このとき現在価値 $PV$ は以下のように計算されます。</span>
<span id="cb17-73"><a href="#cb17-73"></a></span>
<span id="cb17-74"><a href="#cb17-74"></a><span class="ot">[^1]: </span>無リスク割引率は無リスク金利と同義で，全くリスクのない確実に手に入れられる利息のようなものです。</span>
<span id="cb17-75"><a href="#cb17-75"></a></span>
<span id="cb17-76"><a href="#cb17-76"></a>$$</span>
<span id="cb17-77"><a href="#cb17-77"></a>PV = \frac{CF_T}{(1 + R_F)^T}</span>
<span id="cb17-78"><a href="#cb17-78"></a>$$</span>
<span id="cb17-79"><a href="#cb17-79"></a></span>
<span id="cb17-80"><a href="#cb17-80"></a>::: {.column-margin}</span>
<span id="cb17-81"><a href="#cb17-81"></a>現時点で$CF_0$を1年間貯金する。利息$r$は$0.1$とする。</span>
<span id="cb17-82"><a href="#cb17-82"></a>1年後に受け取れるキャッシュフロー$CF_1$は、貯金した元本$CF_0$と利息$CF_0 \times 0.1$となる。つまり、$CF_0 + CF_0 \times 0.1 = (1+0.1)CF_0$である。</span>
<span id="cb17-83"><a href="#cb17-83"></a></span>
<span id="cb17-84"><a href="#cb17-84"></a>逆に、来年$CF_1$受け取るためには、今いくら貯金するかを考える。必要な貯金額を$X$とすると、$X \times (1 + 0.1) = CF_1$となる。つまり$X = CF_1/ (1.1)$となる。</span>
<span id="cb17-85"><a href="#cb17-85"></a>これが現在価値である。</span>
<span id="cb17-86"><a href="#cb17-86"></a>:::</span>
<span id="cb17-87"><a href="#cb17-87"></a></span>
<span id="cb17-88"><a href="#cb17-88"></a>将来の確実なキャッシュ・フロー$CF_T$の現在価値は、割引率$R_F$と将来受け取る時点である$T$に依存している。$CF_T = 100$の場合、$R_F$と$T$の変化に応じて現在価値がどのように変化するのか確認する。</span>
<span id="cb17-89"><a href="#cb17-89"></a></span>
<span id="cb17-90"><a href="#cb17-90"></a>$T=1$として、横軸を割引率、縦軸を現在価値としたグラフが以下のものである。</span>
<span id="cb17-91"><a href="#cb17-91"></a>割引率が大きくなるにつれて現在価値が小さくなることが分かる。</span>
<span id="cb17-92"><a href="#cb17-92"></a></span>
<span id="cb17-93"><a href="#cb17-93"></a><span class="in">```{r pv_rf, filename = "現在価値と割引率"}</span></span>
<span id="cb17-94"><a href="#cb17-94"></a>T_fixed <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 1年後に固定</span></span>
<span id="cb17-95"><a href="#cb17-95"></a></span>
<span id="cb17-96"><a href="#cb17-96"></a><span class="fu">data.frame</span>(</span>
<span id="cb17-97"><a href="#cb17-97"></a>  <span class="at">R_F =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>))</span>
<span id="cb17-98"><a href="#cb17-98"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-99"><a href="#cb17-99"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-100"><a href="#cb17-100"></a>    <span class="at">PV =</span> <span class="dv">100</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> R_F)<span class="sc">^</span>T_fixed</span>
<span id="cb17-101"><a href="#cb17-101"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-102"><a href="#cb17-102"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> R_F, <span class="at">y =</span> PV) <span class="sc">+</span></span>
<span id="cb17-103"><a href="#cb17-103"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb17-104"><a href="#cb17-104"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"割引率"</span>, <span class="at">y =</span> <span class="st">"現在価値"</span>) <span class="sc">+</span></span>
<span id="cb17-105"><a href="#cb17-105"></a>  mystyle</span>
<span id="cb17-106"><a href="#cb17-106"></a><span class="in">```</span></span>
<span id="cb17-107"><a href="#cb17-107"></a></span>
<span id="cb17-108"><a href="#cb17-108"></a>次に、$R_F = 0.1$ に固定して、横軸を年 $T$ 、縦軸を現在価値 $PV$ としてグラフが以下のものです。</span>
<span id="cb17-109"><a href="#cb17-109"></a>図を見ると，キャッシュ・フローを受け取る時点が遠くなるほど、現在価値が小さくなることがわかります。</span>
<span id="cb17-110"><a href="#cb17-110"></a>1年後に受け取れる100万円と，10年後に受け取れる100万円では，後者の方が価値が低い，というのは直観的ですよね。</span>
<span id="cb17-111"><a href="#cb17-111"></a></span>
<span id="cb17-112"><a href="#cb17-112"></a><span class="in">```{r pv_T, filename = "現在価値と期間"}</span></span>
<span id="cb17-113"><a href="#cb17-113"></a>R_F <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># 無リスク利子率</span></span>
<span id="cb17-114"><a href="#cb17-114"></a>T <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="co"># 将来受け取る時点</span></span>
<span id="cb17-115"><a href="#cb17-115"></a>PV <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> R_F)<span class="sc">^</span>T <span class="co"># 現在価値の計算</span></span>
<span id="cb17-116"><a href="#cb17-116"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(T, PV) <span class="co"># データフレーム作成</span></span>
<span id="cb17-117"><a href="#cb17-117"></a><span class="co"># 作図</span></span>
<span id="cb17-118"><a href="#cb17-118"></a>df <span class="sc">|&gt;</span></span>
<span id="cb17-119"><a href="#cb17-119"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-120"><a href="#cb17-120"></a>  <span class="fu">aes</span>(<span class="at">x =</span> T, <span class="at">y =</span> PV) <span class="sc">+</span></span>
<span id="cb17-121"><a href="#cb17-121"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-122"><a href="#cb17-122"></a>  <span class="fu">xlab</span>(<span class="st">"T年後"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"現在価値"</span>) <span class="sc">+</span> mystyle</span>
<span id="cb17-123"><a href="#cb17-123"></a><span class="in">```</span></span>
<span id="cb17-124"><a href="#cb17-124"></a></span>
<span id="cb17-125"><a href="#cb17-125"></a><span class="fu">### 不確実なキャッシュ・フローに対する割引率</span></span>
<span id="cb17-126"><a href="#cb17-126"></a></span>
<span id="cb17-127"><a href="#cb17-127"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"marky"</span><span class="dt">&gt;</span>モデルに投資家の**リスクプレミアム**(risk premium; RP)を反映させることが割引率の2つ目の役割<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>です。</span>
<span id="cb17-128"><a href="#cb17-128"></a>通常、将来キャッシュ・フローがいくらになるのか分からないのが普通であり、$CF$は様々な要因で変化する**確率変数**(random variable)であるため、現時点における**期待値**(expected value)で評価されます。</span>
<span id="cb17-129"><a href="#cb17-129"></a></span>
<span id="cb17-130"><a href="#cb17-130"></a>たとえば，1年後に確実に150万円もらえる投資Aと，確率50%で200万円，確率50%で100万円もらえる投資Bがあるとします。</span>
<span id="cb17-131"><a href="#cb17-131"></a>期待値で評価すると，投資Aの期待キャッシュフローは150万円，投資Bの期待キャッシュフローは$0.5 \times 200 + 0.5 \times 100 = 150$万円となり，同じ期待キャッシュフローをもつことになります。</span>
<span id="cb17-132"><a href="#cb17-132"></a>しかし，直観的に投資Bは100万円しか生み出さないリスクがある分，2つの投資の価値を現在の価値で比較すると，投資Aの方が価値が高いと思いませんか？</span>
<span id="cb17-133"><a href="#cb17-133"></a></span>
<span id="cb17-134"><a href="#cb17-134"></a>このリスクのある資産Bの割引率を$\tilde{R}$と表すと，2つの投資の現在価値は，次のようになります。</span>
<span id="cb17-135"><a href="#cb17-135"></a></span>
<span id="cb17-136"><a href="#cb17-136"></a></span>
<span id="cb17-137"><a href="#cb17-137"></a>$$</span>
<span id="cb17-138"><a href="#cb17-138"></a>\frac{150}{1 + R_F} \quad &gt; \quad \frac{200 \times 0.5 + 100 \times 0.5}{1 + \tilde{R}}</span>
<span id="cb17-139"><a href="#cb17-139"></a>$$</span>
<span id="cb17-140"><a href="#cb17-140"></a>となるなら，</span>
<span id="cb17-141"><a href="#cb17-141"></a>$$</span>
<span id="cb17-142"><a href="#cb17-142"></a>R_F &lt; \tilde{R}</span>
<span id="cb17-143"><a href="#cb17-143"></a>$$</span>
<span id="cb17-144"><a href="#cb17-144"></a></span>
<span id="cb17-145"><a href="#cb17-145"></a>となります。この$R_F$と$\tilde{R}$の差が**リスクプレミアム**(risk premium: RP)です。リスクプレミアムは、リスクのある資産に投資することに対する追加的な見返りを意味します。</span>
<span id="cb17-146"><a href="#cb17-146"></a></span>
<span id="cb17-147"><a href="#cb17-147"></a>$$</span>
<span id="cb17-148"><a href="#cb17-148"></a>\begin{aligned}</span>
<span id="cb17-149"><a href="#cb17-149"></a>RP \equiv \tilde{R} - R_F<span class="sc">\\</span></span>
<span id="cb17-150"><a href="#cb17-150"></a>R_F + RP = \tilde{R}</span>
<span id="cb17-151"><a href="#cb17-151"></a>\end{aligned}</span>
<span id="cb17-152"><a href="#cb17-152"></a>$$</span>
<span id="cb17-153"><a href="#cb17-153"></a></span>
<span id="cb17-154"><a href="#cb17-154"></a></span>
<span id="cb17-155"><a href="#cb17-155"></a>::: {.column-margin}</span>
<span id="cb17-156"><a href="#cb17-156"></a>ここで、期待値をとる演算子(operator)を$\mathbb{E}$で表し、期待値をとる時点を添え字で表す。ここでは現時点$t=0$における期待値を$\mathbb{E}_0$と表現している。</span>
<span id="cb17-157"><a href="#cb17-157"></a>たとえば，現時点を$t=0$として，1期先に起こりうる結果$X$が$100$か$200$であることが分かっていて，それぞれの発生確率が50%であったとする。この将来に起こりうる結果を現時点での情報を基に期待値をとる，ということは，</span>
<span id="cb17-158"><a href="#cb17-158"></a>$$</span>
<span id="cb17-159"><a href="#cb17-159"></a>\mathbb{E}<span class="co">[</span><span class="ot">X</span><span class="co">]</span> = 0.5 \times 100 + 0.5 \times 200 = 150</span>
<span id="cb17-160"><a href="#cb17-160"></a>$$</span>
<span id="cb17-161"><a href="#cb17-161"></a>となる。このように起こりうる結果と発生確率を掛けて足したものを**期待値**という。</span>
<span id="cb17-162"><a href="#cb17-162"></a>:::</span>
<span id="cb17-163"><a href="#cb17-163"></a></span>
<span id="cb17-164"><a href="#cb17-164"></a>リスクプレミアムは割引率の調整で定量化されます。</span>
<span id="cb17-165"><a href="#cb17-165"></a></span>
<span id="cb17-166"><a href="#cb17-166"></a>$$</span>
<span id="cb17-167"><a href="#cb17-167"></a>\begin{aligned}</span>
<span id="cb17-168"><a href="#cb17-168"></a>PV_0 &amp; = \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">CF_1</span><span class="co">]</span>}{1 + R_F + \underbrace{(\tilde{R} - R_F)}_{\text{RP}}}<span class="sc">\\</span></span>
<span id="cb17-169"><a href="#cb17-169"></a>     &amp; =\frac{\mathbb{E_0}<span class="co">[</span><span class="ot">CF_1</span><span class="co">]</span>}{\underbrace{1+\tilde{R}}_{\text{リスク調整済み割引率}}}</span>
<span id="cb17-170"><a href="#cb17-170"></a>\end{aligned}</span>
<span id="cb17-171"><a href="#cb17-171"></a>$$</span>
<span id="cb17-172"><a href="#cb17-172"></a></span>
<span id="cb17-173"><a href="#cb17-173"></a>割引率は時間価値やリスクプレミアムに関する定量的な情報を含むので、タイミングやリスクの異なるキャッシュフローを現在価値という同一の尺度で評価できます。</span>
<span id="cb17-174"><a href="#cb17-174"></a></span>
<span id="cb17-175"><a href="#cb17-175"></a><span class="fu">### NPV法</span></span>
<span id="cb17-176"><a href="#cb17-176"></a></span>
<span id="cb17-177"><a href="#cb17-177"></a>先ほど学習した割引現在価値を判断の基準に，投資意思決定を行う方法を**NPV法**(Net Present Value Method)といいます。</span>
<span id="cb17-178"><a href="#cb17-178"></a>いま，投資するかどうかを決めるタイミングを時点0($t=0$)とします。</span>
<span id="cb17-179"><a href="#cb17-179"></a>キャッシュフローは$CF_t$で表し，マイナスなら支出，プラスなら収入を意味します。</span>
<span id="cb17-180"><a href="#cb17-180"></a>将来キャッシュフローは不確実であるため，現時点での期待値$\mathbb{E_0}<span class="co">[</span><span class="ot">CF_t</span><span class="co">]</span>$で評価します。</span>
<span id="cb17-181"><a href="#cb17-181"></a>ちなみに$CF_0$は時点0での投資なので，マイナスとなります。</span>
<span id="cb17-182"><a href="#cb17-182"></a></span>
<span id="cb17-183"><a href="#cb17-183"></a>投資時点からT年間にわたって毎年$\mathbb{E}<span class="co">[</span><span class="ot">CF_t</span><span class="co">]</span>,\quad t = 1,\dots ,T$の期待キャッシュフローが生み出されるなら、それらを割引率$1 + \tilde{R}$で現在価値に直して足し合わせた値(つまりNPV)が、現時点で評価したプロジェクトの成果となります。</span>
<span id="cb17-184"><a href="#cb17-184"></a></span>
<span id="cb17-185"><a href="#cb17-185"></a>NPVはそのプロジェクトから発生するすべてのキャッシュフローの現在価値として解釈できます。</span>
<span id="cb17-186"><a href="#cb17-186"></a>コーポレートファイナンスでは，</span>
<span id="cb17-187"><a href="#cb17-187"></a></span>
<span id="cb17-188"><a href="#cb17-188"></a><span class="ss">- </span>NPVがゼロ以上のプロジェクトは投資を実行</span>
<span id="cb17-189"><a href="#cb17-189"></a><span class="ss">- </span>NPVが負のプロジェクトは投資を見送る</span>
<span id="cb17-190"><a href="#cb17-190"></a></span>
<span id="cb17-191"><a href="#cb17-191"></a>ことを推奨しています。</span>
<span id="cb17-192"><a href="#cb17-192"></a>NPV法を一般的に表現すると次のようになります(p.48)。</span>
<span id="cb17-193"><a href="#cb17-193"></a>$$</span>
<span id="cb17-194"><a href="#cb17-194"></a>\begin{aligned}</span>
<span id="cb17-195"><a href="#cb17-195"></a>NPV_0 &amp;= \frac{CF_0}{(1+\tilde{R})^0} + \frac{\mathbb{E}<span class="co">[</span><span class="ot">CF_1</span><span class="co">]</span>}{(1+\tilde{R})^1} + \cdots + \frac{\mathbb{E}<span class="co">[</span><span class="ot">CF_T</span><span class="co">]</span>}{(1+\tilde{R})^T}<span class="sc">\\</span></span>
<span id="cb17-196"><a href="#cb17-196"></a>&amp;= CF_0 + \sum_{t=1}^T\frac{\mathbb{E}<span class="co">[</span><span class="ot">CF_t</span><span class="co">]</span>}{(1+\tilde{R})^t}</span>
<span id="cb17-197"><a href="#cb17-197"></a>\end{aligned}</span>
<span id="cb17-198"><a href="#cb17-198"></a>$$</span>
<span id="cb17-199"><a href="#cb17-199"></a></span>
<span id="cb17-200"><a href="#cb17-200"></a>::: {.column-margin}</span>
<span id="cb17-201"><a href="#cb17-201"></a>$x^0 = 1$ であることに注意してください。</span>
<span id="cb17-202"><a href="#cb17-202"></a>:::</span>
<span id="cb17-203"><a href="#cb17-203"></a></span>
<span id="cb17-204"><a href="#cb17-204"></a><span class="fu">### 配当割引モデル</span></span>
<span id="cb17-205"><a href="#cb17-205"></a></span>
<span id="cb17-206"><a href="#cb17-206"></a>NPV法の考え方を株式投資に適用することもできます。</span>
<span id="cb17-207"><a href="#cb17-207"></a>株式の保有期間を$T$年とし、時点$t$における株価を$P_t$で表します。</span>
<span id="cb17-208"><a href="#cb17-208"></a>株式から生み出される将来キャッシュ・フローは、</span>
<span id="cb17-209"><a href="#cb17-209"></a></span>
<span id="cb17-210"><a href="#cb17-210"></a><span class="ss">- </span>一株当たり配当と，</span>
<span id="cb17-211"><a href="#cb17-211"></a><span class="ss">- </span>売却時点での売却損益</span>
<span id="cb17-212"><a href="#cb17-212"></a></span>
<span id="cb17-213"><a href="#cb17-213"></a>であり、$t$時点の一株当たり配当を$D_t$，売却時点での一株当たり売却損益を$P_T - P_{T-1}$と表します。</span>
<span id="cb17-214"><a href="#cb17-214"></a>将来配当や将来売却損益は確率変数であるため期待値で考え、それを割引率$\tilde{R}$で割り引くことで、一株当たりの株式価値を求めます。</span>
<span id="cb17-215"><a href="#cb17-215"></a></span>
<span id="cb17-216"><a href="#cb17-216"></a>$$</span>
<span id="cb17-217"><a href="#cb17-217"></a>\begin{aligned}</span>
<span id="cb17-218"><a href="#cb17-218"></a>P_0^* &amp;= \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">D_1</span><span class="co">]</span>}{1 + \tilde R} + \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">D_2</span><span class="co">]</span>}{(1 + \tilde R)^2} + \cdots + \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">D_{\infty}</span><span class="co">]</span>}{(1 + \tilde R)^{T}} + \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">P_T</span><span class="co">]</span> - P_0}{(1+\tilde{R})^T}<span class="sc">\\</span></span>
<span id="cb17-219"><a href="#cb17-219"></a>&amp;= \sum^{T}_{t=1} \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">D_t</span><span class="co">]</span>}{(1+\tilde{R})^t} + \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">P_T</span><span class="co">]</span> - P_0}{(1+\tilde{R})^T}</span>
<span id="cb17-220"><a href="#cb17-220"></a>\end{aligned}</span>
<span id="cb17-221"><a href="#cb17-221"></a>$$</span>
<span id="cb17-222"><a href="#cb17-222"></a></span>
<span id="cb17-223"><a href="#cb17-223"></a>十分長い期間$T \rightarrow \infty$を考えると，売却損益の現在価値はゼロに近づくため，株式の理論価値$P_0^*$は以下のように表せます。</span>
<span id="cb17-224"><a href="#cb17-224"></a></span>
<span id="cb17-225"><a href="#cb17-225"></a>$$</span>
<span id="cb17-226"><a href="#cb17-226"></a>P_0^* = \sum^{\infty}_{t=1} \frac{\mathbb{E_0}<span class="co">[</span><span class="ot">D_t</span><span class="co">]</span>}{(1+\tilde{R})^t}</span>
<span id="cb17-227"><a href="#cb17-227"></a>$$</span>
<span id="cb17-228"><a href="#cb17-228"></a></span>
<span id="cb17-229"><a href="#cb17-229"></a>これが**配当割引モデル**(Dividend Discount Model: DDM)です。</span>
<span id="cb17-230"><a href="#cb17-230"></a>将来配当の予測値データがあれば，現時点における理論上の株価を計算することができます。</span>
<span id="cb17-231"><a href="#cb17-231"></a></span>
<span id="cb17-232"><a href="#cb17-232"></a><span class="fu">### ゴードン成長モデル</span></span>
<span id="cb17-233"><a href="#cb17-233"></a></span>
<span id="cb17-234"><a href="#cb17-234"></a>配当割引モデルは理論上は正しいのですが、将来の配当を無限に予測することは現実的ではありません。</span>
<span id="cb17-235"><a href="#cb17-235"></a>そこで、<span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>将来の配当が一定の割合で成長していくという仮定を置くこと<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>で、将来配当の予測を簡略化する方法があります。</span>
<span id="cb17-236"><a href="#cb17-236"></a>より具体的に，期待一株当たり配当が**一定の割合で成長**していくと仮定した割引配当モデルを**ゴードン成長モデル**という。</span>
<span id="cb17-237"><a href="#cb17-237"></a></span>
<span id="cb17-238"><a href="#cb17-238"></a>直近の実現した一株当たり配当を$D_0$と置き、将来にわたってこの配当の期待値が一定割合$G$%で成長していくと仮定する。</span>
<span id="cb17-239"><a href="#cb17-239"></a>つまり1時点先の配当額$D_1$が$(1 + G)D_0$となる、と仮定する。</span>
<span id="cb17-240"><a href="#cb17-240"></a>すると、$t$ 時点先の配当額 $\mathbb{E}<span class="co">[</span><span class="ot">D_t</span><span class="co">]</span>$ は、成長率$G$を用いた複利計算により、</span>
<span id="cb17-241"><a href="#cb17-241"></a>$$</span>
<span id="cb17-242"><a href="#cb17-242"></a>D_t = (1+G)^t D_0</span>
<span id="cb17-243"><a href="#cb17-243"></a>$$</span>
<span id="cb17-244"><a href="#cb17-244"></a>で表すことができます。</span>
<span id="cb17-245"><a href="#cb17-245"></a>一定割合で配当額が成長する株式の理論価値$P_0$を配当割引モデルで計算すると，</span>
<span id="cb17-246"><a href="#cb17-246"></a>$$</span>
<span id="cb17-247"><a href="#cb17-247"></a>\begin{aligned}</span>
<span id="cb17-248"><a href="#cb17-248"></a>P_0 &amp;= \frac{(1 + G) D_0}{(1+\tilde{R})} +</span>
<span id="cb17-249"><a href="#cb17-249"></a>  \frac{(1+G)^2 D_0}{(1+\tilde{R})^3} +</span>
<span id="cb17-250"><a href="#cb17-250"></a>  \frac{(1+G)^3 D_0}{(1+\tilde{R})^3} + \cdots <span class="sc">\\</span></span>
<span id="cb17-251"><a href="#cb17-251"></a>    &amp;= \sum^{\infty}_{t = 1}\frac{(1 + G)^t D_0}{(1 + \tilde{R})^t}<span class="sc">\\</span></span>
<span id="cb17-252"><a href="#cb17-252"></a>    &amp;=\frac{(1+G)D_0}{\tilde{R}-G}</span>
<span id="cb17-253"><a href="#cb17-253"></a>\end{aligned}</span>
<span id="cb17-254"><a href="#cb17-254"></a>$$</span>
<span id="cb17-255"><a href="#cb17-255"></a></span>
<span id="cb17-256"><a href="#cb17-256"></a>2本目の式から3本目の式への計算で、**等比級数の和の公式**を利用している。</span>
<span id="cb17-257"><a href="#cb17-257"></a></span>
<span id="cb17-258"><a href="#cb17-258"></a>::: {.callout-tip}</span>
<span id="cb17-259"><a href="#cb17-259"></a>初項$a$，公比$r$の等比数列</span>
<span id="cb17-260"><a href="#cb17-260"></a>$$</span>
<span id="cb17-261"><a href="#cb17-261"></a>a, ar, ar^2, ar^3, \dots , ar^{n-1},ar^n , \dots</span>
<span id="cb17-262"><a href="#cb17-262"></a>$$</span>
<span id="cb17-263"><a href="#cb17-263"></a>がある。この等比数列の和を$S_n$で表す。</span>
<span id="cb17-264"><a href="#cb17-264"></a>$$</span>
<span id="cb17-265"><a href="#cb17-265"></a>S_n = a + ar + ar^2 + \cdots + ar^{n-1} + \cdots</span>
<span id="cb17-266"><a href="#cb17-266"></a>$$</span>
<span id="cb17-267"><a href="#cb17-267"></a>両辺に$r$を乗じると，</span>
<span id="cb17-268"><a href="#cb17-268"></a>$$</span>
<span id="cb17-269"><a href="#cb17-269"></a>rS_n =  ar + ar^2 + \cdots + ar^{n-1} + ar^{n} + \cdots</span>
<span id="cb17-270"><a href="#cb17-270"></a>$$</span>
<span id="cb17-271"><a href="#cb17-271"></a>となる。そして，$S_n - rS_n$を計算すると，</span>
<span id="cb17-272"><a href="#cb17-272"></a>$$</span>
<span id="cb17-273"><a href="#cb17-273"></a>\begin{aligned}</span>
<span id="cb17-274"><a href="#cb17-274"></a>S_n - r S_n &amp;= a<span class="sc">\\</span></span>
<span id="cb17-275"><a href="#cb17-275"></a>(1-r)S_n &amp;= a<span class="sc">\\</span></span>
<span id="cb17-276"><a href="#cb17-276"></a>S_n &amp;= \frac{a}{1-r}</span>
<span id="cb17-277"><a href="#cb17-277"></a>\end{aligned}</span>
<span id="cb17-278"><a href="#cb17-278"></a>$$</span>
<span id="cb17-279"><a href="#cb17-279"></a>上のゴードン成長モデルの初項は$(1+G)D_0/(1+\tilde R)$，公比は$(1 +G)/(1+\tilde R)$なので，</span>
<span id="cb17-280"><a href="#cb17-280"></a>$$</span>
<span id="cb17-281"><a href="#cb17-281"></a>\begin{aligned}</span>
<span id="cb17-282"><a href="#cb17-282"></a>S_n</span>
<span id="cb17-283"><a href="#cb17-283"></a>%P_0^* &amp;= \frac{(1+G)D_0}{1+ \tilde R} + \frac{(1+G)^2 D_0}{(1+ \tilde R)^2} + \frac{(1+G)^3 D_0}{(1+ \tilde R)^3} + \cdots <span class="sc">\\</span></span>
<span id="cb17-284"><a href="#cb17-284"></a>&amp;= \displaystyle  \frac{\frac{(1+G)D_0}{(1 + \tilde R)}}{1 - \frac{1+G}{1+\tilde R}}<span class="sc">\\</span></span>
<span id="cb17-285"><a href="#cb17-285"></a>&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{(1+ \tilde R) - (1+G)}{1+\tilde R}}<span class="sc">\\</span></span>
<span id="cb17-286"><a href="#cb17-286"></a>%&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{\tilde R - G}{1+\tilde R}}<span class="sc">\\</span></span>
<span id="cb17-287"><a href="#cb17-287"></a>&amp;= \displaystyle  \frac{1+G}{\tilde R - G}D_0<span class="sc">\\</span></span>
<span id="cb17-288"><a href="#cb17-288"></a>\end{aligned}</span>
<span id="cb17-289"><a href="#cb17-289"></a>$$</span>
<span id="cb17-290"><a href="#cb17-290"></a>ただし，$\tilde{R} \not = G$の場合のみである。</span>
<span id="cb17-291"><a href="#cb17-291"></a>:::</span>
<span id="cb17-292"><a href="#cb17-292"></a></span>
<span id="cb17-293"><a href="#cb17-293"></a></span>
<span id="cb17-294"><a href="#cb17-294"></a></span>
<span id="cb17-295"><a href="#cb17-295"></a><span class="fu">### 割引率と期待リターンの関係</span></span>
<span id="cb17-296"><a href="#cb17-296"></a></span>
<span id="cb17-297"><a href="#cb17-297"></a>割引率$R$は投資家が将来キャッシュフローを購入するにあたって最低限要求する期待リターン(**要求収益率**)とも解釈できます。</span>
<span id="cb17-298"><a href="#cb17-298"></a>これくらいリスクのある投資をするのだから，リスクのない資産への投資よりも高いリターンを要求する，という考えを反映しています。</span>
<span id="cb17-299"><a href="#cb17-299"></a></span>
<span id="cb17-300"><a href="#cb17-300"></a></span>
<span id="cb17-301"><a href="#cb17-301"></a></span>
<span id="cb17-302"><a href="#cb17-302"></a></span>
<span id="cb17-303"><a href="#cb17-303"></a></span>
<span id="cb17-304"><a href="#cb17-304"></a><span class="fu">## 平均分散アプローチ入門</span></span>
<span id="cb17-305"><a href="#cb17-305"></a></span>
<span id="cb17-306"><a href="#cb17-306"></a>個々の投資家にとって<span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>最適となる証券の組み合わせの比率を決めることを**最適ポートフォリオ選択**<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>といいます。</span>
<span id="cb17-307"><a href="#cb17-307"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>ポートフォリオの価値をリターンの期待値と分散で評価する<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>考え方を**平均・分散アプローチ**といいます。</span>
<span id="cb17-308"><a href="#cb17-308"></a></span>
<span id="cb17-309"><a href="#cb17-309"></a><span class="fu">### ポートフォリオのリスクとリターン</span></span>
<span id="cb17-310"><a href="#cb17-310"></a></span>
<span id="cb17-311"><a href="#cb17-311"></a><span class="ss">1. </span>投資対象が銘柄Aと銘柄Bの2銘柄のみが投資対象であるケース</span>
<span id="cb17-312"><a href="#cb17-312"></a><span class="ss">2. </span>各銘柄への投資割合を$w_A$と$w_B$</span>
<span id="cb17-313"><a href="#cb17-313"></a><span class="ss">3. </span>$w_A + w_B = 1$</span>
<span id="cb17-314"><a href="#cb17-314"></a></span>
<span id="cb17-315"><a href="#cb17-315"></a>記号の定義は以下の通りです。</span>
<span id="cb17-316"><a href="#cb17-316"></a></span>
<span id="cb17-317"><a href="#cb17-317"></a><span class="ss">- </span>元本 $X$</span>
<span id="cb17-318"><a href="#cb17-318"></a><span class="ss">- </span>投資銘柄Aのリターン $1 + R_A$</span>
<span id="cb17-319"><a href="#cb17-319"></a><span class="ss">- </span>投資銘柄Bのリターン $1 + R_B$</span>
<span id="cb17-320"><a href="#cb17-320"></a></span>
<span id="cb17-321"><a href="#cb17-321"></a></span>
<span id="cb17-322"><a href="#cb17-322"></a>::: {.callout-note}</span>
<span id="cb17-323"><a href="#cb17-323"></a>リターンの定義$(P_t - P_{t-1})/P_{t-1} = P_t/P_{t-1} -1$は**ネット・リターン**(net return)と呼ばれるものである。</span>
<span id="cb17-324"><a href="#cb17-324"></a>これにたいして，元本も含めたリターン$1 + R_t = P_t/P_{t-1}$は**グロス・リターン**(gross return)という。</span>
<span id="cb17-325"><a href="#cb17-325"></a>:::</span>
<span id="cb17-326"><a href="#cb17-326"></a></span>
<span id="cb17-327"><a href="#cb17-327"></a>元本$X$のうち$w_A$分だけ銘柄Aに投資すると、1年後に期待値で$\mathbb{E}<span class="co">[</span><span class="ot">X \times w_A \times (1+R_A)</span><span class="co">]</span>$になります。</span>
<span id="cb17-328"><a href="#cb17-328"></a>手元現金全額を銘柄AとBに振り分けると、</span>
<span id="cb17-329"><a href="#cb17-329"></a>$$</span>
<span id="cb17-330"><a href="#cb17-330"></a>\begin{aligned}</span>
<span id="cb17-331"><a href="#cb17-331"></a>(1 + R_A) w_A X + ( 1 + R_B) w_B X</span>
<span id="cb17-332"><a href="#cb17-332"></a>&amp;= w_A X + w_A R_A X + w_B X + w_B R_B X<span class="sc">\\</span></span>
<span id="cb17-333"><a href="#cb17-333"></a>&amp;= \left <span class="co">[</span><span class="ot">\underbrace{(w_A+w_B)}_{\text{定義より} = 1}+(w_AR_A+w_BR_B) \right </span><span class="co">]</span>X<span class="sc">\\</span></span>
<span id="cb17-334"><a href="#cb17-334"></a>&amp;= (1 + w_A R_A + w_B R_B)X</span>
<span id="cb17-335"><a href="#cb17-335"></a>\end{aligned}</span>
<span id="cb17-336"><a href="#cb17-336"></a>$$</span>
<span id="cb17-337"><a href="#cb17-337"></a>となります。</span>
<span id="cb17-338"><a href="#cb17-338"></a>この**1年後の価値と初期投資額の比**としてこのポートフォリオのリターン$1 + R_P$を計算します。</span>
<span id="cb17-339"><a href="#cb17-339"></a>$$</span>
<span id="cb17-340"><a href="#cb17-340"></a>\begin{aligned}</span>
<span id="cb17-341"><a href="#cb17-341"></a>1 + R_P &amp;= \frac{\overbrace{(1 + w_A R_A + w_B R_B)X}^{将来時点の評価額}}{\underbrace{X}_{初期投資}}<span class="sc">\\</span></span>
<span id="cb17-342"><a href="#cb17-342"></a>        &amp;= 1 + w_A R_A + w_B R_B<span class="sc">\\</span></span>
<span id="cb17-343"><a href="#cb17-343"></a>        &amp;= 1 + w_A R_A + w_B R_B<span class="sc">\\</span></span>
<span id="cb17-344"><a href="#cb17-344"></a>R_P     &amp;= w_A R_A + w_B R_B</span>
<span id="cb17-345"><a href="#cb17-345"></a>\end{aligned}</span>
<span id="cb17-346"><a href="#cb17-346"></a>$$</span>
<span id="cb17-347"><a href="#cb17-347"></a></span>
<span id="cb17-348"><a href="#cb17-348"></a></span>
<span id="cb17-349"><a href="#cb17-349"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>ポートフォリオ構築時には、各銘柄の実現リターンはわからない<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>ので(つまり確率変数)、かわりに期待値や分散を評価します。</span>
<span id="cb17-350"><a href="#cb17-350"></a>銘柄Aと銘柄Bのネット・リターンをそれぞれ$R_A$と$R_B$で表すと，期待値，分散，標準偏差は次のようになります。</span>
<span id="cb17-351"><a href="#cb17-351"></a></span>
<span id="cb17-352"><a href="#cb17-352"></a><span class="ss">- </span>期待値 $\mathbb{E}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> = \mu _A$，$\mathbb{E}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span> = \mu_B$</span>
<span id="cb17-353"><a href="#cb17-353"></a><span class="ss">- </span>分散 $\mathbb{V}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> = \sigma^2_A$，$\mathbb{V}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span> = \sigma^2_B$</span>
<span id="cb17-354"><a href="#cb17-354"></a><span class="ss">- </span>共分散 $\mathbb{Cov}<span class="co">[</span><span class="ot">R_A, R_B</span><span class="co">]</span> = \sigma_{AB}$</span>
<span id="cb17-355"><a href="#cb17-355"></a><span class="ss">- </span>相関係数 $\rho = \frac{\sigma_{AB}}{\sigma_A \sigma_B}$</span>
<span id="cb17-356"><a href="#cb17-356"></a></span>
<span id="cb17-357"><a href="#cb17-357"></a>$$</span>
<span id="cb17-358"><a href="#cb17-358"></a>\begin{aligned}</span>
<span id="cb17-359"><a href="#cb17-359"></a>% \rho &amp;= \frac{\mathbb{E}<span class="co">[</span><span class="ot">(R_A - \bar R_A)(R_B - \bar R_B)</span><span class="co">]</span>}{\mathbb{E}<span class="co">[</span><span class="ot">(R_A - \bar R_A)^2</span><span class="co">]</span>}</span>
<span id="cb17-360"><a href="#cb17-360"></a>\rho &amp;= \frac{\sigma _{AB}}{\sigma _A \times \sigma _B} <span class="sc">\\</span></span>
<span id="cb17-361"><a href="#cb17-361"></a>\sigma_{AB} &amp; = \rho\sigma_A\sigma_B</span>
<span id="cb17-362"><a href="#cb17-362"></a>\end{aligned}</span>
<span id="cb17-363"><a href="#cb17-363"></a>$$</span>
<span id="cb17-364"><a href="#cb17-364"></a></span>
<span id="cb17-365"><a href="#cb17-365"></a>と表せます。</span>
<span id="cb17-366"><a href="#cb17-366"></a></span>
<span id="cb17-367"><a href="#cb17-367"></a>上の式より、ポートフォリオのリターンは$R_P = w_A R_A + w_B R_B$ なので、</span>
<span id="cb17-368"><a href="#cb17-368"></a>ポートフォリオのリターンの期待値 $\mathbb{E}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> = \mu_P$ も各銘柄の期待リターンの加重平均となります。</span>
<span id="cb17-369"><a href="#cb17-369"></a>ここで投資割合$w_A$と$w_B$は定数であり，$R_A, R_B$は確率変数です。</span>
<span id="cb17-370"><a href="#cb17-370"></a>$$</span>
<span id="cb17-371"><a href="#cb17-371"></a>\begin{aligned}</span>
<span id="cb17-372"><a href="#cb17-372"></a>\mathbb{E}<span class="co">[</span><span class="ot">R_p</span><span class="co">]</span> = \mu_P &amp;= \mathbb{E}<span class="co">[</span><span class="ot">w_A R_A + w_B R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-373"><a href="#cb17-373"></a>&amp;= w_A \mathbb{E}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> + w_B \mathbb{E}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-374"><a href="#cb17-374"></a>&amp;=w_A\mu_A+w_B\mu_B</span>
<span id="cb17-375"><a href="#cb17-375"></a>\end{aligned}</span>
<span id="cb17-376"><a href="#cb17-376"></a>$$</span>
<span id="cb17-377"><a href="#cb17-377"></a></span>
<span id="cb17-378"><a href="#cb17-378"></a>つぎに，ポートフォリオのリターン$R_P$の分散$\mathbb{V}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> = \sigma^2_P$は各銘柄の分散及び相関係数を用いて計算できます。</span>
<span id="cb17-379"><a href="#cb17-379"></a></span>
<span id="cb17-380"><a href="#cb17-380"></a>$$</span>
<span id="cb17-381"><a href="#cb17-381"></a>\begin{aligned}</span>
<span id="cb17-382"><a href="#cb17-382"></a>\mathbb{V}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> = \sigma_P^2 &amp;= \mathbb{V}<span class="co">[</span><span class="ot">w_A R_A + w_B R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-383"><a href="#cb17-383"></a>&amp;= w_A^2 \mathbb{V}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> + w_B^2 \mathbb{V}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span> + 2 w_A w_B \mathbb{Cov}<span class="co">[</span><span class="ot">R_A,R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-384"><a href="#cb17-384"></a>&amp;= w_A^2 \sigma_A^2 + w_B^2 \sigma_B^2 + 2w_A w_B \sigma _{AB}<span class="sc">\\</span></span>
<span id="cb17-385"><a href="#cb17-385"></a>&amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B +</span>
<span id="cb17-386"><a href="#cb17-386"></a>\underbrace{2 w_A w_B \rho \sigma_A \sigma_B}_{ここの\rho の符号が重要}</span>
<span id="cb17-387"><a href="#cb17-387"></a>\end{aligned}</span>
<span id="cb17-388"><a href="#cb17-388"></a>$$</span>
<span id="cb17-389"><a href="#cb17-389"></a></span>
<span id="cb17-390"><a href="#cb17-390"></a>:::{.callout-tip}</span>
<span id="cb17-391"><a href="#cb17-391"></a><span class="fu">## 確率変数の分散</span></span>
<span id="cb17-392"><a href="#cb17-392"></a></span>
<span id="cb17-393"><a href="#cb17-393"></a>確率変数$X$と$Y$の線形結合$aX + bY$の分散は次のように計算できます。</span>
<span id="cb17-394"><a href="#cb17-394"></a>$$</span>
<span id="cb17-395"><a href="#cb17-395"></a>\begin{aligned}</span>
<span id="cb17-396"><a href="#cb17-396"></a>\mathbb{V}(aX + bY) &amp;= \mathbb{E}\left<span class="co">[</span><span class="ot"> \{ (aX + bY) - \mathbb{E}[aX + bY] \}^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-397"><a href="#cb17-397"></a>&amp;= \mathbb{E}\left<span class="co">[</span><span class="ot"> \{ (aX + bY) - (a\mu_X + b\mu_Y) \}^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-398"><a href="#cb17-398"></a>&amp;= \mathbb{E}\left<span class="co">[</span><span class="ot"> \{ a(X - \mu_X) + b(Y - \mu_Y) \}^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-399"><a href="#cb17-399"></a>&amp;= \mathbb{E}\left<span class="co">[</span><span class="ot"> a^2(X - \mu_X)^2 + 2ab(X - \mu_X)(Y - \mu_Y) + b^2(Y - \mu_Y)^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-400"><a href="#cb17-400"></a>&amp;= a^2 \mathbb{E}\left<span class="co">[</span><span class="ot"> (X - \mu_X)^2 \right</span><span class="co">]</span> + 2ab \mathbb{E}\left<span class="co">[</span><span class="ot"> (X - \mu_X)(Y - \mu_Y) \right</span><span class="co">]</span> + b^2 \mathbb{E}\left<span class="co">[</span><span class="ot"> (Y - \mu_Y)^2 \right</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-401"><a href="#cb17-401"></a>&amp;= a^2 \mathbb{V}(X)  + b^2 \mathbb{V}(Y) + 2ab \mathrm{Cov}(X, Y)</span>
<span id="cb17-402"><a href="#cb17-402"></a>\end{aligned}</span>
<span id="cb17-403"><a href="#cb17-403"></a>$$</span>
<span id="cb17-404"><a href="#cb17-404"></a>:::</span>
<span id="cb17-405"><a href="#cb17-405"></a></span>
<span id="cb17-406"><a href="#cb17-406"></a>ポートフォリオPの分散 $\mathbb{V}(R_P)$ は，各銘柄の分散に投資割合の二乗を乗じたものに，各銘柄のリターンの相関関係部分を加えたものとなっていることが分かります。</span>
<span id="cb17-407"><a href="#cb17-407"></a>つまり，この2銘柄のリターンの相関係数$\rho$に応じて，ポートフォリオPの分散が大きくなるかどうかが決まる，ということです。</span>
<span id="cb17-408"><a href="#cb17-408"></a></span>
<span id="cb17-409"><a href="#cb17-409"></a></span>
<span id="cb17-410"><a href="#cb17-410"></a><span class="fu">### 分散投資のメリット</span></span>
<span id="cb17-411"><a href="#cb17-411"></a></span>
<span id="cb17-412"><a href="#cb17-412"></a>保有比率$(w_A, w_B)$を変化させたときのポートフォリオの$\mu_P$と$\sigma_P$がどのように変化するかを確認しましょう。</span>
<span id="cb17-413"><a href="#cb17-413"></a>分散は非負の値をとることに注意してください。</span>
<span id="cb17-414"><a href="#cb17-414"></a></span>
<span id="cb17-415"><a href="#cb17-415"></a>$$</span>
<span id="cb17-416"><a href="#cb17-416"></a>\begin{aligned}</span>
<span id="cb17-417"><a href="#cb17-417"></a>\mathbb{V}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> = \sigma_P^2 &amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B + 2\rho{w_Aw_B\sigma_A\sigma_B}<span class="sc">\\</span></span>
<span id="cb17-418"><a href="#cb17-418"></a>&amp;= (w_A \sigma_A + w_B \sigma_B)^2 - 2w_A  w_B \sigma _A \sigma_B + 2\rho{w_Aw_B\sigma_A\sigma_B}<span class="sc">\\</span></span>
<span id="cb17-419"><a href="#cb17-419"></a>% &amp;= (w_A \sigma_A + w_B \sigma_B)^2 - (2 + 2\rho ) w_A w_B\sigma_A\sigma_B<span class="sc">\\</span></span>
<span id="cb17-420"><a href="#cb17-420"></a>&amp;=\underbrace{(w_{A} \sigma_{A} + w_{B}\sigma_{B})^{2}}_{&gt;0} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{ここ重要}</span>
<span id="cb17-421"><a href="#cb17-421"></a>\end{aligned}</span>
<span id="cb17-422"><a href="#cb17-422"></a>$$</span>
<span id="cb17-423"><a href="#cb17-423"></a></span>
<span id="cb17-424"><a href="#cb17-424"></a>$0 \leq w_{A} \leq 1$ かつ $0 \leq w_{B} \leq 1$ ，$w_A + w_B = 1$ のとき、</span>
<span id="cb17-425"><a href="#cb17-425"></a></span>
<span id="cb17-426"><a href="#cb17-426"></a>$$</span>
<span id="cb17-427"><a href="#cb17-427"></a>2 ( 1- \rho ) w_A w_B \sigma _A \sigma _B \geq 0</span>
<span id="cb17-428"><a href="#cb17-428"></a>$$</span>
<span id="cb17-429"><a href="#cb17-429"></a></span>
<span id="cb17-430"><a href="#cb17-430"></a>となります。</span>
<span id="cb17-431"><a href="#cb17-431"></a>$\rho = 1$のときのみ等号で成立します。</span>
<span id="cb17-432"><a href="#cb17-432"></a>したがって、$-1 \leq \rho &lt; 1$ のとき、$( 1- \rho ) w_A w_B \sigma _A \sigma _B &gt; 0$ となり，次の不等式が成立します。</span>
<span id="cb17-433"><a href="#cb17-433"></a>$$</span>
<span id="cb17-434"><a href="#cb17-434"></a>\begin{aligned}</span>
<span id="cb17-435"><a href="#cb17-435"></a>\sigma_P^2 &amp;= (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{&gt; 0}<span class="sc">\\</span></span>
<span id="cb17-436"><a href="#cb17-436"></a>\Longleftrightarrow \sigma _P^2 &amp;\leq (w_A \sigma _A + w_B \sigma _B)^2 <span class="sc">\\</span></span>
<span id="cb17-437"><a href="#cb17-437"></a>\Longleftrightarrow \sigma_{P} &amp; \leq</span>
<span id="cb17-438"><a href="#cb17-438"></a>\underbrace{w_{A}\sigma_{A}+w_{B}\sigma_{B}}_{リスクの加重平均}</span>
<span id="cb17-439"><a href="#cb17-439"></a>\end{aligned}</span>
<span id="cb17-440"><a href="#cb17-440"></a>$$</span>
<span id="cb17-441"><a href="#cb17-441"></a>となり，ポートフォリオのリスクを表す標準偏差$\sigma_P$が銘柄AとBの標準偏差の加重平均$w_{A}\sigma_{A} + w_{B} \sigma_{B}$以下になることがわかります。</span>
<span id="cb17-442"><a href="#cb17-442"></a>これを**分散投資効果**という。</span>
<span id="cb17-443"><a href="#cb17-443"></a></span>
<span id="cb17-444"><a href="#cb17-444"></a><span class="in">```{r diversified_investment, filename="分散投資効果 p.65"}</span></span>
<span id="cb17-445"><a href="#cb17-445"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-446"><a href="#cb17-446"></a></span>
<span id="cb17-447"><a href="#cb17-447"></a><span class="co"># パラメータ設定</span></span>
<span id="cb17-448"><a href="#cb17-448"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-449"><a href="#cb17-449"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb17-450"><a href="#cb17-450"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb17-451"><a href="#cb17-451"></a>  <span class="at">rho =</span> <span class="fl">0.2</span></span>
<span id="cb17-452"><a href="#cb17-452"></a>)</span>
<span id="cb17-453"><a href="#cb17-453"></a></span>
<span id="cb17-454"><a href="#cb17-454"></a><span class="co"># データの生成</span></span>
<span id="cb17-455"><a href="#cb17-455"></a>df_portfolio <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-456"><a href="#cb17-456"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb17-457"><a href="#cb17-457"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb17-458"><a href="#cb17-458"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-459"><a href="#cb17-459"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-460"><a href="#cb17-460"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb17-461"><a href="#cb17-461"></a>    <span class="at">var_p =</span> wa<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> wb<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-462"><a href="#cb17-462"></a>      <span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> wa <span class="sc">*</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B,</span>
<span id="cb17-463"><a href="#cb17-463"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>(var_p),</span>
<span id="cb17-464"><a href="#cb17-464"></a>    <span class="co"># ラベル作成: 0.1刻みの点のみラベルを付ける</span></span>
<span id="cb17-465"><a href="#cb17-465"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(<span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb17-466"><a href="#cb17-466"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb17-467"><a href="#cb17-467"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb17-468"><a href="#cb17-468"></a>  )</span>
<span id="cb17-469"><a href="#cb17-469"></a></span>
<span id="cb17-470"><a href="#cb17-470"></a><span class="co"># 作図</span></span>
<span id="cb17-471"><a href="#cb17-471"></a><span class="fu">ggplot</span>(df_portfolio, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb17-472"><a href="#cb17-472"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-473"><a href="#cb17-473"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_portfolio <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-474"><a href="#cb17-474"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-475"><a href="#cb17-475"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb17-476"><a href="#cb17-476"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb17-477"><a href="#cb17-477"></a>  mystyle</span>
<span id="cb17-478"><a href="#cb17-478"></a><span class="in">```</span></span>
<span id="cb17-479"><a href="#cb17-479"></a></span>
<span id="cb17-480"><a href="#cb17-480"></a>完全な負の相関$(\rho=-1)$であるの場合、$\sigma^{2}_{P}=0$のポートフォリオを構築できる。</span>
<span id="cb17-481"><a href="#cb17-481"></a>確認のため、2銘柄の価格が完全な負の相関$\rho = -1$をもつとき、ポートフォリオPのリスク$\sigma_P$は</span>
<span id="cb17-482"><a href="#cb17-482"></a>$$</span>
<span id="cb17-483"><a href="#cb17-483"></a>\begin{aligned}</span>
<span id="cb17-484"><a href="#cb17-484"></a>\mathbb{V}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> = \sigma ^2_P &amp;=(w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2}-2(1- (-1))w_{A}w_{B} \sigma_{A}\sigma_{B}<span class="sc">\\</span></span>
<span id="cb17-485"><a href="#cb17-485"></a>&amp;= (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} -4w_{A}w_{B} \sigma_{A}\sigma_{B}<span class="sc">\\</span></span>
<span id="cb17-486"><a href="#cb17-486"></a>&amp;= w_A ^2 \sigma _A^2 + w_B^2\sigma _B^2 + 2w_A w_B \sigma_A \sigma_B -4w_{A}w_{B} \sigma_{A}\sigma_{B}<span class="sc">\\</span></span>
<span id="cb17-487"><a href="#cb17-487"></a>&amp;= w_A ^2 \sigma _A^2 - 2w_{A}w_{B} \sigma_{A}\sigma_{B} + w_B^2\sigma _B^2 <span class="sc">\\</span></span>
<span id="cb17-488"><a href="#cb17-488"></a>&amp;= (w_{A}\sigma_{A} - w_{B}\sigma_{B})^{2}<span class="sc">\\</span></span>
<span id="cb17-489"><a href="#cb17-489"></a>\sigma _P &amp;= | w_{A}\sigma_{A} - w_{B}\sigma_{B}|</span>
<span id="cb17-490"><a href="#cb17-490"></a>\end{aligned}</span>
<span id="cb17-491"><a href="#cb17-491"></a>$$</span>
<span id="cb17-492"><a href="#cb17-492"></a></span>
<span id="cb17-493"><a href="#cb17-493"></a>以下のように，$w_A \sigma _A = w_B \sigma_B$となるように$w_A$と$w_B$を選べば、$\sigma _P = 0$となるポートフォリオを作れる。</span>
<span id="cb17-494"><a href="#cb17-494"></a></span>
<span id="cb17-495"><a href="#cb17-495"></a><span class="in">```{r, filename="完全な負の相関の分散投資効果 p.65"}</span></span>
<span id="cb17-496"><a href="#cb17-496"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-497"><a href="#cb17-497"></a></span>
<span id="cb17-498"><a href="#cb17-498"></a><span class="co"># パラメータ設定</span></span>
<span id="cb17-499"><a href="#cb17-499"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-500"><a href="#cb17-500"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb17-501"><a href="#cb17-501"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span></span>
<span id="cb17-502"><a href="#cb17-502"></a>)</span>
<span id="cb17-503"><a href="#cb17-503"></a></span>
<span id="cb17-504"><a href="#cb17-504"></a><span class="co"># データ生成</span></span>
<span id="cb17-505"><a href="#cb17-505"></a>df_neg_corr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-506"><a href="#cb17-506"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb17-507"><a href="#cb17-507"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb17-508"><a href="#cb17-508"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-509"><a href="#cb17-509"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-510"><a href="#cb17-510"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb17-511"><a href="#cb17-511"></a>    <span class="co"># 完全な負の相関の場合、標準偏差は加重平均の差の絶対値になる</span></span>
<span id="cb17-512"><a href="#cb17-512"></a>    <span class="at">sigma_p =</span> <span class="fu">abs</span>(wa <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">-</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb17-513"><a href="#cb17-513"></a>    <span class="co"># ラベル作成: 0.1刻みの点のみラベルを付ける</span></span>
<span id="cb17-514"><a href="#cb17-514"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(<span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb17-515"><a href="#cb17-515"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb17-516"><a href="#cb17-516"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb17-517"><a href="#cb17-517"></a>  )</span>
<span id="cb17-518"><a href="#cb17-518"></a></span>
<span id="cb17-519"><a href="#cb17-519"></a><span class="co"># 作図</span></span>
<span id="cb17-520"><a href="#cb17-520"></a><span class="fu">ggplot</span>(df_neg_corr, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb17-521"><a href="#cb17-521"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-522"><a href="#cb17-522"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_neg_corr <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-523"><a href="#cb17-523"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-524"><a href="#cb17-524"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="co"># 縦軸をリターン、横軸をリスクにするため入れ替え</span></span>
<span id="cb17-525"><a href="#cb17-525"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb17-526"><a href="#cb17-526"></a>  mystyle</span>
<span id="cb17-527"><a href="#cb17-527"></a><span class="in">```</span></span>
<span id="cb17-528"><a href="#cb17-528"></a>このケースでは、$\sigma_A = 0.2$、$\sigma_B = 0.3$となっているため、$0.2w_A = 0.3w_B$となる保有割合を考える。</span>
<span id="cb17-529"><a href="#cb17-529"></a>$$</span>
<span id="cb17-530"><a href="#cb17-530"></a>\begin{aligned}</span>
<span id="cb17-531"><a href="#cb17-531"></a>0.2 w_A &amp;= 0.3w_B<span class="sc">\\</span></span>
<span id="cb17-532"><a href="#cb17-532"></a>0.2 w_A &amp;= 0.3(1-w_A)<span class="sc">\\</span></span>
<span id="cb17-533"><a href="#cb17-533"></a>0.2 w_A &amp;= 0.3 - 0.3w_A<span class="sc">\\</span></span>
<span id="cb17-534"><a href="#cb17-534"></a>0.5 w_A &amp;= 0.3<span class="sc">\\</span></span>
<span id="cb17-535"><a href="#cb17-535"></a>w_A &amp;= 0.6</span>
<span id="cb17-536"><a href="#cb17-536"></a>\end{aligned}</span>
<span id="cb17-537"><a href="#cb17-537"></a>$$</span>
<span id="cb17-538"><a href="#cb17-538"></a>となるため、銘柄Aに60％、銘柄Bに40%を投資することで、リスクゼロで期待リターン$0.6\times0.1 + 0.4 \times 0.2 = 0.14$を獲得することができる。</span>
<span id="cb17-539"><a href="#cb17-539"></a></span>
<span id="cb17-540"><a href="#cb17-540"></a><span class="fu">### 空売りの効果</span></span>
<span id="cb17-541"><a href="#cb17-541"></a></span>
<span id="cb17-542"><a href="#cb17-542"></a>空売り(short sale)とは、</span>
<span id="cb17-543"><a href="#cb17-543"></a></span>
<span id="cb17-544"><a href="#cb17-544"></a><span class="ss">1. </span>保有していない証券を誰か(普通は証券会社)から借りてきて売却し、</span>
<span id="cb17-545"><a href="#cb17-545"></a><span class="ss">2. </span>一定期間後に買い戻して元の持ち主に返却する</span>
<span id="cb17-546"><a href="#cb17-546"></a></span>
<span id="cb17-547"><a href="#cb17-547"></a>取引をいい、**値下がりから利益を得る**。</span>
<span id="cb17-548"><a href="#cb17-548"></a>空売りを行う投資家をショートセラー(short seller)という。</span>
<span id="cb17-549"><a href="#cb17-549"></a></span>
<span id="cb17-550"><a href="#cb17-550"></a>いままでは、$0 \leq w_A,w_B \leq 1$ という制約を置いていたが、この制約をはずして $w_A + w_B = 1$ のみを課す。</span>
<span id="cb17-551"><a href="#cb17-551"></a>つまり$w_A &lt; 0$や$w_B &lt; 0$が空売りを表す。</span>
<span id="cb17-552"><a href="#cb17-552"></a></span>
<span id="cb17-553"><a href="#cb17-553"></a><span class="in">```{r short_sale_effect, filename="空売りの効果 p.66"}</span></span>
<span id="cb17-554"><a href="#cb17-554"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-555"><a href="#cb17-555"></a></span>
<span id="cb17-556"><a href="#cb17-556"></a><span class="co"># パラメータ設定</span></span>
<span id="cb17-557"><a href="#cb17-557"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-558"><a href="#cb17-558"></a>  <span class="at">mu_A =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb17-559"><a href="#cb17-559"></a>  <span class="at">mu_B =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb17-560"><a href="#cb17-560"></a>  <span class="at">rho  =</span> <span class="fl">0.2</span></span>
<span id="cb17-561"><a href="#cb17-561"></a>)</span>
<span id="cb17-562"><a href="#cb17-562"></a></span>
<span id="cb17-563"><a href="#cb17-563"></a><span class="co"># データ生成</span></span>
<span id="cb17-564"><a href="#cb17-564"></a>df_short <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-565"><a href="#cb17-565"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.01</span>), <span class="co"># 空売りを考慮して範囲拡大</span></span>
<span id="cb17-566"><a href="#cb17-566"></a>  <span class="at">wb =</span> <span class="dv">1</span> <span class="sc">-</span> wa</span>
<span id="cb17-567"><a href="#cb17-567"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-568"><a href="#cb17-568"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-569"><a href="#cb17-569"></a>    <span class="at">mu_p =</span> wa <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> wb <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb17-570"><a href="#cb17-570"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>(wa<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> wb<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-571"><a href="#cb17-571"></a>                   <span class="dv">2</span> <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> wa <span class="sc">*</span> wb <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb17-572"><a href="#cb17-572"></a>    <span class="at">wa_int =</span> <span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>), <span class="co"># 100倍して整数化</span></span>
<span id="cb17-573"><a href="#cb17-573"></a></span>
<span id="cb17-574"><a href="#cb17-574"></a>    <span class="co"># 条件:</span></span>
<span id="cb17-575"><a href="#cb17-575"></a>    <span class="co"># 1. wa が -1 以上 2 以下 (wa_int が -100 ~ 200)</span></span>
<span id="cb17-576"><a href="#cb17-576"></a>    <span class="co"># 2. wa が 0.1 刻み (wa_int が 10 で割り切れる)</span></span>
<span id="cb17-577"><a href="#cb17-577"></a>    <span class="at">is_label_target =</span> (wa_int <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">100</span> <span class="sc">&amp;</span> wa_int <span class="sc">&lt;=</span> <span class="dv">200</span>) <span class="sc">&amp;</span> (wa_int <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb17-578"><a href="#cb17-578"></a></span>
<span id="cb17-579"><a href="#cb17-579"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(is_label_target,</span>
<span id="cb17-580"><a href="#cb17-580"></a>                    <span class="fu">sprintf</span>(<span class="st">"%.1f, %.1f"</span>, wa, wb),</span>
<span id="cb17-581"><a href="#cb17-581"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb17-582"><a href="#cb17-582"></a>  )</span>
<span id="cb17-583"><a href="#cb17-583"></a></span>
<span id="cb17-584"><a href="#cb17-584"></a><span class="co"># 作図</span></span>
<span id="cb17-585"><a href="#cb17-585"></a><span class="fu">ggplot</span>(df_short, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb17-586"><a href="#cb17-586"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-587"><a href="#cb17-587"></a>  <span class="co"># ラベルがある点（0 &lt;= wa &lt;= 1）のみポイントとテキストを表示</span></span>
<span id="cb17-588"><a href="#cb17-588"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_short <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-589"><a href="#cb17-589"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-590"><a href="#cb17-590"></a></span>
<span id="cb17-591"><a href="#cb17-591"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb17-592"><a href="#cb17-592"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb17-593"><a href="#cb17-593"></a>  mystyle</span>
<span id="cb17-594"><a href="#cb17-594"></a><span class="in">```</span></span>
<span id="cb17-595"><a href="#cb17-595"></a></span>
<span id="cb17-596"><a href="#cb17-596"></a>先ほどの空売りなしのケースと比べると，曲線が大きく広がっていることがわかります。</span>
<span id="cb17-597"><a href="#cb17-597"></a>次に，安全資産を加えた3資産の場合を考えます。</span>
<span id="cb17-598"><a href="#cb17-598"></a></span>
<span id="cb17-599"><a href="#cb17-599"></a><span class="fu">### 安全資産の導入</span></span>
<span id="cb17-600"><a href="#cb17-600"></a></span>
<span id="cb17-601"><a href="#cb17-601"></a>**安全資産の購入**についても考える。</span>
<span id="cb17-602"><a href="#cb17-602"></a></span>
<span id="cb17-603"><a href="#cb17-603"></a>安全資産Fのリターンを$R_F$、ポートフォリオPの保有比率を$w_F$，銘柄Aと銘柄Bと安全資産の投資割合をそれぞれ$w_A, w_B, w_F$で表します。</span>
<span id="cb17-604"><a href="#cb17-604"></a></span>
<span id="cb17-605"><a href="#cb17-605"></a>まず銘柄Aと安全資産の2資産からなるポートフォリオを考えます。</span>
<span id="cb17-606"><a href="#cb17-606"></a>各資産への投資割合を$w_A + w_F = 1, \quad  w_B = 0$ とする場合を考える。</span>
<span id="cb17-607"><a href="#cb17-607"></a>この安全資産と銘柄AからなるポートフォリオPの(ネット)リターン $\tilde R_P$ は，</span>
<span id="cb17-608"><a href="#cb17-608"></a>$$</span>
<span id="cb17-609"><a href="#cb17-609"></a>\tilde R_{P} = w_{F} R_{F} + w_{A} \tilde R_{A}</span>
<span id="cb17-610"><a href="#cb17-610"></a>$$</span>
<span id="cb17-611"><a href="#cb17-611"></a>となり，このポートフォリオの期待値は，</span>
<span id="cb17-612"><a href="#cb17-612"></a>$$</span>
<span id="cb17-613"><a href="#cb17-613"></a>\begin{aligned}</span>
<span id="cb17-614"><a href="#cb17-614"></a>\mu_{P} =\mathbb{E}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span> &amp;=\mathbb{E}<span class="co">[</span><span class="ot"> w_F R_{F} + w_{A} \tilde{R_A} </span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-615"><a href="#cb17-615"></a>&amp;=w_F R_{F}+w_{A} \mathbb{E}<span class="co">[</span><span class="ot">\tilde{R_A}</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-616"><a href="#cb17-616"></a>&amp;=w_F R_{F}+w_{A} \mu_{A}<span class="sc">\\</span></span>
<span id="cb17-617"><a href="#cb17-617"></a>&amp;=(1-w_A) R_{F}+w_{A} \mu_{A}<span class="sc">\\</span></span>
<span id="cb17-618"><a href="#cb17-618"></a>&amp;=R_{F} - w_{A}R_F + w_A\mu_A<span class="sc">\\</span></span>
<span id="cb17-619"><a href="#cb17-619"></a>&amp;=R_{F} + w_A(\underbrace{\mu_A - R_F}_{\tiny リスクプレミアム})</span>
<span id="cb17-620"><a href="#cb17-620"></a>\end{aligned}</span>
<span id="cb17-621"><a href="#cb17-621"></a>$$</span>
<span id="cb17-622"><a href="#cb17-622"></a></span>
<span id="cb17-623"><a href="#cb17-623"></a>となります。</span>
<span id="cb17-624"><a href="#cb17-624"></a>もちろん安全資産のリターンは定数なので，期待値をとってもそのままです。</span>
<span id="cb17-625"><a href="#cb17-625"></a>$\mu_{A} - R_{F}$ はリスク資産である銘柄Aの**リスクプレミアム**を表しています。</span>
<span id="cb17-626"><a href="#cb17-626"></a>通常，リスクのある資産の期待リターンは安全資産のリターンより大きいため，リスクプレミアムは正の値となります。</span>
<span id="cb17-627"><a href="#cb17-627"></a>したがって，リスク資産への投資割合 $w_A$ を1単位増加させれば，$\mathbb{E}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span>$ はリスクプレミアム分増加する</span>
<span id="cb17-628"><a href="#cb17-628"></a></span>
<span id="cb17-629"><a href="#cb17-629"></a>つぎに，ポートフォリオのリスクを表す標準偏差 $\sigma _P$ とリターンの関係は次式で表せます。</span>
<span id="cb17-630"><a href="#cb17-630"></a>まず安全資産のリスクはゼロであるため，リスク資産の銘柄Ａを保有する分だけリスクが生じる。</span>
<span id="cb17-631"><a href="#cb17-631"></a></span>
<span id="cb17-632"><a href="#cb17-632"></a>$$</span>
<span id="cb17-633"><a href="#cb17-633"></a>\begin{aligned}</span>
<span id="cb17-634"><a href="#cb17-634"></a>\sigma_P^2 = \mathbb{V}<span class="co">[</span><span class="ot">R_P</span><span class="co">]</span>  &amp;= \mathbb{V}<span class="co">[</span><span class="ot">w_FR_F + w_A R_A</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-635"><a href="#cb17-635"></a>&amp;= \mathbb{V}<span class="co">[</span><span class="ot">w_A R_A</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-636"><a href="#cb17-636"></a>&amp;= w_A^2 \mathbb{V}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-637"><a href="#cb17-637"></a>&amp;= w_A^2 \sigma _A^2 <span class="sc">\\</span></span>
<span id="cb17-638"><a href="#cb17-638"></a>\sigma _P &amp; = |w_A| \sigma_A</span>
<span id="cb17-639"><a href="#cb17-639"></a>\end{aligned}</span>
<span id="cb17-640"><a href="#cb17-640"></a>$$</span>
<span id="cb17-641"><a href="#cb17-641"></a></span>
<span id="cb17-642"><a href="#cb17-642"></a>空売りを想定する場合$w_A &lt; 0$となるため，標準偏差を求める際に絶対値をとっています。</span>
<span id="cb17-643"><a href="#cb17-643"></a>空売りはない状況（つまり，$w_A&gt;0$）を想定すると，</span>
<span id="cb17-644"><a href="#cb17-644"></a></span>
<span id="cb17-645"><a href="#cb17-645"></a>$$</span>
<span id="cb17-646"><a href="#cb17-646"></a>\begin{aligned}</span>
<span id="cb17-647"><a href="#cb17-647"></a>\sigma _P = w_A \sigma _A<span class="sc">\\</span></span>
<span id="cb17-648"><a href="#cb17-648"></a>w_A = \frac{\sigma_P}{\sigma _A}</span>
<span id="cb17-649"><a href="#cb17-649"></a>\end{aligned}</span>
<span id="cb17-650"><a href="#cb17-650"></a>$$</span>
<span id="cb17-651"><a href="#cb17-651"></a></span>
<span id="cb17-652"><a href="#cb17-652"></a>のように，リスク資産である銘柄Aへの投資割合$w_A$が，ポートフォリオPとリスク資産Aのリスクの割合で決定されることがわかります。</span>
<span id="cb17-653"><a href="#cb17-653"></a>これを，ポートフォリオの期待リターン$\mu_P$に代入すると、</span>
<span id="cb17-654"><a href="#cb17-654"></a></span>
<span id="cb17-655"><a href="#cb17-655"></a>$$</span>
<span id="cb17-656"><a href="#cb17-656"></a>\begin{aligned}</span>
<span id="cb17-657"><a href="#cb17-657"></a>\mu_{P} &amp;= R_F + w_A(\mu_A - R_F)<span class="sc">\\</span></span>
<span id="cb17-658"><a href="#cb17-658"></a>&amp; = R_F + \frac{\sigma_P}{\sigma _A}(\mu_A - R_F) <span class="sc">\\</span></span>
<span id="cb17-659"><a href="#cb17-659"></a>&amp;= R_{F}+\frac{\mu_{A}-R_{F}}{\sigma_{A}}\sigma_{P}</span>
<span id="cb17-660"><a href="#cb17-660"></a>\end{aligned}</span>
<span id="cb17-661"><a href="#cb17-661"></a>$$</span>
<span id="cb17-662"><a href="#cb17-662"></a></span>
<span id="cb17-663"><a href="#cb17-663"></a>となり，期待リターン$\mu_P$は，切片が$R_F$，傾きが$(\mu_A - R_F)/\sigma_A$とする$\sigma_P$の線形関数となる。</span>
<span id="cb17-664"><a href="#cb17-664"></a></span>
<span id="cb17-665"><a href="#cb17-665"></a></span>
<span id="cb17-666"><a href="#cb17-666"></a><span class="in">```{r safe_asset_allocation, filename="安全資産の導入 p.68"}</span></span>
<span id="cb17-667"><a href="#cb17-667"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-668"><a href="#cb17-668"></a></span>
<span id="cb17-669"><a href="#cb17-669"></a><span class="co"># パラメータ設定</span></span>
<span id="cb17-670"><a href="#cb17-670"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-671"><a href="#cb17-671"></a>  <span class="at">R_F     =</span> <span class="fl">0.01</span>, <span class="co"># 安全資産利子率</span></span>
<span id="cb17-672"><a href="#cb17-672"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>,  <span class="co"># 銘柄A 期待リターン</span></span>
<span id="cb17-673"><a href="#cb17-673"></a>  <span class="at">sigma_A =</span> <span class="fl">0.2</span>   <span class="co"># 銘柄A 標準偏差</span></span>
<span id="cb17-674"><a href="#cb17-674"></a>)</span>
<span id="cb17-675"><a href="#cb17-675"></a></span>
<span id="cb17-676"><a href="#cb17-676"></a><span class="co"># データ生成</span></span>
<span id="cb17-677"><a href="#cb17-677"></a>df_safe <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-678"><a href="#cb17-678"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># 銘柄Aへの投資比率</span></span>
<span id="cb17-679"><a href="#cb17-679"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-680"><a href="#cb17-680"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-681"><a href="#cb17-681"></a>    <span class="at">wf =</span> <span class="dv">1</span> <span class="sc">-</span> wa, <span class="co"># 安全資産への投資比率</span></span>
<span id="cb17-682"><a href="#cb17-682"></a>    <span class="at">mu_p    =</span> params<span class="sc">$</span>R_F <span class="sc">+</span> wa <span class="sc">*</span> (params<span class="sc">$</span>mu_A <span class="sc">-</span> params<span class="sc">$</span>R_F),</span>
<span id="cb17-683"><a href="#cb17-683"></a>    <span class="at">sigma_p =</span> <span class="fu">abs</span>(wa) <span class="sc">*</span> params<span class="sc">$</span>sigma_A, <span class="co"># 空売り時は絶対値</span></span>
<span id="cb17-684"><a href="#cb17-684"></a></span>
<span id="cb17-685"><a href="#cb17-685"></a>    <span class="co"># ラベルの作成</span></span>
<span id="cb17-686"><a href="#cb17-686"></a>    <span class="at">wa_int =</span> <span class="fu">round</span>(wa <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb17-687"><a href="#cb17-687"></a>    <span class="at">is_label_target =</span> (wa_int <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> wa_int <span class="sc">&lt;=</span> <span class="dv">100</span>) <span class="sc">&amp;</span> (wa_int <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb17-688"><a href="#cb17-688"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(is_label_target,</span>
<span id="cb17-689"><a href="#cb17-689"></a>                    <span class="fu">sprintf</span>(<span class="st">"%g, %g"</span>, wa, wf),</span>
<span id="cb17-690"><a href="#cb17-690"></a>                    <span class="cn">NA_character_</span>)</span>
<span id="cb17-691"><a href="#cb17-691"></a>  )</span>
<span id="cb17-692"><a href="#cb17-692"></a></span>
<span id="cb17-693"><a href="#cb17-693"></a><span class="co"># 作図</span></span>
<span id="cb17-694"><a href="#cb17-694"></a><span class="fu">ggplot</span>(df_safe, <span class="fu">aes</span>(<span class="at">x =</span> mu_p, <span class="at">y =</span> sigma_p)) <span class="sc">+</span></span>
<span id="cb17-695"><a href="#cb17-695"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-696"><a href="#cb17-696"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_safe <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-697"><a href="#cb17-697"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-698"><a href="#cb17-698"></a></span>
<span id="cb17-699"><a href="#cb17-699"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb17-700"><a href="#cb17-700"></a></span>
<span id="cb17-701"><a href="#cb17-701"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"期待リターン"</span>, <span class="at">y =</span> <span class="st">"標準偏差 (リスク)"</span>) <span class="sc">+</span></span>
<span id="cb17-702"><a href="#cb17-702"></a>  mystyle</span>
<span id="cb17-703"><a href="#cb17-703"></a><span class="in">```</span></span>
<span id="cb17-704"><a href="#cb17-704"></a></span>
<span id="cb17-705"><a href="#cb17-705"></a><span class="fu">### 3資産のポートフォリオ</span></span>
<span id="cb17-706"><a href="#cb17-706"></a></span>
<span id="cb17-707"><a href="#cb17-707"></a>リスク資産AとB，安全資産Fの3資産に投資するポートフォリオを考える。</span>
<span id="cb17-708"><a href="#cb17-708"></a>ここで，$w_A + w_B &gt; 0$を仮定し，少なくとも少しはリスク資産を保有するケースを考える。</span>
<span id="cb17-709"><a href="#cb17-709"></a>当然だけれど，$w_A = w_B =0$のケースでは，安全資産のみを保有するケースとなり，リスクも無く，リターンも確定している。</span>
<span id="cb17-710"><a href="#cb17-710"></a></span>
<span id="cb17-711"><a href="#cb17-711"></a>3資産A,B,Fへの投資割合をそれぞれ$w_A$，$w_B$,$w_F$とすると，</span>
<span id="cb17-712"><a href="#cb17-712"></a>3資産からなるポートフォリオの期待リターンは次のように計算できる。</span>
<span id="cb17-713"><a href="#cb17-713"></a>$$</span>
<span id="cb17-714"><a href="#cb17-714"></a>\begin{aligned}</span>
<span id="cb17-715"><a href="#cb17-715"></a>\mathbb{E}<span class="co">[</span><span class="ot">R_{P}</span><span class="co">]</span> &amp;= w_FR_F + w_A \mathbb{E} <span class="co">[</span><span class="ot">\tilde R_A</span><span class="co">]</span> + w_B \mathbb{E}<span class="co">[</span><span class="ot"> \tilde R_B</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb17-716"><a href="#cb17-716"></a>&amp; =</span>
<span id="cb17-717"><a href="#cb17-717"></a>w_{F} R_{F} + (w_{A} + w_{B}) \left(\frac{w_{A}}{w_{A}+w_{B}} \mathbb{E} <span class="co">[</span><span class="ot">\tilde R_{A}</span><span class="co">]</span> + \frac{w_{B}}{w_{A}+w_{B}} \mathbb{E}<span class="co">[</span><span class="ot"> \tilde R_{B} </span><span class="co">]</span>\right)</span>
<span id="cb17-718"><a href="#cb17-718"></a>\end{aligned}</span>
<span id="cb17-719"><a href="#cb17-719"></a>$$</span>
<span id="cb17-720"><a href="#cb17-720"></a>安全資産への投資割合$w_F$とリスク資産への投資割合$w_C = w_A + w_B$とまとめて，式を変形させる。</span>
<span id="cb17-721"><a href="#cb17-721"></a>安全資産への投資以外の資金で構築したリスク資産AとBからなるポートフォリオを$P_C$を考えると，$P_C$の期待リターン$R_C$は次のように計算できる。</span>
<span id="cb17-722"><a href="#cb17-722"></a>$$</span>
<span id="cb17-723"><a href="#cb17-723"></a>\begin{aligned}</span>
<span id="cb17-724"><a href="#cb17-724"></a>R_{C} &amp;= \frac{w_{A}}{w_{A}+w_{B}} \mathbb{E}<span class="co">[</span><span class="ot">\tilde R_{A}</span><span class="co">]</span> + \frac{w_{B}}{w_{A}+w_{B}}\mathbb{E}<span class="co">[</span><span class="ot"> \tilde R_{B}</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-725"><a href="#cb17-725"></a>\end{aligned}</span>
<span id="cb17-726"><a href="#cb17-726"></a>$$</span>
<span id="cb17-727"><a href="#cb17-727"></a></span>
<span id="cb17-728"><a href="#cb17-728"></a>安全資産FとポートフォリオCを保有した場合の期待リターンは次式となる。</span>
<span id="cb17-729"><a href="#cb17-729"></a></span>
<span id="cb17-730"><a href="#cb17-730"></a>$$</span>
<span id="cb17-731"><a href="#cb17-731"></a>\begin{aligned}</span>
<span id="cb17-732"><a href="#cb17-732"></a>\mu_{P} &amp; = \mathbb{E}<span class="co">[</span><span class="ot">w_F R_F + w_A R_A + w_B R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-733"><a href="#cb17-733"></a>&amp;= w_FR_F + w_A \mathbb{E}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> + w_B \mathbb{E}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-734"><a href="#cb17-734"></a>&amp;= w_FR_F + (w_A + w_B) \underbrace{ \left( \frac{w_A}{w_A + w_B} \mathbb{E}<span class="co">[</span><span class="ot">R_A</span><span class="co">]</span> + \frac{w_B}{w_A + w_B} \mathbb{E}<span class="co">[</span><span class="ot">R_B</span><span class="co">]</span> \right )}_{=w_C\text{とおく}}<span class="sc">\\</span></span>
<span id="cb17-735"><a href="#cb17-735"></a>&amp;= w_F R_F + w_{C}\mu_C</span>
<span id="cb17-736"><a href="#cb17-736"></a>\end{aligned}</span>
<span id="cb17-737"><a href="#cb17-737"></a>$$</span>
<span id="cb17-738"><a href="#cb17-738"></a></span>
<span id="cb17-739"><a href="#cb17-739"></a>安全資産と2つのリスク資産からなるポートフォリオの期待リターンは，安全資産の期待リターンとリスク資産の期待リターンの和となる。</span>
<span id="cb17-740"><a href="#cb17-740"></a></span>
<span id="cb17-741"><a href="#cb17-741"></a>安全資産と2つのリスク資産に投資可能な場合，$(\mu_P, \sigma _P)$の取りうる値を図示できる。テキストの数値例を用いてRで図示してみる。</span>
<span id="cb17-742"><a href="#cb17-742"></a></span>
<span id="cb17-743"><a href="#cb17-743"></a><span class="ss">- </span>リスク資産Aの期待リターン 0.1，標準偏差 0.2</span>
<span id="cb17-744"><a href="#cb17-744"></a><span class="ss">- </span>リスク資産Bの期待リターン 0.2，標準偏差 0.3</span>
<span id="cb17-745"><a href="#cb17-745"></a><span class="ss">- </span>安全資産の期待リターンを 0.01</span>
<span id="cb17-746"><a href="#cb17-746"></a><span class="ss">- </span>リスク資産AとBの間の相関係数は0.2</span>
<span id="cb17-747"><a href="#cb17-747"></a><span class="ss">- </span>安全資産，銘柄A，銘柄Bへの投資割合を0.2，0.3，0.5とするポートフォリオを考える。このポートフォリオの期待リターン$\mu_P$と標準偏差$\sigma_P$は次のようになる。</span>
<span id="cb17-748"><a href="#cb17-748"></a></span>
<span id="cb17-749"><a href="#cb17-749"></a><span class="fu">## 最適ポートフォリオ問題</span></span>
<span id="cb17-750"><a href="#cb17-750"></a></span>
<span id="cb17-751"><a href="#cb17-751"></a>「どのようなポートフォリオが投資家にとって望ましいか」</span>
<span id="cb17-752"><a href="#cb17-752"></a></span>
<span id="cb17-753"><a href="#cb17-753"></a>一般に、投資家はリスクが小さい一方でリターンが大きいポートフォリオを好む。</span>
<span id="cb17-754"><a href="#cb17-754"></a>ここでは，リターンをポートフォリオの期待リターン$\mu_P$，リスクをポートフォリオの標準偏差$\sigma _P$で表し，この2つの変数から構成される平面$(\mu_P, \sigma_P)$上で最適ポートフォリオ問題を分析する。</span>
<span id="cb17-755"><a href="#cb17-755"></a></span>
<span id="cb17-756"><a href="#cb17-756"></a><span class="fu">### 効率的フロンティア</span></span>
<span id="cb17-757"><a href="#cb17-757"></a></span>
<span id="cb17-758"><a href="#cb17-758"></a>リスク資産Aと資産Bにのみ投資可能であり，それぞれに異なる割合で投資したポートフォリオDとＥを比較する(以下の図）</span>
<span id="cb17-759"><a href="#cb17-759"></a></span>
<span id="cb17-760"><a href="#cb17-760"></a><span class="ss">-   </span>標準偏差はともに0.25 $\sigma _D = \sigma _E = 0.25$</span>
<span id="cb17-761"><a href="#cb17-761"></a><span class="ss">-   </span>Dの方がEよりも期待リターンが大きい，$\mu _D &gt; \mu _E$</span>
<span id="cb17-762"><a href="#cb17-762"></a></span>
<span id="cb17-763"><a href="#cb17-763"></a>つまり，<span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>同じリスク（標準偏差）ならリターン（期待リターン）が高いポートフォリオに投資したほうがいいです<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span>。</span>
<span id="cb17-764"><a href="#cb17-764"></a>以下のグラフでいうと、同じリスク(緑のライン上)なら、リターンの高いポートフォリオが望ましい。そのため青い線が効率的フロンティアとなり、点線は選択されないポートフォリオになります。</span>
<span id="cb17-765"><a href="#cb17-765"></a></span>
<span id="cb17-766"><a href="#cb17-766"></a><span class="in">```{r graph_efficient_frontier_modern, filename="効率的フロンティア"}</span></span>
<span id="cb17-767"><a href="#cb17-767"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-768"><a href="#cb17-768"></a></span>
<span id="cb17-769"><a href="#cb17-769"></a><span class="co"># --- 1. パラメータ設定 ---</span></span>
<span id="cb17-770"><a href="#cb17-770"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-771"><a href="#cb17-771"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>, <span class="at">sigma_A =</span> <span class="fl">0.2</span>,  <span class="co"># 株式Aの標準偏差</span></span>
<span id="cb17-772"><a href="#cb17-772"></a>  <span class="at">mu_B    =</span> <span class="fl">0.2</span>, <span class="at">sigma_B =</span> <span class="fl">0.3</span>,  <span class="co"># 株式Bの標準偏差</span></span>
<span id="cb17-773"><a href="#cb17-773"></a>  <span class="at">rho     =</span> <span class="fl">0.2</span>   <span class="co"># 相関係数</span></span>
<span id="cb17-774"><a href="#cb17-774"></a>)</span>
<span id="cb17-775"><a href="#cb17-775"></a></span>
<span id="cb17-776"><a href="#cb17-776"></a><span class="co"># --- 2. 最小分散ポートフォリオ (MVP) の算出 ---</span></span>
<span id="cb17-777"><a href="#cb17-777"></a><span class="co"># 分散・共分散</span></span>
<span id="cb17-778"><a href="#cb17-778"></a>cov_ab <span class="ot">&lt;-</span> params<span class="sc">$</span>rho <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B</span>
<span id="cb17-779"><a href="#cb17-779"></a>var_a  <span class="ot">&lt;-</span> params<span class="sc">$</span>sigma_A<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-780"><a href="#cb17-780"></a>var_b  <span class="ot">&lt;-</span> params<span class="sc">$</span>sigma_B<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-781"><a href="#cb17-781"></a></span>
<span id="cb17-782"><a href="#cb17-782"></a><span class="co"># MVPにおける資産Aのウェイト w_mvp</span></span>
<span id="cb17-783"><a href="#cb17-783"></a><span class="co"># 公式: w = (Var(B) - Cov(A,B)) / (Var(A) + Var(B) - 2Cov(A,B))</span></span>
<span id="cb17-784"><a href="#cb17-784"></a>w_mvp <span class="ot">&lt;-</span> (var_b <span class="sc">-</span> cov_ab) <span class="sc">/</span> (var_a <span class="sc">+</span> var_b <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> cov_ab)</span>
<span id="cb17-785"><a href="#cb17-785"></a></span>
<span id="cb17-786"><a href="#cb17-786"></a><span class="co"># MVPのリターンとリスク（しきい値として使用）</span></span>
<span id="cb17-787"><a href="#cb17-787"></a>mu_mvp    <span class="ot">&lt;-</span> w_mvp <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp) <span class="sc">*</span> params<span class="sc">$</span>mu_B</span>
<span id="cb17-788"><a href="#cb17-788"></a>sigma_mvp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(w_mvp<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> var_a <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> var_b <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> w_mvp <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w_mvp) <span class="sc">*</span> cov_ab)</span>
<span id="cb17-789"><a href="#cb17-789"></a></span>
<span id="cb17-790"><a href="#cb17-790"></a><span class="co"># --- 3. プロット用データの作成 ---</span></span>
<span id="cb17-791"><a href="#cb17-791"></a>df_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-792"><a href="#cb17-792"></a>  <span class="at">w =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb17-793"><a href="#cb17-793"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-794"><a href="#cb17-794"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-795"><a href="#cb17-795"></a>    <span class="at">mu_p =</span> w <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb17-796"><a href="#cb17-796"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>((w <span class="sc">*</span> params<span class="sc">$</span>sigma_A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-797"><a href="#cb17-797"></a>                  ((<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>sigma_B)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-798"><a href="#cb17-798"></a>                  <span class="dv">2</span> <span class="sc">*</span> w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> cov_ab),</span>
<span id="cb17-799"><a href="#cb17-799"></a>    <span class="at">frontier_type =</span> <span class="fu">if_else</span>(mu_p <span class="sc">&gt;=</span> mu_mvp, <span class="st">"効率(上部)"</span>, <span class="st">"非効率(下部)"</span>)</span>
<span id="cb17-800"><a href="#cb17-800"></a>  )</span>
<span id="cb17-801"><a href="#cb17-801"></a></span>
<span id="cb17-802"><a href="#cb17-802"></a><span class="co"># --- 4. プロット作成 ---</span></span>
<span id="cb17-803"><a href="#cb17-803"></a><span class="fu">ggplot</span>(df_plot, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p)) <span class="sc">+</span></span>
<span id="cb17-804"><a href="#cb17-804"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb17-805"><a href="#cb17-805"></a>    <span class="fu">aes</span>(<span class="at">color =</span> frontier_type,</span>
<span id="cb17-806"><a href="#cb17-806"></a>    <span class="at">linetype =</span> frontier_type)</span>
<span id="cb17-807"><a href="#cb17-807"></a>    ) <span class="sc">+</span></span>
<span id="cb17-808"><a href="#cb17-808"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-809"><a href="#cb17-809"></a>  <span class="co"># 資産A (緑)</span></span>
<span id="cb17-810"><a href="#cb17-810"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-811"><a href="#cb17-811"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">label =</span> <span class="st">"A"</span>, <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-812"><a href="#cb17-812"></a>  <span class="co"># 資産B (オレンジ)</span></span>
<span id="cb17-813"><a href="#cb17-813"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-814"><a href="#cb17-814"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">label =</span> <span class="st">"B"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-815"><a href="#cb17-815"></a>  <span class="co"># 最小分散ポートフォリオ MVP (黒)</span></span>
<span id="cb17-816"><a href="#cb17-816"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> sigma_mvp, <span class="at">y =</span> mu_mvp, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-817"><a href="#cb17-817"></a></span>
<span id="cb17-818"><a href="#cb17-818"></a>  <span class="co"># C. 見た目の調整</span></span>
<span id="cb17-819"><a href="#cb17-819"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"効率(上部)"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"非効率(下部)"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb17-820"><a href="#cb17-820"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"効率(上部)"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"非効率(下部)"</span> <span class="ot">=</span> <span class="st">"dashed"</span>)) <span class="sc">+</span></span>
<span id="cb17-821"><a href="#cb17-821"></a></span>
<span id="cb17-822"><a href="#cb17-822"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"効率的フロンティア(2資産)"</span>,</span>
<span id="cb17-823"><a href="#cb17-823"></a>       <span class="at">x =</span> <span class="st">"リスク"</span>,</span>
<span id="cb17-824"><a href="#cb17-824"></a>       <span class="at">y =</span> <span class="st">"期待リターン"</span>,</span>
<span id="cb17-825"><a href="#cb17-825"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb17-826"><a href="#cb17-826"></a>       <span class="at">linetype =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb17-827"><a href="#cb17-827"></a>  mystyle <span class="sc">+</span></span>
<span id="cb17-828"><a href="#cb17-828"></a>  <span class="fu">xlim</span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">0.0</span>, <span class="fl">0.3</span>)</span>
<span id="cb17-829"><a href="#cb17-829"></a><span class="in">```</span></span>
<span id="cb17-830"><a href="#cb17-830"></a></span>
<span id="cb17-831"><a href="#cb17-831"></a><span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"markp"</span><span class="dt">&gt;</span>リスク資産AとBに加え、安全資産Fにも投資可能な場合、効率的フロンティアは**直線**になります。<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb17-832"><a href="#cb17-832"></a>この効率的フロンティアは**資本市場線**(Capital Market Line; CML)とも呼ばれます。</span>
<span id="cb17-833"><a href="#cb17-833"></a>資本市場線の傾きは、この金融市場における**リスクとリターンのトレードオフ**を表しているといえます。</span>
<span id="cb17-834"><a href="#cb17-834"></a></span>
<span id="cb17-835"><a href="#cb17-835"></a></span>
<span id="cb17-836"><a href="#cb17-836"></a><span class="in">```{r graph_cml_final, filename="3資産の効率的フロンティア（資本市場線）"}</span></span>
<span id="cb17-837"><a href="#cb17-837"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-838"><a href="#cb17-838"></a></span>
<span id="cb17-839"><a href="#cb17-839"></a><span class="co"># --- 1. パラメータ設定 ---</span></span>
<span id="cb17-840"><a href="#cb17-840"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-841"><a href="#cb17-841"></a>  <span class="at">mu_A    =</span> <span class="fl">0.1</span>,  <span class="at">sigma_A =</span> <span class="fl">0.2</span>,</span>
<span id="cb17-842"><a href="#cb17-842"></a>  <span class="at">mu_B    =</span> <span class="fl">0.2</span>,  <span class="at">sigma_B =</span> <span class="fl">0.3</span>,</span>
<span id="cb17-843"><a href="#cb17-843"></a>  <span class="at">rho     =</span> <span class="fl">0.2</span>,  <span class="at">R_F     =</span> <span class="fl">0.01</span></span>
<span id="cb17-844"><a href="#cb17-844"></a>)</span>
<span id="cb17-845"><a href="#cb17-845"></a></span>
<span id="cb17-846"><a href="#cb17-846"></a><span class="co"># --- 2. データの作成 ---</span></span>
<span id="cb17-847"><a href="#cb17-847"></a><span class="co"># 2-1. リスク資産のみのフロンティア（双曲線）</span></span>
<span id="cb17-848"><a href="#cb17-848"></a>df_frontier <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-849"><a href="#cb17-849"></a>  <span class="at">w =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.001</span>)</span>
<span id="cb17-850"><a href="#cb17-850"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-851"><a href="#cb17-851"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-852"><a href="#cb17-852"></a>    <span class="at">mu_p =</span> w <span class="sc">*</span> params<span class="sc">$</span>mu_A <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>mu_B,</span>
<span id="cb17-853"><a href="#cb17-853"></a>    <span class="at">sigma_p =</span> <span class="fu">sqrt</span>((w <span class="sc">*</span> params<span class="sc">$</span>sigma_A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>sigma_B)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span></span>
<span id="cb17-854"><a href="#cb17-854"></a>                   <span class="dv">2</span> <span class="sc">*</span> w <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> params<span class="sc">$</span>rho <span class="sc">*</span> params<span class="sc">$</span>sigma_A <span class="sc">*</span> params<span class="sc">$</span>sigma_B),</span>
<span id="cb17-855"><a href="#cb17-855"></a>    <span class="co"># シャープレシオ (接点探索用)</span></span>
<span id="cb17-856"><a href="#cb17-856"></a>    <span class="at">sharpe_ratio =</span> (mu_p <span class="sc">-</span> params<span class="sc">$</span>R_F) <span class="sc">/</span> sigma_p</span>
<span id="cb17-857"><a href="#cb17-857"></a>  )</span>
<span id="cb17-858"><a href="#cb17-858"></a></span>
<span id="cb17-859"><a href="#cb17-859"></a><span class="co"># 2-2. 接点ポートフォリオ (Tangency Portfolio)</span></span>
<span id="cb17-860"><a href="#cb17-860"></a>tangency_port <span class="ot">&lt;-</span> df_frontier <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(sharpe_ratio, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb17-861"><a href="#cb17-861"></a></span>
<span id="cb17-862"><a href="#cb17-862"></a><span class="co"># 2-3. 資本市場線 (CML)</span></span>
<span id="cb17-863"><a href="#cb17-863"></a><span class="co"># 安全資産(リスク0, リターンRf) から 接点を通って右に伸びる直線</span></span>
<span id="cb17-864"><a href="#cb17-864"></a>df_cml <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-865"><a href="#cb17-865"></a>  <span class="at">sigma_p =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>),</span>
<span id="cb17-866"><a href="#cb17-866"></a>  <span class="at">mu_p    =</span> <span class="fu">c</span>(params<span class="sc">$</span>R_F, params<span class="sc">$</span>R_F <span class="sc">+</span> tangency_port<span class="sc">$</span>sharpe_ratio <span class="sc">*</span> <span class="fl">0.6</span>)</span>
<span id="cb17-867"><a href="#cb17-867"></a>)</span>
<span id="cb17-868"><a href="#cb17-868"></a></span>
<span id="cb17-869"><a href="#cb17-869"></a><span class="co"># --- 3. プロット作成 ---</span></span>
<span id="cb17-870"><a href="#cb17-870"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-871"><a href="#cb17-871"></a>  <span class="co"># 【重要】テーマ設定を最初に適用（scale_color_manualなどが上書きされるのを防ぐ）</span></span>
<span id="cb17-872"><a href="#cb17-872"></a>  mystyle <span class="sc">+</span></span>
<span id="cb17-873"><a href="#cb17-873"></a></span>
<span id="cb17-874"><a href="#cb17-874"></a>  <span class="co"># A. 資本市場線 (CML) - 新しい効率的フロンティア</span></span>
<span id="cb17-875"><a href="#cb17-875"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_cml, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p, <span class="at">color =</span> <span class="st">"資本市場線"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-876"><a href="#cb17-876"></a></span>
<span id="cb17-877"><a href="#cb17-877"></a>  <span class="co"># B. リスク資産のみのフロンティア - もはや非効率</span></span>
<span id="cb17-878"><a href="#cb17-878"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> df_frontier, <span class="fu">aes</span>(<span class="at">x =</span> sigma_p, <span class="at">y =</span> mu_p, <span class="at">color =</span> <span class="st">"リスク資産のみのフロンティア"</span>),</span>
<span id="cb17-879"><a href="#cb17-879"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-880"><a href="#cb17-880"></a></span>
<span id="cb17-881"><a href="#cb17-881"></a>  <span class="co"># C. ポイントの描画</span></span>
<span id="cb17-882"><a href="#cb17-882"></a>  <span class="co"># 資産A</span></span>
<span id="cb17-883"><a href="#cb17-883"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-884"><a href="#cb17-884"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_A, <span class="at">y =</span> params<span class="sc">$</span>mu_A, <span class="at">label =</span> <span class="st">"A"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-885"><a href="#cb17-885"></a></span>
<span id="cb17-886"><a href="#cb17-886"></a>  <span class="co"># 資産B</span></span>
<span id="cb17-887"><a href="#cb17-887"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-888"><a href="#cb17-888"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> params<span class="sc">$</span>sigma_B, <span class="at">y =</span> params<span class="sc">$</span>mu_B, <span class="at">label =</span> <span class="st">"B"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-889"><a href="#cb17-889"></a></span>
<span id="cb17-890"><a href="#cb17-890"></a>  <span class="co"># 安全資産</span></span>
<span id="cb17-891"><a href="#cb17-891"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> params<span class="sc">$</span>R_F, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-892"><a href="#cb17-892"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> params<span class="sc">$</span>R_F, <span class="at">label =</span> <span class="st">"安全資産(F)"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb17-893"><a href="#cb17-893"></a></span>
<span id="cb17-894"><a href="#cb17-894"></a>  <span class="co"># 接点ポートフォリオ</span></span>
<span id="cb17-895"><a href="#cb17-895"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> tangency_port<span class="sc">$</span>sigma_p, <span class="at">y =</span> tangency_port<span class="sc">$</span>mu_p, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb17-896"><a href="#cb17-896"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,  <span class="at">x =</span> tangency_port<span class="sc">$</span>sigma_p, <span class="at">y =</span> tangency_port<span class="sc">$</span>mu_p,</span>
<span id="cb17-897"><a href="#cb17-897"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"接点ポートフォリオ</span><span class="sc">\n</span><span class="st">(w="</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, tangency_port<span class="sc">$</span>w), <span class="st">")"</span>),</span>
<span id="cb17-898"><a href="#cb17-898"></a>           <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">lineheight =</span> <span class="fl">0.9</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb17-899"><a href="#cb17-899"></a></span>
<span id="cb17-900"><a href="#cb17-900"></a>  <span class="co"># D. 色と凡例の設定</span></span>
<span id="cb17-901"><a href="#cb17-901"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb17-902"><a href="#cb17-902"></a>    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb17-903"><a href="#cb17-903"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"資本市場線"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"リスク資産のみのフロンティア"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb17-904"><a href="#cb17-904"></a>  ) <span class="sc">+</span></span>
<span id="cb17-905"><a href="#cb17-905"></a></span>
<span id="cb17-906"><a href="#cb17-906"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"安全資産を含む場合の効率的フロンティア"</span>,</span>
<span id="cb17-907"><a href="#cb17-907"></a>       <span class="at">subtitle =</span> <span class="st">"赤い直線が新たな効率的フロンティアとなる"</span>,</span>
<span id="cb17-908"><a href="#cb17-908"></a>       <span class="at">x =</span> <span class="st">"リスク (標準偏差)"</span>,</span>
<span id="cb17-909"><a href="#cb17-909"></a>       <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb17-910"><a href="#cb17-910"></a></span>
<span id="cb17-911"><a href="#cb17-911"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb17-912"><a href="#cb17-912"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="fl">0.6</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb17-913"><a href="#cb17-913"></a><span class="in">```</span></span>
<span id="cb17-914"><a href="#cb17-914"></a></span>
<span id="cb17-915"><a href="#cb17-915"></a>安全資産が利用可能な場合、投資家は「安全資産」と「任意のリスク資産ポートフォリオ」を組み合わせることができます。</span>
<span id="cb17-916"><a href="#cb17-916"></a>先ほどの式で確認した通り、安全資産とあるポートフォリオを組み合わせると、リスク・リターン平面上では直線が描かれます。</span>
<span id="cb17-917"><a href="#cb17-917"></a>では、投資家はどのリスク資産ポートフォリオと安全資産を組み合わせるべきでしょうか？</span>
<span id="cb17-918"><a href="#cb17-918"></a></span>
<span id="cb17-919"><a href="#cb17-919"></a>図の紫の点（安全資産 $R_F$）からスタートします。</span>
<span id="cb17-920"><a href="#cb17-920"></a>そこから、青い点線（リスク資産のみのフロンティア）上の任意の点に向けて直線を引くことができます。</span>
<span id="cb17-921"><a href="#cb17-921"></a>投資家は、同じリスクならより高いリターンを好むため、傾きが最も急になる直線を選ぼうとします。</span>
<span id="cb17-922"><a href="#cb17-922"></a>その直線とは、安全資産の点から伸び、リスク資産のフロンティアに接する直線（赤い実線）となります。</span>
<span id="cb17-923"><a href="#cb17-923"></a>この接点となるポートフォリオを**接点ポートフォリオ**(Tangency Portfolio)と呼びます。</span>
<span id="cb17-924"><a href="#cb17-924"></a>この赤い直線上の組み合わせは、青い曲線上のどの点よりも（接点を除いて）左上に位置するため、より効率的です。</span>
<span id="cb17-925"><a href="#cb17-925"></a>したがって、安全資産が存在する場合の効率的フロンティアはこの**直線（資本市場線）**となります。</span>
<span id="cb17-926"><a href="#cb17-926"></a></span>
<span id="cb17-927"><a href="#cb17-927"></a><span class="co">&lt;!-- 以下では，各資産のパラメータを変更したら，効率的フロンティアや接点ポートフォリオがどのように変化するかを確認できるインタラクティブなグラフを示します。 --&gt;</span></span>
<span id="cb17-928"><a href="#cb17-928"></a></span>
<span id="cb17-929"><a href="#cb17-929"></a><span class="in">```{shinylive-r}</span></span>
<span id="cb17-930"><a href="#cb17-930"></a><span class="co">#| echo: false</span></span>
<span id="cb17-931"><a href="#cb17-931"></a><span class="co">#| eval: false</span></span>
<span id="cb17-932"><a href="#cb17-932"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-933"><a href="#cb17-933"></a><span class="co">#| standalone: true</span></span>
<span id="cb17-934"><a href="#cb17-934"></a><span class="co">#| viewerHeight: 600</span></span>
<span id="cb17-935"><a href="#cb17-935"></a></span>
<span id="cb17-936"><a href="#cb17-936"></a><span class="co"># UI定義</span></span>
<span id="cb17-937"><a href="#cb17-937"></a><span class="ex">ui</span> <span class="op">&lt;</span>- fluidPage<span class="er">(</span></span>
<span id="cb17-938"><a href="#cb17-938"></a>  <span class="co"># 講義資料の中に埋め込むため、タイトルは省略またはh4程度に留める</span></span>
<span id="cb17-939"><a href="#cb17-939"></a>  <span class="ex">h4</span><span class="er">(</span><span class="st">"【シミュレーション】パラメータを動かしてフロンティアの変化を確認しよう"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-940"><a href="#cb17-940"></a></span>
<span id="cb17-941"><a href="#cb17-941"></a>  <span class="ex">sidebarLayout</span><span class="er">(</span></span>
<span id="cb17-942"><a href="#cb17-942"></a>    <span class="ex">sidebarPanel</span><span class="er">(</span></span>
<span id="cb17-943"><a href="#cb17-943"></a>      <span class="ex">width</span> = 4, <span class="co"># サイドバーの幅調整</span></span>
<span id="cb17-944"><a href="#cb17-944"></a>      <span class="ex">h5</span><span class="er">(</span><span class="st">"資産A (緑)"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-945"><a href="#cb17-945"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"mu_a"</span><span class="ex">,</span> <span class="st">"期待リターン"</span>, min = <span class="at">-0.1,</span> max = 0.5, value = 0.1, step = 0.01<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-946"><a href="#cb17-946"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"sigma_a"</span><span class="ex">,</span> <span class="st">"標準偏差"</span>, min = 0.05, max = 0.5, value = 0.2, step = 0.01<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-947"><a href="#cb17-947"></a></span>
<span id="cb17-948"><a href="#cb17-948"></a>      <span class="ex">h5</span><span class="er">(</span><span class="st">"資産B (橙)"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-949"><a href="#cb17-949"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"mu_b"</span><span class="ex">,</span> <span class="st">"期待リターン"</span>, min = <span class="at">-0.1,</span> max = 0.5, value = 0.2, step = 0.01<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-950"><a href="#cb17-950"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"sigma_b"</span><span class="ex">,</span> <span class="st">"標準偏差"</span>, min = 0.05, max = 0.5, value = 0.3, step = 0.01<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-951"><a href="#cb17-951"></a></span>
<span id="cb17-952"><a href="#cb17-952"></a>      <span class="fu">hr()</span><span class="ex">,</span></span>
<span id="cb17-953"><a href="#cb17-953"></a>      <span class="ex">h5</span><span class="er">(</span><span class="st">"市場環境"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-954"><a href="#cb17-954"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"rho"</span><span class="ex">,</span> <span class="st">"相関係数 (ρ)"</span>, min = <span class="at">-1,</span> max = 1, value = 0.2, step = 0.1<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-955"><a href="#cb17-955"></a>      <span class="ex">sliderInput</span><span class="er">(</span><span class="st">"rf"</span><span class="ex">,</span> <span class="st">"無リスク金利 (Rf)"</span>, min = 0, max = 0.15, value = 0.01, step = 0.005<span class="kw">)</span></span>
<span id="cb17-956"><a href="#cb17-956"></a>    <span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-957"><a href="#cb17-957"></a></span>
<span id="cb17-958"><a href="#cb17-958"></a>    <span class="ex">mainPanel</span><span class="er">(</span></span>
<span id="cb17-959"><a href="#cb17-959"></a>      <span class="ex">width</span> = 8,</span>
<span id="cb17-960"><a href="#cb17-960"></a>      <span class="ex">plotOutput</span><span class="er">(</span><span class="st">"frontierPlot"</span><span class="ex">,</span> height = <span class="st">"500px"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-961"><a href="#cb17-961"></a>      <span class="ex">wellPanel</span><span class="er">(</span></span>
<span id="cb17-962"><a href="#cb17-962"></a>        <span class="ex">style</span> = <span class="st">"padding: 10px; font-size: 0.9em;"</span>,</span>
<span id="cb17-963"><a href="#cb17-963"></a>        <span class="ex">textOutput</span><span class="er">(</span><span class="st">"tangencyInfo"</span><span class="kw">)</span></span>
<span id="cb17-964"><a href="#cb17-964"></a>      <span class="kw">)</span></span>
<span id="cb17-965"><a href="#cb17-965"></a>    <span class="kw">)</span></span>
<span id="cb17-966"><a href="#cb17-966"></a>  <span class="kw">)</span></span>
<span id="cb17-967"><a href="#cb17-967"></a><span class="kw">)</span></span>
<span id="cb17-968"><a href="#cb17-968"></a></span>
<span id="cb17-969"><a href="#cb17-969"></a><span class="co"># Serverロジック定義</span></span>
<span id="cb17-970"><a href="#cb17-970"></a><span class="ex">server</span> <span class="op">&lt;</span>- function<span class="er">(</span><span class="ex">input,</span> output<span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb17-971"><a href="#cb17-971"></a></span>
<span id="cb17-972"><a href="#cb17-972"></a>  <span class="co"># テーマ設定（Shiny内で確実に読み込むためここで再定義またはリスト化）</span></span>
<span id="cb17-973"><a href="#cb17-973"></a>  <span class="ex">my_theme</span> <span class="op">&lt;</span>- list<span class="er">(</span></span>
<span id="cb17-974"><a href="#cb17-974"></a>    <span class="ex">theme_economist_white</span><span class="er">(</span><span class="ex">base_family</span> = <span class="st">"HiraKakuProN-W3"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-975"><a href="#cb17-975"></a>    <span class="fu">scale_colour_economist()</span><span class="ex">,</span></span>
<span id="cb17-976"><a href="#cb17-976"></a>    <span class="ex">theme</span><span class="er">(</span></span>
<span id="cb17-977"><a href="#cb17-977"></a>      <span class="ex">text</span> = element_text<span class="er">(</span><span class="fu">size</span> = 12<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-978"><a href="#cb17-978"></a>      <span class="ex">legend.position</span> = <span class="st">"bottom"</span>,</span>
<span id="cb17-979"><a href="#cb17-979"></a>      <span class="ex">legend.title</span> = element_blank<span class="er">(</span><span class="kw">)</span></span>
<span id="cb17-980"><a href="#cb17-980"></a>    <span class="kw">)</span></span>
<span id="cb17-981"><a href="#cb17-981"></a>  <span class="kw">)</span></span>
<span id="cb17-982"><a href="#cb17-982"></a></span>
<span id="cb17-983"><a href="#cb17-983"></a>  <span class="co"># リアクティブなデータ生成</span></span>
<span id="cb17-984"><a href="#cb17-984"></a>  <span class="ex">data_reactive</span> <span class="op">&lt;</span>- reactive<span class="er">(</span><span class="kw">{</span></span>
<span id="cb17-985"><a href="#cb17-985"></a>    <span class="ex">mu_a</span>    <span class="op">&lt;</span>- input<span class="va">$mu_a</span></span>
<span id="cb17-986"><a href="#cb17-986"></a>    <span class="ex">sigma_a</span> <span class="op">&lt;</span>- input<span class="va">$sigma_a</span></span>
<span id="cb17-987"><a href="#cb17-987"></a>    <span class="ex">mu_b</span>    <span class="op">&lt;</span>- input<span class="va">$mu_b</span></span>
<span id="cb17-988"><a href="#cb17-988"></a>    <span class="ex">sigma_b</span> <span class="op">&lt;</span>- input<span class="va">$sigma_b</span></span>
<span id="cb17-989"><a href="#cb17-989"></a>    <span class="ex">rho</span>     <span class="op">&lt;</span>- input<span class="va">$rho</span></span>
<span id="cb17-990"><a href="#cb17-990"></a>    <span class="ex">rf</span>      <span class="op">&lt;</span>- input<span class="va">$rf</span></span>
<span id="cb17-991"><a href="#cb17-991"></a></span>
<span id="cb17-992"><a href="#cb17-992"></a>    <span class="co"># フロンティア計算</span></span>
<span id="cb17-993"><a href="#cb17-993"></a>    <span class="ex">df_frontier</span> <span class="op">&lt;</span>- tibble<span class="er">(</span></span>
<span id="cb17-994"><a href="#cb17-994"></a>      <span class="fu">w</span> = seq<span class="er">(</span><span class="ex">-1,</span> 2, by = 0.005<span class="kw">)</span></span>
<span id="cb17-995"><a href="#cb17-995"></a>    <span class="kw">)</span> <span class="kw">|</span><span class="op">&gt;</span></span>
<span id="cb17-996"><a href="#cb17-996"></a>      <span class="ex">mutate</span><span class="er">(</span></span>
<span id="cb17-997"><a href="#cb17-997"></a>        <span class="ex">mu_p</span> = w <span class="pp">*</span> mu_a + <span class="er">(</span><span class="ex">1</span> <span class="at">-</span> w<span class="kw">)</span> <span class="ex">*</span> mu_b,</span>
<span id="cb17-998"><a href="#cb17-998"></a>        <span class="ex">sigma_p</span> = sqrt<span class="er">(</span><span class="kw">(</span><span class="fu">w</span> <span class="pp">*</span> sigma_a<span class="kw">)</span><span class="ex">^2</span> + <span class="er">(</span><span class="kw">(</span><span class="ex">1</span> <span class="at">-</span> w<span class="kw">)</span> <span class="ex">*</span> sigma_b<span class="kw">)</span><span class="ex">^2</span> +</span>
<span id="cb17-999"><a href="#cb17-999"></a>                         <span class="ex">2</span> <span class="pp">*</span> w <span class="pp">*</span> <span class="er">(</span><span class="ex">1</span> <span class="at">-</span> w<span class="kw">)</span> <span class="ex">*</span> rho <span class="pp">*</span> sigma_a <span class="pp">*</span> sigma_b<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-1000"><a href="#cb17-1000"></a>        <span class="ex">sharpe_ratio</span> = <span class="er">(</span><span class="ex">mu_p</span> <span class="at">-</span> rf<span class="kw">)</span> <span class="ex">/</span> sigma_p</span>
<span id="cb17-1001"><a href="#cb17-1001"></a>      <span class="kw">)</span></span>
<span id="cb17-1002"><a href="#cb17-1002"></a></span>
<span id="cb17-1003"><a href="#cb17-1003"></a>    <span class="co"># 接点ポートフォリオ</span></span>
<span id="cb17-1004"><a href="#cb17-1004"></a>    <span class="ex">tangency_port</span> <span class="op">&lt;</span>- df_frontier <span class="kw">|</span><span class="op">&gt;</span> slice_max<span class="kw">(</span><span class="ex">sharpe_ratio,</span> n = 1<span class="kw">)</span></span>
<span id="cb17-1005"><a href="#cb17-1005"></a></span>
<span id="cb17-1006"><a href="#cb17-1006"></a>    <span class="co"># 資本市場線</span></span>
<span id="cb17-1007"><a href="#cb17-1007"></a>    <span class="ex">max_sigma</span> <span class="op">&lt;</span>- max<span class="er">(</span><span class="ex">0.6,</span> tangency_port<span class="va">$sigma_p</span> <span class="pp">*</span> 1.5<span class="kw">)</span></span>
<span id="cb17-1008"><a href="#cb17-1008"></a>    <span class="ex">df_cml</span> <span class="op">&lt;</span>- tibble<span class="er">(</span></span>
<span id="cb17-1009"><a href="#cb17-1009"></a>      <span class="ex">sigma_p</span> = c<span class="er">(</span><span class="ex">0,</span> max_sigma<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-1010"><a href="#cb17-1010"></a>      <span class="ex">mu_p</span>    = c<span class="er">(</span><span class="ex">rf,</span> rf + tangency_port<span class="va">$sharpe_ratio</span> <span class="pp">*</span> max_sigma<span class="kw">)</span></span>
<span id="cb17-1011"><a href="#cb17-1011"></a>    <span class="kw">)</span></span>
<span id="cb17-1012"><a href="#cb17-1012"></a></span>
<span id="cb17-1013"><a href="#cb17-1013"></a>    <span class="ex">list</span><span class="er">(</span><span class="ex">frontier</span> = df_frontier, tangency = tangency_port, cml = df_cml,</span>
<span id="cb17-1014"><a href="#cb17-1014"></a>         <span class="ex">p</span> = list<span class="er">(</span><span class="va">mu_a</span><span class="op">=</span>mu_a, <span class="va">sigma_a</span><span class="op">=</span>sigma_a, <span class="va">mu_b</span><span class="op">=</span>mu_b, <span class="va">sigma_b</span><span class="op">=</span>sigma_b, <span class="va">rf</span><span class="op">=</span>rf<span class="kw">))</span></span>
<span id="cb17-1015"><a href="#cb17-1015"></a>  <span class="kw">})</span></span>
<span id="cb17-1016"><a href="#cb17-1016"></a></span>
<span id="cb17-1017"><a href="#cb17-1017"></a>  <span class="co"># プロット描画</span></span>
<span id="cb17-1018"><a href="#cb17-1018"></a>  <span class="ex">output</span><span class="va">$frontierPlot</span> <span class="op">&lt;</span>- renderPlot<span class="er">(</span><span class="kw">{</span></span>
<span id="cb17-1019"><a href="#cb17-1019"></a>    <span class="ex">dat</span> <span class="op">&lt;</span>- data_reactive<span class="er">(</span><span class="kw">)</span></span>
<span id="cb17-1020"><a href="#cb17-1020"></a>    <span class="ex">p</span>   <span class="op">&lt;</span>- dat<span class="va">$p</span></span>
<span id="cb17-1021"><a href="#cb17-1021"></a></span>
<span id="cb17-1022"><a href="#cb17-1022"></a>    <span class="fu">ggplot()</span> <span class="ex">+</span></span>
<span id="cb17-1023"><a href="#cb17-1023"></a>      <span class="ex">my_theme</span> +</span>
<span id="cb17-1024"><a href="#cb17-1024"></a>      <span class="co"># CML</span></span>
<span id="cb17-1025"><a href="#cb17-1025"></a>      <span class="ex">geom_line</span><span class="er">(</span><span class="ex">data</span> = dat<span class="va">$cml</span>, aes<span class="er">(</span><span class="ex">x</span> = sigma_p, y = mu_p, color = <span class="st">"資本市場線"</span><span class="kw">)</span><span class="ex">,</span> linewidth = 1.2<span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1026"><a href="#cb17-1026"></a>      <span class="co"># フロンティア</span></span>
<span id="cb17-1027"><a href="#cb17-1027"></a>      <span class="ex">geom_path</span><span class="er">(</span><span class="ex">data</span> = dat<span class="va">$frontier</span>, aes<span class="er">(</span><span class="ex">x</span> = sigma_p, y = mu_p, color = <span class="st">"効率的フロンティア"</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb17-1028"><a href="#cb17-1028"></a>                <span class="ex">linewidth</span> = 1, linetype = <span class="st">"dashed"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1029"><a href="#cb17-1029"></a>      <span class="co"># ポイント</span></span>
<span id="cb17-1030"><a href="#cb17-1030"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"point"</span><span class="ex">,</span> x = p<span class="va">$sigma_a</span>, y = p<span class="va">$mu_a</span>, color = <span class="st">"green"</span>, size = 4<span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1031"><a href="#cb17-1031"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"text"</span><span class="ex">,</span>  x = p<span class="va">$sigma_a</span>, y = p<span class="va">$mu_a</span>, label = <span class="st">"A"</span>, vjust = <span class="at">-1.5,</span> fontface = <span class="st">"bold"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1032"><a href="#cb17-1032"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"point"</span><span class="ex">,</span> x = p<span class="va">$sigma_b</span>, y = p<span class="va">$mu_b</span>, color = <span class="st">"orange"</span>, size = 4<span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1033"><a href="#cb17-1033"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"text"</span><span class="ex">,</span>  x = p<span class="va">$sigma_b</span>, y = p<span class="va">$mu_b</span>, label = <span class="st">"B"</span>, vjust = <span class="at">-1.5,</span> fontface = <span class="st">"bold"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1034"><a href="#cb17-1034"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"point"</span><span class="ex">,</span> x = 0, y = p<span class="va">$rf</span>, color = <span class="st">"purple"</span>, size = 4<span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1035"><a href="#cb17-1035"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"text"</span><span class="ex">,</span>  x = 0, y = p<span class="va">$rf</span>, label = <span class="st">"Rf"</span>, hjust = <span class="at">-0.3,</span> fontface = <span class="st">"bold"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1036"><a href="#cb17-1036"></a>      <span class="co"># 接点</span></span>
<span id="cb17-1037"><a href="#cb17-1037"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"point"</span><span class="ex">,</span> x = dat<span class="va">$tangency$sigma_p</span>, y = dat<span class="va">$tangency$mu_p</span>, color = <span class="st">"black"</span>, shape = 8, size = 5<span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1038"><a href="#cb17-1038"></a>      <span class="ex">annotate</span><span class="er">(</span><span class="st">"text"</span><span class="ex">,</span>  x = dat<span class="va">$tangency$sigma_p</span>, y = dat<span class="va">$tangency$mu_p</span>,</span>
<span id="cb17-1039"><a href="#cb17-1039"></a>               <span class="ex">label</span> = <span class="st">"接点"</span>, vjust = 1.5, fontface = <span class="st">"bold"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1040"><a href="#cb17-1040"></a></span>
<span id="cb17-1041"><a href="#cb17-1041"></a>      <span class="ex">scale_color_manual</span><span class="er">(</span><span class="ex">values</span> = c<span class="er">(</span><span class="st">"資本市場線"</span> = <span class="st">"red"</span>, <span class="st">"効率的フロンティア"</span> = <span class="st">"blue"</span><span class="kw">))</span> <span class="ex">+</span></span>
<span id="cb17-1042"><a href="#cb17-1042"></a>      <span class="ex">labs</span><span class="er">(</span><span class="ex">x</span> = <span class="st">"リスク (標準偏差)"</span>, y = <span class="st">"期待リターン"</span><span class="kw">)</span> <span class="ex">+</span></span>
<span id="cb17-1043"><a href="#cb17-1043"></a>      <span class="ex">xlim</span><span class="er">(</span><span class="ex">0,</span> 0.7<span class="kw">)</span> <span class="ex">+</span> ylim<span class="er">(</span><span class="ex">-0.05,</span> 0.5<span class="kw">)</span></span>
<span id="cb17-1044"><a href="#cb17-1044"></a>  <span class="kw">})</span></span>
<span id="cb17-1045"><a href="#cb17-1045"></a></span>
<span id="cb17-1046"><a href="#cb17-1046"></a>  <span class="co"># 数値情報</span></span>
<span id="cb17-1047"><a href="#cb17-1047"></a>  <span class="ex">output</span><span class="va">$tangencyInfo</span> <span class="op">&lt;</span>- renderText<span class="er">(</span><span class="kw">{</span></span>
<span id="cb17-1048"><a href="#cb17-1048"></a>    <span class="ex">t</span> <span class="op">&lt;</span>- data_reactive<span class="er">(</span><span class="kw">)</span><span class="va">$tangency</span></span>
<span id="cb17-1049"><a href="#cb17-1049"></a>    <span class="ex">sprintf</span><span class="er">(</span></span>
<span id="cb17-1050"><a href="#cb17-1050"></a>      <span class="st">"【接点ポートフォリオ】 期待リターン: %.2f%%, リスク: %.2f%% (シャープレシオ: %.4f) | 構成比: A %.1f%% : B %.1f%%"</span><span class="ex">,</span></span>
<span id="cb17-1051"><a href="#cb17-1051"></a>      <span class="ex">t</span><span class="va">$mu_p</span> <span class="pp">*</span> 100, t<span class="va">$sigma_p</span> <span class="pp">*</span> 100, t<span class="va">$sharpe_ratio</span>,</span>
<span id="cb17-1052"><a href="#cb17-1052"></a>      <span class="ex">t</span><span class="va">$w</span> <span class="pp">*</span> 100, <span class="er">(</span><span class="ex">1</span> <span class="at">-</span> t<span class="va">$w</span><span class="kw">)</span> <span class="ex">*</span> 100</span>
<span id="cb17-1053"><a href="#cb17-1053"></a>    <span class="kw">)</span></span>
<span id="cb17-1054"><a href="#cb17-1054"></a>  <span class="kw">})</span></span>
<span id="cb17-1055"><a href="#cb17-1055"></a><span class="kw">}</span></span>
<span id="cb17-1056"><a href="#cb17-1056"></a></span>
<span id="cb17-1057"><a href="#cb17-1057"></a><span class="co"># アプリの起動</span></span>
<span id="cb17-1058"><a href="#cb17-1058"></a><span class="ex">shinyApp</span><span class="er">(</span><span class="ex">ui</span> = ui, server = server<span class="kw">)</span></span>
<span id="cb17-1059"><a href="#cb17-1059"></a><span class="in">```</span></span>
<span id="cb17-1060"><a href="#cb17-1060"></a></span>
<span id="cb17-1061"><a href="#cb17-1061"></a><span class="fu">### 投資家のリスク回避度と最適ポートフォリオ</span></span>
<span id="cb17-1062"><a href="#cb17-1062"></a></span>
<span id="cb17-1063"><a href="#cb17-1063"></a>効率的フロンティアのうち、どの点が投資家の最適ポートフォリオになるのか，について考える。</span>
<span id="cb17-1064"><a href="#cb17-1064"></a>そのためには投資家のリスク・リターンのトレードオフに関する**選好(preference)**の特徴，つまり**リスクの回避度**の情報が必要となる。</span>
<span id="cb17-1065"><a href="#cb17-1065"></a>$(\mu_P,\rho_p)$平面上でそれを描く方法の一つが**無差別曲線**(indifference curve)である。</span>
<span id="cb17-1066"><a href="#cb17-1066"></a>**無差別曲線**とは，投資家の効用(utility)が**一定**となるリスクとリターンの組み合わせを描いた曲線をいう。つまり同じ効用水準を達成できるリスクとリターンの組み合わせを表現した曲線である。</span>
<span id="cb17-1067"><a href="#cb17-1067"></a></span>
<span id="cb17-1068"><a href="#cb17-1068"></a></span>
<span id="cb17-1069"><a href="#cb17-1069"></a></span>
<span id="cb17-1070"><a href="#cb17-1070"></a></span>
<span id="cb17-1071"><a href="#cb17-1071"></a></span>
<span id="cb17-1072"><a href="#cb17-1072"></a><span class="fu">#### 効用関数の例</span></span>
<span id="cb17-1073"><a href="#cb17-1073"></a></span>
<span id="cb17-1074"><a href="#cb17-1074"></a>以下では，財$x$と$y$を消費したときの効用$U$を図示している。この消費者の効用関数は$U(x,y) = x^{\frac 25} \times y^{\frac 35}$としている。</span>
<span id="cb17-1075"><a href="#cb17-1075"></a><span class="in">```{r utility_function_plotly, filename="効用関数の3Dプロット"}</span></span>
<span id="cb17-1076"><a href="#cb17-1076"></a><span class="co">#| warning: false</span></span>
<span id="cb17-1077"><a href="#cb17-1077"></a><span class="co">#| message: false</span></span>
<span id="cb17-1078"><a href="#cb17-1078"></a></span>
<span id="cb17-1079"><a href="#cb17-1079"></a><span class="co"># 1. データ作成</span></span>
<span id="cb17-1080"><a href="#cb17-1080"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb17-1081"><a href="#cb17-1081"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb17-1082"><a href="#cb17-1082"></a><span class="co"># 効用関数の定義と行列計算</span></span>
<span id="cb17-1083"><a href="#cb17-1083"></a>u_func <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) { x<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> y<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>) }</span>
<span id="cb17-1084"><a href="#cb17-1084"></a>U <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, u_func)</span>
<span id="cb17-1085"><a href="#cb17-1085"></a></span>
<span id="cb17-1086"><a href="#cb17-1086"></a><span class="co"># 2. plotlyで描画</span></span>
<span id="cb17-1087"><a href="#cb17-1087"></a><span class="co"># 表面の色を半透明にして，等高線を底面に投影</span></span>
<span id="cb17-1088"><a href="#cb17-1088"></a><span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>U) <span class="sc">|&gt;</span></span>
<span id="cb17-1089"><a href="#cb17-1089"></a>  <span class="fu">add_surface</span>(</span>
<span id="cb17-1090"><a href="#cb17-1090"></a>    <span class="co"># 表面に等高線を描く設定</span></span>
<span id="cb17-1091"><a href="#cb17-1091"></a>    <span class="at">contours =</span> <span class="fu">list</span>(</span>
<span id="cb17-1092"><a href="#cb17-1092"></a>      <span class="at">z =</span> <span class="fu">list</span>(</span>
<span id="cb17-1093"><a href="#cb17-1093"></a>        <span class="at">show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-1094"><a href="#cb17-1094"></a>        <span class="at">usecolormap =</span> <span class="cn">TRUE</span>, <span class="co"># 色分けを反映</span></span>
<span id="cb17-1095"><a href="#cb17-1095"></a>        <span class="at">highlightcolor =</span> <span class="st">"#ff0000"</span>, <span class="co"># マウスオーバー時の線色</span></span>
<span id="cb17-1096"><a href="#cb17-1096"></a>        <span class="at">project =</span> <span class="fu">list</span>(<span class="at">z =</span> <span class="cn">TRUE</span>) <span class="co"># 【重要】底面に等高線（無差別曲線）を投影</span></span>
<span id="cb17-1097"><a href="#cb17-1097"></a>      )</span>
<span id="cb17-1098"><a href="#cb17-1098"></a>    ),</span>
<span id="cb17-1099"><a href="#cb17-1099"></a>    <span class="at">colorscale =</span> <span class="st">"Viridis"</span>, <span class="co"># 視認性の良いカラーパレット</span></span>
<span id="cb17-1100"><a href="#cb17-1100"></a>    <span class="at">opacity =</span> <span class="fl">0.6</span></span>
<span id="cb17-1101"><a href="#cb17-1101"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-1102"><a href="#cb17-1102"></a>  <span class="fu">layout</span>(</span>
<span id="cb17-1103"><a href="#cb17-1103"></a>    <span class="at">title =</span> <span class="st">"コブ＝ダグラス型効用関数"</span>,</span>
<span id="cb17-1104"><a href="#cb17-1104"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb17-1105"><a href="#cb17-1105"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"財 x"</span>),</span>
<span id="cb17-1106"><a href="#cb17-1106"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"財 y"</span>),</span>
<span id="cb17-1107"><a href="#cb17-1107"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"効用 U"</span>),</span>
<span id="cb17-1108"><a href="#cb17-1108"></a>      <span class="co"># 初期視点の調整 (perspのtheta/phiに近い感覚で設定)</span></span>
<span id="cb17-1109"><a href="#cb17-1109"></a>      <span class="at">camera =</span> <span class="fu">list</span>(<span class="at">eye =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">z =</span> <span class="fl">1.2</span>))</span>
<span id="cb17-1110"><a href="#cb17-1110"></a>    )</span>
<span id="cb17-1111"><a href="#cb17-1111"></a>  )</span>
<span id="cb17-1112"><a href="#cb17-1112"></a><span class="in">```</span></span>
<span id="cb17-1113"><a href="#cb17-1113"></a></span>
<span id="cb17-1116"><a href="#cb17-1116"></a><span class="in">```{r}</span></span>
<span id="cb17-1117"><a href="#cb17-1117"></a><span class="co">#| eval: false</span></span>
<span id="cb17-1118"><a href="#cb17-1118"></a><span class="co">#| echo: false</span></span>
<span id="cb17-1119"><a href="#cb17-1119"></a><span class="co"># データ作成</span></span>
<span id="cb17-1120"><a href="#cb17-1120"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb17-1121"><a href="#cb17-1121"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb17-1122"><a href="#cb17-1122"></a>u <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {x<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> y<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>)}</span>
<span id="cb17-1123"><a href="#cb17-1123"></a>U <span class="ot">&lt;-</span> <span class="fu">outer</span>(x, y, u)</span>
<span id="cb17-1124"><a href="#cb17-1124"></a></span>
<span id="cb17-1125"><a href="#cb17-1125"></a><span class="co"># 色の準備（高さに応じて色を変える処理）</span></span>
<span id="cb17-1126"><a href="#cb17-1126"></a>nrz <span class="ot">&lt;-</span> <span class="fu">nrow</span>(U)</span>
<span id="cb17-1127"><a href="#cb17-1127"></a>ncz <span class="ot">&lt;-</span> <span class="fu">ncol</span>(U)</span>
<span id="cb17-1128"><a href="#cb17-1128"></a><span class="co"># グラデーションパレットを作成 (青→緑→黄)</span></span>
<span id="cb17-1129"><a href="#cb17-1129"></a>jet.colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>))</span>
<span id="cb17-1130"><a href="#cb17-1130"></a>nbcol <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-1131"><a href="#cb17-1131"></a>color <span class="ot">&lt;-</span> <span class="fu">jet.colors</span>(nbcol)</span>
<span id="cb17-1132"><a href="#cb17-1132"></a><span class="co"># 高さ(z)を色のインデックスに変換</span></span>
<span id="cb17-1133"><a href="#cb17-1133"></a>zfacet <span class="ot">&lt;-</span> U[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> U[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span>ncz] <span class="sc">+</span> U[<span class="sc">-</span>nrz, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> U[<span class="sc">-</span>nrz, <span class="sc">-</span>ncz]</span>
<span id="cb17-1134"><a href="#cb17-1134"></a>facetcol <span class="ot">&lt;-</span> <span class="fu">cut</span>(zfacet, nbcol)</span>
<span id="cb17-1135"><a href="#cb17-1135"></a></span>
<span id="cb17-1136"><a href="#cb17-1136"></a><span class="co"># 描画</span></span>
<span id="cb17-1137"><a href="#cb17-1137"></a><span class="fu">persp</span>(x, y, U,</span>
<span id="cb17-1138"><a href="#cb17-1138"></a>      <span class="at">theta =</span> <span class="dv">45</span>, <span class="at">phi =</span> <span class="dv">30</span>,</span>
<span id="cb17-1139"><a href="#cb17-1139"></a>      <span class="at">col =</span> color[facetcol], <span class="co"># 計算した色を指定</span></span>
<span id="cb17-1140"><a href="#cb17-1140"></a>      <span class="at">shade =</span> <span class="fl">0.2</span>,           <span class="co"># 陰影</span></span>
<span id="cb17-1141"><a href="#cb17-1141"></a>      <span class="at">border =</span> <span class="cn">NA</span>,           <span class="co"># 枠線なしで滑らかに</span></span>
<span id="cb17-1142"><a href="#cb17-1142"></a>      <span class="at">ticktype =</span> <span class="st">"detailed"</span>,</span>
<span id="cb17-1143"><a href="#cb17-1143"></a>      <span class="at">xlab =</span> <span class="st">"財 x"</span>, <span class="at">ylab =</span> <span class="st">"財 y"</span>, <span class="at">zlab =</span> <span class="st">"効用 U"</span>,</span>
<span id="cb17-1144"><a href="#cb17-1144"></a>      <span class="at">main =</span> <span class="st">"効用関数の3Dプロット"</span>)</span>
<span id="cb17-1145"><a href="#cb17-1145"></a><span class="in">```</span></span>
<span id="cb17-1146"><a href="#cb17-1146"></a></span>
<span id="cb17-1147"><a href="#cb17-1147"></a>この立体図を等高線を使って表現したものが以下の図である。</span>
<span id="cb17-1148"><a href="#cb17-1148"></a>青いラインは予算制約であり、予算の範囲内で購入可能な財の組み合わせを意味している。つまり、この予算制約と無差別曲線が接する点が、予算内で達成可能な最も高い効用水準を表している。</span>
<span id="cb17-1149"><a href="#cb17-1149"></a></span>
<span id="cb17-1150"><a href="#cb17-1150"></a>無リスク利子率が10%で，リスクプレミアムが5％，βが1.2の場合の期待リターンは，$R_F + \beta \times (R_M - R_F) = 0.1 + 1.2 \times 0.05 = 0.16$となる。このときの無差別曲線は，$U = 0.16$となるような点を結んだ曲線となる。</span>
<span id="cb17-1151"><a href="#cb17-1151"></a></span>
<span id="cb17-1152"><a href="#cb17-1152"></a><span class="in">```{r indifference_curve}</span></span>
<span id="cb17-1153"><a href="#cb17-1153"></a><span class="co">#| fig-cap: "無差別曲線と消費可能集合"</span></span>
<span id="cb17-1154"><a href="#cb17-1154"></a><span class="co">#| fig-aligned: center</span></span>
<span id="cb17-1155"><a href="#cb17-1155"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb17-1156"><a href="#cb17-1156"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb17-1157"><a href="#cb17-1157"></a><span class="fu">contour</span>(x, y, U, <span class="at">method =</span> <span class="st">"edge"</span>, <span class="at">labcex =</span> <span class="dv">1</span>,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb17-1158"><a href="#cb17-1158"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">b =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>) <span class="co">#予算制約線</span></span>
<span id="cb17-1159"><a href="#cb17-1159"></a><span class="fu">points</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">pch =</span> <span class="dv">16</span>) <span class="co">#最適消費点</span></span>
<span id="cb17-1160"><a href="#cb17-1160"></a><span class="in">```</span></span>
<span id="cb17-1161"><a href="#cb17-1161"></a></span>
<span id="cb17-1162"><a href="#cb17-1162"></a>リスクとリターンの無差別曲線</span>
<span id="cb17-1163"><a href="#cb17-1163"></a></span>
<span id="cb17-1164"><a href="#cb17-1164"></a><span class="co">&lt;!-- ![無差別曲線と効率的フロンティアに基づく最適ポート フォリオの決定](img/KM_fig_2-12.jpg) --&gt;</span></span>
<span id="cb17-1165"><a href="#cb17-1165"></a></span>
<span id="cb17-1166"><a href="#cb17-1166"></a>複数ポートフォリオを比べるとき，この図の左上のものほど高リターン低リスクに対応するので、より高い効用水準が実現する。</span>
<span id="cb17-1167"><a href="#cb17-1167"></a>また無差別曲線の**局所的な傾き**は、その投資家が追加的なリスクを引き受けるうえで要求するリスクプレミアムを表す。</span>
<span id="cb17-1168"><a href="#cb17-1168"></a>リスク回避的な投資家ほど，リスクを1単位負担する際に，より大きなリスクプレミアムを要求するので、傾きは大きくなる。</span>
<span id="cb17-1169"><a href="#cb17-1169"></a>つまり，1単位リスクを負担する代わりに欲しいリターンの額が大きくなるほど，傾きが大きくなる。</span>
<span id="cb17-1170"><a href="#cb17-1170"></a></span>
<span id="cb17-1171"><a href="#cb17-1171"></a>無差別曲線と効率的フロンティアが接する点が、この投資家にとっての最適ポートフォリオとなる。</span>
<span id="cb17-1172"><a href="#cb17-1172"></a>投資可能なポートフォリオの範囲で、最も左上の無差別曲線を実現するのが接点となる。</span>
<span id="cb17-1173"><a href="#cb17-1173"></a>どの点が最適ポートフォリオとして選ばれるかは個々の投資家の無差別曲線の形状(リスク回避度)に依存する。最適ポートフォリオにおいて、無差別曲線と効率的フロンティアの局所的な傾きは一致(接線だから当然)するため、その投資家が要求するリスクプレミアムがちょうど実現されている。</span>
<span id="cb17-1174"><a href="#cb17-1174"></a></span>
<span id="cb17-1175"><a href="#cb17-1175"></a>上図の場合，この投資家の最適ポートフォリオは$(w_F,w_{tan})\approx(0.29,0.71)$の比率で構成される。</span>
<span id="cb17-1176"><a href="#cb17-1176"></a></span>
<span id="cb17-1177"><a href="#cb17-1177"></a>接点ポートフォリオは銘柄Aに47％、銘柄Bに53％投資するポートフォリオだったので、最適保有比率は、$(w_F,w_A,w_B)\approx(0.29,0.33,0.38)$と書き換えられる。</span>
<span id="cb17-1178"><a href="#cb17-1178"></a></span>
<span id="cb17-1179"><a href="#cb17-1179"></a><span class="fu">### トービンの分離定理</span></span>
<span id="cb17-1180"><a href="#cb17-1180"></a></span>
<span id="cb17-1181"><a href="#cb17-1181"></a>安全資産が投資可能な場合の最適ポートフォリオ問題を考える。</span>
<span id="cb17-1182"><a href="#cb17-1182"></a></span>
<span id="cb17-1183"><a href="#cb17-1183"></a><span class="ss">1. </span>接点ポートフォリオを求め、リスク資産同士の相対的な保有比率を求める。</span>
<span id="cb17-1184"><a href="#cb17-1184"></a><span class="ss">2. </span>投資家ごとのリスク回避度に応じて安全資産と接点ポートフォリオの最適保有比率の決定</span>
<span id="cb17-1185"><a href="#cb17-1185"></a></span>
<span id="cb17-1186"><a href="#cb17-1186"></a>1は各投資家で共通している。</span>
<span id="cb17-1187"><a href="#cb17-1187"></a>いったん接点ポートフォリオを求めてしまえば、他の投資家はその情報を用いて2を考えればよい。</span>
<span id="cb17-1188"><a href="#cb17-1188"></a></span>
<span id="cb17-1189"><a href="#cb17-1189"></a>最適ポートフォリオ問題を2段階に分離できるという命題は、**トービンの分離定理**(又は二基金分離定理)と呼ばれている。</span>
<span id="cb17-1190"><a href="#cb17-1190"></a></span>
<span id="cb17-1191"><a href="#cb17-1191"></a></span>
<span id="cb17-1192"><a href="#cb17-1192"></a></span>
<span id="cb17-1193"><a href="#cb17-1193"></a><span class="fu">## CAPM</span></span>
<span id="cb17-1194"><a href="#cb17-1194"></a></span>
<span id="cb17-1195"><a href="#cb17-1195"></a>金融市場全体の均衡を考えるために、**資本資産価格モデル**(Capital Asset Pricing Model; CAPM)を学習します。</span>
<span id="cb17-1196"><a href="#cb17-1196"></a></span>
<span id="cb17-1197"><a href="#cb17-1197"></a><span class="fu">### 仮定の確認</span></span>
<span id="cb17-1198"><a href="#cb17-1198"></a></span>
<span id="cb17-1199"><a href="#cb17-1199"></a><span class="ss">- </span>**選好** : ポートフォリオを**期待値と標準偏差の基準で評価**</span>
<span id="cb17-1200"><a href="#cb17-1200"></a><span class="ss">- </span>**取引コスト** : 取引コストは存在せず、空売りも自由</span>
<span id="cb17-1201"><a href="#cb17-1201"></a><span class="ss">- </span>**流動性** : どれだけ売買しても証券の価格は不変</span>
<span id="cb17-1202"><a href="#cb17-1202"></a><span class="ss">- </span>**情報集合** : みんな同じ情報を共有</span>
<span id="cb17-1203"><a href="#cb17-1203"></a></span>
<span id="cb17-1204"><a href="#cb17-1204"></a>上記の仮定を満たす市場のことを、**完全資本市場**(完全市場: perfect market)と呼びます。</span>
<span id="cb17-1205"><a href="#cb17-1205"></a>空想上の市場ですが、理論構築の大事な出発点です。</span>
<span id="cb17-1206"><a href="#cb17-1206"></a></span>
<span id="cb17-1207"><a href="#cb17-1207"></a><span class="fu">### CAPMの第一命題</span></span>
<span id="cb17-1208"><a href="#cb17-1208"></a></span>
<span id="cb17-1209"><a href="#cb17-1209"></a>先の仮定の下で、安全資産が投資可能なとき、全ての投資家の最適ポートフォリオ問題に対してトービンの分離定理を応用することができます。</span>
<span id="cb17-1210"><a href="#cb17-1210"></a>全ての投資家は「安全資産」と「接点ポートフォリオ」のみに投資し、危険資産に限定すれば全員が同じ構成比率のポートフォリオ（接点ポートフォリオ）を保有します。</span>
<span id="cb17-1211"><a href="#cb17-1211"></a>金融市場全体の均衡を議論するうえで、市場にその資産が供給されている以上、誰かがその最適ポートフォリオの一部として保有しているはずです。</span>
<span id="cb17-1212"><a href="#cb17-1212"></a>すなわち、需要と供給が一致している点がポイントです。</span>
<span id="cb17-1213"><a href="#cb17-1213"></a></span>
<span id="cb17-1214"><a href="#cb17-1214"></a>以上の議論をよりフォーマルに述べるために、市場ポートフォリオを導入します。</span>
<span id="cb17-1215"><a href="#cb17-1215"></a></span>
<span id="cb17-1216"><a href="#cb17-1216"></a>::: {.callout-important}</span>
<span id="cb17-1217"><a href="#cb17-1217"></a><span class="fu">## 市場ポートフォリオ</span></span>
<span id="cb17-1218"><a href="#cb17-1218"></a></span>
<span id="cb17-1219"><a href="#cb17-1219"></a>**市場ポートフォリオ (market portfolio)** とは、市場に存在する全ての危険資産を時価総額比率で保有したポートフォリオをいう。厳密には、リスク資産には株式や債券に代表される金融資産の他、不動産や貴金属などの実物資産も含まれるが、実用上はTOPIXやS&amp;P500といった株価指数と同一視されることが多い。</span>
<span id="cb17-1220"><a href="#cb17-1220"></a>:::</span>
<span id="cb17-1221"><a href="#cb17-1221"></a></span>
<span id="cb17-1222"><a href="#cb17-1222"></a>::: {.callout-important}</span>
<span id="cb17-1223"><a href="#cb17-1223"></a><span class="fu">## CAPMの第一命題</span></span>
<span id="cb17-1224"><a href="#cb17-1224"></a></span>
<span id="cb17-1225"><a href="#cb17-1225"></a>市場ポートフォリオは接点ポートフォリオと一致し、効率的フロンティア（資本市場線）上に位置する。</span>
<span id="cb17-1226"><a href="#cb17-1226"></a>:::</span>
<span id="cb17-1227"><a href="#cb17-1227"></a></span>
<span id="cb17-1228"><a href="#cb17-1228"></a></span>
<span id="cb17-1229"><a href="#cb17-1229"></a>投資家は市場ポートフォリオに投資するとき、$\sigma_M$ のリスクを背負う見返りとして、$R_F$ に加えて $\mu_M-R_F$ だけ追加的な報酬を期待します。</span>
<span id="cb17-1230"><a href="#cb17-1230"></a>この追加的な報酬を**市場リスクプレミアム** (market risk premium) といいます。したがってこの命題の下では、資本市場線を市場リスクプレミアム $(\mu_M-R_F)$ を利用して、以下のように表せます。</span>
<span id="cb17-1231"><a href="#cb17-1231"></a></span>
<span id="cb17-1232"><a href="#cb17-1232"></a>$$</span>
<span id="cb17-1233"><a href="#cb17-1233"></a>\mu_P = R_F + \frac{\mu_M - R_F}{\sigma_M} \sigma_P</span>
<span id="cb17-1234"><a href="#cb17-1234"></a>$$</span>
<span id="cb17-1235"><a href="#cb17-1235"></a></span>
<span id="cb17-1236"><a href="#cb17-1236"></a><span class="co">&lt;!-- ![CAPM](img/KM_fig_2-13.png) --&gt;</span></span>
<span id="cb17-1237"><a href="#cb17-1237"></a></span>
<span id="cb17-1238"><a href="#cb17-1238"></a>前の章で用いたパラメータをそのまま考えます。</span>
<span id="cb17-1239"><a href="#cb17-1239"></a>接点ポートフォリオの保有比率は概ね47%を銘柄Aに、53%を銘柄Bに投資する結果となりました。CAPMの第一命題によると、均衡した市場における銘柄AとBの時価総額比率は約0.47対0.53になっていなければなりません。</span>
<span id="cb17-1240"><a href="#cb17-1240"></a>この命題に従えば、投資家は各銘柄の期待リターンや分散から接点ポートフォリオを計算する必要はなく、単に時価総額加重で市場ポートフォリオを保有すればよいことになります。</span>
<span id="cb17-1241"><a href="#cb17-1241"></a></span>
<span id="cb17-1242"><a href="#cb17-1242"></a><span class="ss">- </span>**パッシブ運用：** 幅広い銘柄に分散投資し、市場平均と同じようなパフォーマンスを目指す運用手法。</span>
<span id="cb17-1243"><a href="#cb17-1243"></a><span class="ss">- </span>**アクティブ運用：** 市場平均を上回るパフォーマンスを目指し、投資銘柄を絞ったり、投資比率を工夫したりする運用方法。</span>
<span id="cb17-1244"><a href="#cb17-1244"></a></span>
<span id="cb17-1245"><a href="#cb17-1245"></a>任意のポートフォリオの収益性を測る指標として、**シャープ・レシオ**が提唱されています。シャープ・レシオは追加的なリスク・テイクによってどれだけリスクプレミアムを改善できるのかを表す指標です。CAPMの第一命題によると、市場ポートフォリオはシャープ・レシオを最大化するという意味で最も効率的なポートフォリオであり、資本市場線の傾き $\frac{\mu_M - R_F}{\sigma_M}$ は市場ポートフォリオのシャープ・レシオと一致します。</span>
<span id="cb17-1246"><a href="#cb17-1246"></a></span>
<span id="cb17-1247"><a href="#cb17-1247"></a>$$</span>
<span id="cb17-1248"><a href="#cb17-1248"></a>\text{Sharpe Ratio} = \frac{\mu_P-R_F}{\sigma_P}</span>
<span id="cb17-1249"><a href="#cb17-1249"></a>$$</span>
<span id="cb17-1250"><a href="#cb17-1250"></a></span>
<span id="cb17-1251"><a href="#cb17-1251"></a></span>
<span id="cb17-1252"><a href="#cb17-1252"></a><span class="fu">### CAPMの第二命題</span></span>
<span id="cb17-1253"><a href="#cb17-1253"></a></span>
<span id="cb17-1254"><a href="#cb17-1254"></a>第二命題は個々の資産のリスクとリターンのトレードオフを数式で表現したものです。</span>
<span id="cb17-1255"><a href="#cb17-1255"></a>ある証券に投資するときのリスクと、その証券に投資するときの期待リターンとの関係を知ることができるようになります。</span>
<span id="cb17-1256"><a href="#cb17-1256"></a></span>
<span id="cb17-1257"><a href="#cb17-1257"></a>各投資家が証券 $i$ を追加的に保有する際、重要となるのは市場ポートフォリオとの相関です。分散が大きい資産であっても、市場ポートフォリオと負に相関していれば、その資産を追加的に保有することでポートフォリオ全体のリスクは低減されます。CAPMの第二命題は、この相関を以下の**マーケット・ベータ**として定量化します。</span>
<span id="cb17-1258"><a href="#cb17-1258"></a>（※ $R_i$ は証券 $i$ のリターン、$R_M$ は市場ポートフォリオのリターン）</span>
<span id="cb17-1259"><a href="#cb17-1259"></a></span>
<span id="cb17-1260"><a href="#cb17-1260"></a>この $\beta_i$ は市場ポートフォリオのリスクを1としてベンチマーク化し、その証券のリスクがベンチマークの1を上回るか下回るかを測るものです。$\beta_i$ が大きいほど証券 $i$ は投資家にとってリスク（システマティック・リスク）が大きいことを意味します。CAPMの世界では、証券 $i$ のリスクはその証券のリターンの標準偏差ではなく、この $\beta_i$ によって測られます。</span>
<span id="cb17-1261"><a href="#cb17-1261"></a></span>
<span id="cb17-1262"><a href="#cb17-1262"></a>$$</span>
<span id="cb17-1263"><a href="#cb17-1263"></a>\beta_i = \frac{\mathbb{Cov}<span class="co">[</span><span class="ot">R_i, R_M</span><span class="co">]</span>}{\mathbb{Var}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span>}</span>
<span id="cb17-1264"><a href="#cb17-1264"></a>$$</span>
<span id="cb17-1265"><a href="#cb17-1265"></a></span>
<span id="cb17-1266"><a href="#cb17-1266"></a>金融市場全体が均衡しているには、リスクの高い証券はその分だけ期待リターンも高くなければなりません。</span>
<span id="cb17-1267"><a href="#cb17-1267"></a>もし $\beta_i$ が低いにもかかわらず期待リターンが高い証券があるなら、投資家は市場ポートフォリオから離れてその証券をさらに買い増しするインセンティブを持ちます。</span>
<span id="cb17-1268"><a href="#cb17-1268"></a>その結果、市場価格が上がり、期待リターンが下がるため、最終的に $\beta_i$ に応じた期待リターンが均衡で実現されます。</span>
<span id="cb17-1269"><a href="#cb17-1269"></a></span>
<span id="cb17-1270"><a href="#cb17-1270"></a>これまでは市場リスクプレミアムを $\mu_M - R_F$ と表記していましたが、以後ではより一般的な $\mathbb{E}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span> - R_F$ と表記します。</span>
<span id="cb17-1271"><a href="#cb17-1271"></a></span>
<span id="cb17-1272"><a href="#cb17-1272"></a>::: {.callout-important}</span>
<span id="cb17-1273"><a href="#cb17-1273"></a><span class="fu">## CAPMの第二命題</span></span>
<span id="cb17-1274"><a href="#cb17-1274"></a></span>
<span id="cb17-1275"><a href="#cb17-1275"></a>各証券のリスクプレミアムは、その証券のマーケット・ベータに比例する。</span>
<span id="cb17-1276"><a href="#cb17-1276"></a>この式は、証券 $i$ のリスクプレミアム $\mathbb{E}<span class="co">[</span><span class="ot">R_i</span><span class="co">]</span>-R_F$ を、$\beta_i$ と市場リスクプレミアム $\mathbb{E}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span>-R_F$ に分解している。</span>
<span id="cb17-1277"><a href="#cb17-1277"></a>:::</span>
<span id="cb17-1278"><a href="#cb17-1278"></a></span>
<span id="cb17-1279"><a href="#cb17-1279"></a>$$</span>
<span id="cb17-1280"><a href="#cb17-1280"></a>\begin{aligned}</span>
<span id="cb17-1281"><a href="#cb17-1281"></a>\mathbb{E}<span class="co">[</span><span class="ot">R_i</span><span class="co">]</span>-R_F = \beta_i (\mathbb{E}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span> - R_F)<span class="sc">\\</span></span>
<span id="cb17-1282"><a href="#cb17-1282"></a>\text{ただし、 } \beta_i = \frac{\mathbb{Cov}<span class="co">[</span><span class="ot">R_i,R_M</span><span class="co">]</span>}{\mathbb{Var}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span>}</span>
<span id="cb17-1283"><a href="#cb17-1283"></a>\end{aligned}</span>
<span id="cb17-1284"><a href="#cb17-1284"></a>$$</span>
<span id="cb17-1285"><a href="#cb17-1285"></a></span>
<span id="cb17-1286"><a href="#cb17-1286"></a>通常、市場リスクプレミアムは正の値をとるので、CAPMの第二命題によると、個々の証券のリスクプレミアムは $\beta_i$ に関して線形に増加します。</span>
<span id="cb17-1287"><a href="#cb17-1287"></a>$\beta_i$ はあくまで市場ポートフォリオとの相関でリスクを定量化しているのがポイントです。</span>
<span id="cb17-1288"><a href="#cb17-1288"></a>いくら個々の証券の分散（リスク）が大きくても、それが市場ポートフォリオと相関しない固有リスクであれば、リスクプレミアムには反映されません。</span>
<span id="cb17-1289"><a href="#cb17-1289"></a>期待値をとる前の $R_i$ を分解して確認します。</span>
<span id="cb17-1290"><a href="#cb17-1290"></a></span>
<span id="cb17-1291"><a href="#cb17-1291"></a>$$</span>
<span id="cb17-1292"><a href="#cb17-1292"></a>R_i = R_F + \beta_i (R_M - R_F) + \varepsilon_i</span>
<span id="cb17-1293"><a href="#cb17-1293"></a>$$</span>
<span id="cb17-1294"><a href="#cb17-1294"></a></span>
<span id="cb17-1295"><a href="#cb17-1295"></a>ここで $\varepsilon_i$ は期待値ゼロで $R_M$ と相関しない誤差項です。</span>
<span id="cb17-1296"><a href="#cb17-1296"></a></span>
<span id="cb17-1297"><a href="#cb17-1297"></a>$$</span>
<span id="cb17-1298"><a href="#cb17-1298"></a>\mathbb{E}<span class="co">[</span><span class="ot">\varepsilon_i</span><span class="co">]</span> = 0, \qquad \mathbb{Cov}<span class="co">[</span><span class="ot">\varepsilon_i, R_M</span><span class="co">]</span> = 0</span>
<span id="cb17-1299"><a href="#cb17-1299"></a>$$</span>
<span id="cb17-1300"><a href="#cb17-1300"></a></span>
<span id="cb17-1301"><a href="#cb17-1301"></a>分散を計算すると以下のようになります。</span>
<span id="cb17-1302"><a href="#cb17-1302"></a></span>
<span id="cb17-1303"><a href="#cb17-1303"></a>$$</span>
<span id="cb17-1304"><a href="#cb17-1304"></a>\begin{aligned}</span>
<span id="cb17-1305"><a href="#cb17-1305"></a>\mathbb{Var}<span class="co">[</span><span class="ot">R_i</span><span class="co">]</span> &amp;= \mathbb{Var}<span class="co">[</span><span class="ot">\beta_i R_M + \varepsilon_i</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb17-1306"><a href="#cb17-1306"></a>&amp; = \beta_i^2 \mathbb{Var}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span> + \mathbb{Var}<span class="co">[</span><span class="ot">\varepsilon_i</span><span class="co">]</span> + \underbrace{2\mathbb{Cov}<span class="co">[</span><span class="ot">\beta_i R_M, \varepsilon_i</span><span class="co">]</span>}_{\tiny =0}<span class="sc">\\</span></span>
<span id="cb17-1307"><a href="#cb17-1307"></a>&amp; = \underbrace{\beta_i^2 \mathbb{Var}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span>}_{\tiny 市場ポートフォリオとの相関による寄与分} + \underbrace{\mathbb{Var}[\varepsilon_i]}_{\tiny 誤差項による寄与分}</span>
<span id="cb17-1308"><a href="#cb17-1308"></a>\end{aligned}</span>
<span id="cb17-1309"><a href="#cb17-1309"></a>$$</span>
<span id="cb17-1310"><a href="#cb17-1310"></a></span>
<span id="cb17-1311"><a href="#cb17-1311"></a>$R_i$ の分散は、市場ポートフォリオとの相関による寄与分（システマティック・リスク）と誤差項による寄与分（固有リスク）に分解できます。</span>
<span id="cb17-1312"><a href="#cb17-1312"></a>誤差項の分散が大きければその分だけ $R_i$ の分散も大きくなりますが、証券 $i$ のリスクプレミアムは $\beta_i(\mathbb{E}<span class="co">[</span><span class="ot">R_M</span><span class="co">]</span>-R_F)$ のままで変化はありません。つまり、分散投資によって消去可能な固有リスクに対しては、市場は報酬（プレミアム）を与えないのです。</span>
<span id="cb17-1313"><a href="#cb17-1313"></a></span>
<span id="cb17-1314"><a href="#cb17-1314"></a><span class="fu">### 証券市場線</span></span>
<span id="cb17-1315"><a href="#cb17-1315"></a></span>
<span id="cb17-1316"><a href="#cb17-1316"></a>安全資産と複数の危険資産が投資可能な場合、投資家の最適ポートフォリオは資本市場線上の1点となります（図2.14 左図）。</span>
<span id="cb17-1317"><a href="#cb17-1317"></a>一方、CAPMの第二命題が示唆するように、各証券のリスク（ベータ）とリターンとの関係は、右上がりの直線となります（図2.14 右図）。</span>
<span id="cb17-1318"><a href="#cb17-1318"></a>縦軸に各証券の期待リターン、横軸に各証券のリスクを表すマーケット・ベータをとると、CAPMが完全に成立する世界では全ての資産が一直線上に並びます。この直線を**証券市場線** (Securities Market Line; SML) と呼びます。</span>
<span id="cb17-1319"><a href="#cb17-1319"></a></span>
<span id="cb17-1320"><a href="#cb17-1320"></a>定義通り $\beta$ を計算すると銘柄Aは約 $0.63$、銘柄Bは約 $1.33$ となります。</span>
<span id="cb17-1321"><a href="#cb17-1321"></a>両者の期待リターンおよび $\beta$ を図示すると証券市場線に乗っており、この仮想的な市場ではCAPMが成立していることがわかります。</span>
<span id="cb17-1322"><a href="#cb17-1322"></a></span>
<span id="cb17-1325"><a href="#cb17-1325"></a><span class="in">```{r}</span></span>
<span id="cb17-1326"><a href="#cb17-1326"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1327"><a href="#cb17-1327"></a><span class="co"># 1. パラメータ設定 (本文の記述と整合するように調整した数値)</span></span>
<span id="cb17-1328"><a href="#cb17-1328"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1329"><a href="#cb17-1329"></a><span class="co"># ※ ユーザーの手元に前の章のデータがある場合はそれを読み込んでください。</span></span>
<span id="cb17-1330"><a href="#cb17-1330"></a><span class="co"># ここでは本文中の「A:47%, B:53%」「Beta A:0.63, Beta B:1.33」</span></span>
<span id="cb17-1331"><a href="#cb17-1331"></a><span class="co"># と概ね一致するパラメータを設定します。</span></span>
<span id="cb17-1332"><a href="#cb17-1332"></a></span>
<span id="cb17-1333"><a href="#cb17-1333"></a>mu_A <span class="ot">&lt;-</span> <span class="fl">0.05</span>      <span class="co"># 銘柄Aの期待リターン</span></span>
<span id="cb17-1334"><a href="#cb17-1334"></a>sig_A <span class="ot">&lt;-</span> <span class="fl">0.10</span>     <span class="co"># 銘柄Aの標準偏差</span></span>
<span id="cb17-1335"><a href="#cb17-1335"></a>mu_B <span class="ot">&lt;-</span> <span class="fl">0.12</span>      <span class="co"># 銘柄Bの期待リターン</span></span>
<span id="cb17-1336"><a href="#cb17-1336"></a>sig_B <span class="ot">&lt;-</span> <span class="fl">0.20</span>     <span class="co"># 銘柄Bの標準偏差</span></span>
<span id="cb17-1337"><a href="#cb17-1337"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.2</span>        <span class="co"># 相関係数</span></span>
<span id="cb17-1338"><a href="#cb17-1338"></a>Rf <span class="ot">&lt;-</span> <span class="fl">0.01</span>        <span class="co"># 安全利子率</span></span>
<span id="cb17-1339"><a href="#cb17-1339"></a></span>
<span id="cb17-1340"><a href="#cb17-1340"></a><span class="co"># 共分散</span></span>
<span id="cb17-1341"><a href="#cb17-1341"></a>cov_AB <span class="ot">&lt;-</span> rho <span class="sc">*</span> sig_A <span class="sc">*</span> sig_B</span>
<span id="cb17-1342"><a href="#cb17-1342"></a></span>
<span id="cb17-1343"><a href="#cb17-1343"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1344"><a href="#cb17-1344"></a><span class="co"># 2. 接点ポートフォリオ(市場ポートフォリオ)の計算</span></span>
<span id="cb17-1345"><a href="#cb17-1345"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1346"><a href="#cb17-1346"></a><span class="co"># 過剰リターンベクトル</span></span>
<span id="cb17-1347"><a href="#cb17-1347"></a>R_excess <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_A <span class="sc">-</span> Rf, mu_B <span class="sc">-</span> Rf)</span>
<span id="cb17-1348"><a href="#cb17-1348"></a><span class="co"># 分散共分散行列</span></span>
<span id="cb17-1349"><a href="#cb17-1349"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_A<span class="sc">^</span><span class="dv">2</span>, cov_AB, cov_AB, sig_B<span class="sc">^</span><span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb17-1350"><a href="#cb17-1350"></a></span>
<span id="cb17-1351"><a href="#cb17-1351"></a><span class="co"># 接点ポートフォリオのウェイト計算 (解析解)</span></span>
<span id="cb17-1352"><a href="#cb17-1352"></a>Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma)</span>
<span id="cb17-1353"><a href="#cb17-1353"></a>w_tangency_unscaled <span class="ot">&lt;-</span> Sigma_inv <span class="sc">%*%</span> R_excess</span>
<span id="cb17-1354"><a href="#cb17-1354"></a>w_M <span class="ot">&lt;-</span> w_tangency_unscaled <span class="sc">/</span> <span class="fu">sum</span>(w_tangency_unscaled) <span class="co"># ウェイトの和を1にする</span></span>
<span id="cb17-1355"><a href="#cb17-1355"></a></span>
<span id="cb17-1356"><a href="#cb17-1356"></a><span class="co"># 市場ポートフォリオの期待リターンとリスク</span></span>
<span id="cb17-1357"><a href="#cb17-1357"></a>mu_M <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(w_M) <span class="sc">%*%</span> <span class="fu">c</span>(mu_A, mu_B))</span>
<span id="cb17-1358"><a href="#cb17-1358"></a>sig_M <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sqrt</span>(<span class="fu">t</span>(w_M) <span class="sc">%*%</span> Sigma <span class="sc">%*%</span> w_M))</span>
<span id="cb17-1359"><a href="#cb17-1359"></a></span>
<span id="cb17-1360"><a href="#cb17-1360"></a><span class="co"># Betaの計算: Cov(Ri, RM) / Var(RM)</span></span>
<span id="cb17-1361"><a href="#cb17-1361"></a><span class="co"># Cov(Ra, Rm) = w_A*Var(A) + w_B*Cov(A,B)</span></span>
<span id="cb17-1362"><a href="#cb17-1362"></a>cov_AM <span class="ot">&lt;-</span> w_M[<span class="dv">1</span>] <span class="sc">*</span> sig_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> w_M[<span class="dv">2</span>] <span class="sc">*</span> cov_AB</span>
<span id="cb17-1363"><a href="#cb17-1363"></a>cov_BM <span class="ot">&lt;-</span> w_M[<span class="dv">1</span>] <span class="sc">*</span> cov_AB <span class="sc">+</span> w_M[<span class="dv">2</span>] <span class="sc">*</span> sig_B<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-1364"><a href="#cb17-1364"></a></span>
<span id="cb17-1365"><a href="#cb17-1365"></a>beta_A <span class="ot">&lt;-</span> cov_AM <span class="sc">/</span> sig_M<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-1366"><a href="#cb17-1366"></a>beta_B <span class="ot">&lt;-</span> cov_BM <span class="sc">/</span> sig_M<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-1367"><a href="#cb17-1367"></a></span>
<span id="cb17-1368"><a href="#cb17-1368"></a><span class="co"># データフレーム化 (プロット用)</span></span>
<span id="cb17-1369"><a href="#cb17-1369"></a>assets <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-1370"><a href="#cb17-1370"></a>  <span class="at">Asset =</span> <span class="fu">c</span>(<span class="st">"銘柄A"</span>, <span class="st">"銘柄B"</span>, <span class="st">"市場PF"</span>),</span>
<span id="cb17-1371"><a href="#cb17-1371"></a>  <span class="at">Mu =</span> <span class="fu">c</span>(mu_A, mu_B, mu_M),</span>
<span id="cb17-1372"><a href="#cb17-1372"></a>  <span class="at">Sigma =</span> <span class="fu">c</span>(sig_A, sig_B, sig_M),</span>
<span id="cb17-1373"><a href="#cb17-1373"></a>  <span class="at">Beta =</span> <span class="fu">c</span>(beta_A, beta_B, <span class="dv">1</span>) <span class="co"># 市場PFのベータは定義上1</span></span>
<span id="cb17-1374"><a href="#cb17-1374"></a>)</span>
<span id="cb17-1375"><a href="#cb17-1375"></a></span>
<span id="cb17-1376"><a href="#cb17-1376"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1377"><a href="#cb17-1377"></a><span class="co"># 3. 効率的フロンティアのデータ生成 (左図用)</span></span>
<span id="cb17-1378"><a href="#cb17-1378"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1379"><a href="#cb17-1379"></a>w_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb17-1380"><a href="#cb17-1380"></a>frontier_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-1381"><a href="#cb17-1381"></a>  <span class="at">w_A =</span> w_seq,</span>
<span id="cb17-1382"><a href="#cb17-1382"></a>  <span class="at">w_B =</span> <span class="dv">1</span> <span class="sc">-</span> w_seq</span>
<span id="cb17-1383"><a href="#cb17-1383"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-1384"><a href="#cb17-1384"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-1385"><a href="#cb17-1385"></a>    <span class="at">Mu =</span> w_A <span class="sc">*</span> mu_A <span class="sc">+</span> w_B <span class="sc">*</span> mu_B,</span>
<span id="cb17-1386"><a href="#cb17-1386"></a>    <span class="at">Sigma =</span> <span class="fu">sqrt</span>(w_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> sig_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> w_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> sig_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> w_A <span class="sc">*</span> w_B <span class="sc">*</span> cov_AB)</span>
<span id="cb17-1387"><a href="#cb17-1387"></a>  )</span>
<span id="cb17-1388"><a href="#cb17-1388"></a></span>
<span id="cb17-1389"><a href="#cb17-1389"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1390"><a href="#cb17-1390"></a><span class="co"># 4. 作図 (ggplot2)</span></span>
<span id="cb17-1391"><a href="#cb17-1391"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb17-1392"><a href="#cb17-1392"></a></span>
<span id="cb17-1393"><a href="#cb17-1393"></a><span class="co"># --- 左図: 資本市場線 (CML) ---</span></span>
<span id="cb17-1394"><a href="#cb17-1394"></a>p_cml <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-1395"><a href="#cb17-1395"></a>  <span class="co"># 効率的フロンティア（双曲線）</span></span>
<span id="cb17-1396"><a href="#cb17-1396"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> frontier_data, <span class="fu">aes</span>(<span class="at">x =</span> Sigma, <span class="at">y =</span> Mu),</span>
<span id="cb17-1397"><a href="#cb17-1397"></a>            <span class="at">color =</span> <span class="st">"gray70"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-1398"><a href="#cb17-1398"></a>  <span class="co"># 資本市場線 (CML): 切片Rf, 接点を通る直線</span></span>
<span id="cb17-1399"><a href="#cb17-1399"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> Rf, <span class="at">slope =</span> (mu_M <span class="sc">-</span> Rf) <span class="sc">/</span> sig_M,</span>
<span id="cb17-1400"><a href="#cb17-1400"></a>              <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb17-1401"><a href="#cb17-1401"></a>  <span class="co"># 各資産のポイント</span></span>
<span id="cb17-1402"><a href="#cb17-1402"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> assets, <span class="fu">aes</span>(<span class="at">x =</span> Sigma, <span class="at">y =</span> Mu, <span class="at">color =</span> Asset), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-1403"><a href="#cb17-1403"></a>  <span class="co"># Rfの点</span></span>
<span id="cb17-1404"><a href="#cb17-1404"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> Rf), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-1405"><a href="#cb17-1405"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.01</span>, <span class="at">y =</span> Rf, <span class="at">label =</span> <span class="st">"Rf"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-1406"><a href="#cb17-1406"></a>  <span class="co"># ラベル類</span></span>
<span id="cb17-1407"><a href="#cb17-1407"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"資本市場線 (CML)"</span>,</span>
<span id="cb17-1408"><a href="#cb17-1408"></a>       <span class="at">x =</span> <span class="st">"リスク (標準偏差)"</span>, <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb17-1409"><a href="#cb17-1409"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-1410"><a href="#cb17-1410"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Sigma)<span class="sc">*</span><span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb17-1411"><a href="#cb17-1411"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Mu)<span class="sc">*</span><span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb17-1412"><a href="#cb17-1412"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co"># 凡例は右図と共通または省略</span></span>
<span id="cb17-1413"><a href="#cb17-1413"></a></span>
<span id="cb17-1414"><a href="#cb17-1414"></a><span class="co"># --- 右図: 証券市場線 (SML) ---</span></span>
<span id="cb17-1415"><a href="#cb17-1415"></a>p_sml <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-1416"><a href="#cb17-1416"></a>  <span class="co"># 証券市場線 (SML): 切片Rf, 傾き(Rm-Rf)</span></span>
<span id="cb17-1417"><a href="#cb17-1417"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> Rf, <span class="at">slope =</span> (mu_M <span class="sc">-</span> Rf),</span>
<span id="cb17-1418"><a href="#cb17-1418"></a>              <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb17-1419"><a href="#cb17-1419"></a>  <span class="co"># 各資産のポイント</span></span>
<span id="cb17-1420"><a href="#cb17-1420"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> assets, <span class="fu">aes</span>(<span class="at">x =</span> Beta, <span class="at">y =</span> Mu, <span class="at">color =</span> Asset), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-1421"><a href="#cb17-1421"></a>  <span class="co"># 補助線 (市場PFのベータ=1を示す線)</span></span>
<span id="cb17-1422"><a href="#cb17-1422"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> mu_M),</span>
<span id="cb17-1423"><a href="#cb17-1423"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb17-1424"><a href="#cb17-1424"></a>  <span class="co"># Rfの点</span></span>
<span id="cb17-1425"><a href="#cb17-1425"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> Rf), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-1426"><a href="#cb17-1426"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">y =</span> Rf, <span class="at">label =</span> <span class="st">"Rf"</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-1427"><a href="#cb17-1427"></a>  <span class="co"># ラベル類</span></span>
<span id="cb17-1428"><a href="#cb17-1428"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"証券市場線 (SML)"</span>,</span>
<span id="cb17-1429"><a href="#cb17-1429"></a>       <span class="at">x =</span> <span class="st">"ベータ (β)"</span>, <span class="at">y =</span> <span class="st">"期待リターン"</span>) <span class="sc">+</span></span>
<span id="cb17-1430"><a href="#cb17-1430"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-1431"><a href="#cb17-1431"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb17-1432"><a href="#cb17-1432"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(frontier_data<span class="sc">$</span>Mu)<span class="sc">*</span><span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb17-1433"><a href="#cb17-1433"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb17-1434"><a href="#cb17-1434"></a></span>
<span id="cb17-1435"><a href="#cb17-1435"></a><span class="co"># --- 図の結合 ---</span></span>
<span id="cb17-1436"><a href="#cb17-1436"></a>p_combined <span class="ot">&lt;-</span> p_cml <span class="sc">+</span> p_sml</span>
<span id="cb17-1437"><a href="#cb17-1437"></a>p_combined</span>
<span id="cb17-1438"><a href="#cb17-1438"></a><span class="in">```</span></span>
<span id="cb17-1439"><a href="#cb17-1439"></a></span>
<span id="cb17-1440"><a href="#cb17-1440"></a></span>
<span id="cb17-1441"><a href="#cb17-1441"></a><span class="fu">## N資産が投資可能な場合への拡張</span></span>
<span id="cb17-1442"><a href="#cb17-1442"></a></span>
<span id="cb17-1443"><a href="#cb17-1443"></a>今までは，リスク資産が銘柄AとBの二つしかない場合を分析してきたが，現実は多くのリスク資産が存在し、海外株式や債券、REIT(不動産投資信託)といったその他の投資可能な金融資産を含めればその数は飛躍的に増加する。</span>
<span id="cb17-1444"><a href="#cb17-1444"></a>本節での平均分散アプローチやCAPMは危険資産の数が任意の$N$個であっても成立する。</span>
<span id="cb17-1445"><a href="#cb17-1445"></a>ただしその場合は**行列での表記**が必須となる(第7章やサポートサイト4.5節参照)。</span>
<span id="cb17-1446"><a href="#cb17-1446"></a></span>
<span id="cb17-1447"><a href="#cb17-1447"></a>一般に，平均分散の意味で効率的なポートフォリオ(**平均分散ポートフォリオ**)を計算するには、目標期待リターンを所与として、それを実現するポートフォリオの中でリスクを最小化するものを求める。</span>
<span id="cb17-1448"><a href="#cb17-1448"></a>得られた期待リターンとリスクのペアを一点として、目標期待リターンを動かすとリスク・リターン平面上に双曲線が描ける。</span>
<span id="cb17-1449"><a href="#cb17-1449"></a>この双曲線を**平均分散フロンティア**と呼び、効率的フロンティアはその上半分の領域である(確認済み)。</span>
<span id="cb17-1450"><a href="#cb17-1450"></a></span>
<span id="cb17-1451"><a href="#cb17-1451"></a>一般に投資可能な資産の数が増えると、平均分散フロンティアは左上に移動し、投資家はより望ましいポートフォリオが実現できるようになる。</span>
<span id="cb17-1452"><a href="#cb17-1452"></a>リスク資産$A$と$B$に加えて$C$が投資可能な状況を考えると投資可能な資産が増えたからと言って必ずしもその資産に投資する必要はない。$w_C=0$とすれば、投資家は危険資産$A$と$B$のみに投資可能だった場合と同じ投資機会集合を実現できる。</span>
<span id="cb17-1453"><a href="#cb17-1453"></a>新しい危険資産が既存資産の組み合わせによって完全に再現できるような極端な例を除けば分散投資のメリットが生じるため、投資家はより望ましいリスク・リターンのトレードオフを実現できる。</span>
<span id="cb17-1454"><a href="#cb17-1454"></a></span>
<span id="cb17-1455"><a href="#cb17-1455"></a></span>
<span id="cb17-1456"><a href="#cb17-1456"></a>統計学における分散の定義は，$N$個の確率変数$R_1,R_2,\cdots,R_N$の共分散行列$\Sigma$の対角成分の和である。</span>
<span id="cb17-1457"><a href="#cb17-1457"></a>$$</span>
<span id="cb17-1458"><a href="#cb17-1458"></a>\begin{aligned}</span>
<span id="cb17-1459"><a href="#cb17-1459"></a>\sigma^2=\sum_{i=1}^N\sum_{j=1}^N\sigma_{ij}=\sum_{i=1}^N\sigma_{ii}</span>
<span id="cb17-1460"><a href="#cb17-1460"></a>\end{aligned}</span>
<span id="cb17-1461"><a href="#cb17-1461"></a>$$</span>
<span id="cb17-1462"><a href="#cb17-1462"></a>ここで，$\sigma_{ij}$は$R_i$と$R_j$の共分散であり，$\sigma_{ii}$は$R_i$の分散である。</span>
<span id="cb17-1463"><a href="#cb17-1463"></a>共分散行列$\Sigma$は対称行列であり，対角成分は分散を表す。</span>
<span id="cb17-1464"><a href="#cb17-1464"></a>また，$R_i$と$R_j$の共分散は$\sigma_{ij}=\sigma_{ji}$である。</span>
<span id="cb17-1465"><a href="#cb17-1465"></a>共分散行列の対角成分以外の成分は共分散を表す。</span>
<span id="cb17-1466"><a href="#cb17-1466"></a>$$</span>
<span id="cb17-1467"><a href="#cb17-1467"></a>\begin{aligned}</span>
<span id="cb17-1468"><a href="#cb17-1468"></a>\Sigma=</span>
<span id="cb17-1469"><a href="#cb17-1469"></a>\begin{bmatrix}</span>
<span id="cb17-1470"><a href="#cb17-1470"></a>\sigma_{11} &amp; \sigma_{12} &amp; \cdots &amp; \sigma_{1N} <span class="sc">\\</span></span>
<span id="cb17-1471"><a href="#cb17-1471"></a>\sigma_{21} &amp; \sigma_{22} &amp; \cdots &amp; \sigma_{2N} <span class="sc">\\</span></span>
<span id="cb17-1472"><a href="#cb17-1472"></a>\vdots &amp; \vdots &amp; \ddots &amp; \vdots <span class="sc">\\</span></span>
<span id="cb17-1473"><a href="#cb17-1473"></a>\sigma_{N1} &amp; \sigma_{N2} &amp; \cdots &amp; \sigma_{NN} <span class="sc">\\</span></span>
<span id="cb17-1474"><a href="#cb17-1474"></a>\end{bmatrix}</span>
<span id="cb17-1475"><a href="#cb17-1475"></a>\end{aligned}</span>
<span id="cb17-1476"><a href="#cb17-1476"></a>$$</span>
<span id="cb17-1477"><a href="#cb17-1477"></a></span>
<span id="cb17-1478"><a href="#cb17-1478"></a>上のは，$N$個の確率変数の共分散行列の定義である。Copilotで作成しました。</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Soichi Matsuura</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://so-ichi.com/r.html">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ma2ura">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/matsuura_rits">
      <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>